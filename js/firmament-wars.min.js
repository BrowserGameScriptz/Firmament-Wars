!function(e,t,a,n,o,i,r,l,s,c,u,d,p,m,g,f,y,h,v,b,w,k,x,C,T,B,S,A,N,E,I,M,G){function D(t){var a=ce.tiles[t],n="Default.jpg",o=a.name;0===a.player?(n="Player0.jpg",a.units>0?o="Barbarian Tribe":(o="Uninhabited",n="Default.jpg")):(n=a.flag,o=a.name);var i={food:0,culture:0,production:0,defense:0};a.player&&(i.food=~~((a.food>8?8:a.food)/8*99),i.production=~~((a.production>8?8:a.production)/8*99),i.culture=~~((a.culture>8?8:a.culture)/8*99),i.defense=~~(a.defense/4*99));var r="<span>"+a.food+'<img src="images/icons/food.png" class="fw-icon-sm"></span>'+(a.production?"<span>"+a.production+'<img src="images/icons/production.png" class="fw-icon-sm"></span>':"")+(a.culture?"<span>"+a.culture+'<img src="images/icons/culture.png" class="fw-icon-sm"></span>':"")+(a.defense?"<span>"+a.defense+'<img src="images/icons/tile-defense.png" class="fw-icon-sm"></span>':"");se.targetNameWrap.innerHTML=o,se.targetResources.innerHTML=r,se.targetFlag.src="images/flags/"+n;var l=["Bunker","Wall","Fortress"],s=a.defense-(a.capital?1:0);if(a.player===ue.player&&ue.tech.masonry&&s<3){se.buildWord.textContent=l[s],se.buildCost.textContent=le.upgradeCost[s],2===s&&(l[2]="Fortresse");var c=l[s]+"s boost tile defense +"+[1,2,3][s]+" and "+["reduces weapon damage by 1","reduces weapon damage by 3","reduces weapon damage by 6"][s];e("#upgradeTileDefense").attr("title",c).tooltip("fixTitle").tooltip("hide").tooltip({animation:!1,placement:"bottom",container:"body"})}be.setBuildButton(),re.target()}function L(){new Audio("sound/sniper0.mp3");var t=0;!function a(){e.ajax({type:"GET",url:app.url+"php/gameVictory.php"}).done(function(e){var t="";e.ceaseFire?(t='<p>Armistice!</p>\t\t\t\t<div>The campaign has been suspended!</div>\t\t\t\t<div id="ceaseFire" class="endBtn">\t\t\t\t\t<div class="modalBtnChild">Cease Fire</div>\t\t\t\t</div>',ve.play("shotgun2")):e.gameDone&&(t='<p>Congratulations!</p>\t\t\t\t<div>Your campaign for global domination has succeeded!</div>\t\t\t\t<div id="endWar" class="endBtn">\t\t\t\t\t<div class="modalBtnChild">Victory</div>\t\t\t\t</div>',le.victory=!0),t&&W(t,1)}).fail(function(e){++t<5&&v(function(){a()},2500)})}()}function W(t,i){e("body, #gameWrap").off("click mousedown keydown keyup keypress"),le.gameDuration=~~((I.now()-1*sessionStorage.getItem("gameDuration"))/1e3),e("#chat-input-open, #chat-input-wrap").remove(),A.onbeforeunload=null,v(function(){le.over=1},1500),ie.get(),new Image("images/FlatWorld90.jpg"),v(function(){var r=a.getElementById("victoryScreen");r.innerHTML=t,r.style.display="block",i?ve.play("sniper0"):ve.play("shotgun2"),e("#endWar").on($.click,function(){e("#endWar").off(),le.view="stats",o.to("#gameWrap",.05,{alpha:0,onComplete:function(){e("#ui2-head, #diplomacy-ui, #chat-input-open, #chat-ui, #chat-input-wrap, #hud, #worldWrap, #victoryScreen").remove(),ie.show()}})}),e("#ceaseFire").on($.click,function(){n.reload()}),e("#spectate").on($.click,function(t){e("#victoryScreen, #ui2, #resourceBody, #targetWrap").remove(),a.getElementById("surrender").style.display="none",a.getElementById("exitSpectate").style.display="inline",le.spectateStatus=1}),e("#exitSpectate").on($.click,function(){e(this).off($.click),ie.get(),o.to("#diplomacy-ui",1,{alpha:0,onComplete:function(){ie.show()}})})},2500)}function F(){var e=a;se={targetUiWrap:e.getElementById("target-ui-wrap"),endTurn:e.getElementById("endTurn"),energyIndicator:e.getElementById("energyIndicator"),currentYear:e.getElementById("currentYear"),currentYearWrap:e.getElementById("currentYearWrap"),targetFlag:e.getElementById("targetFlag"),targetResources:e.getElementById("targetResources"),targetNameWrap:e.getElementById("targetNameWrap"),targetBarsWrap:e.getElementById("targetBarsWrap"),targetNameAnchor:e.getElementById("targetNameAnchor"),landWrap:e.getElementById("landWrap"),gameWindows:e.getElementsByClassName("gameWindow"),sumMoves:e.getElementById("sumMoves"),moves:e.getElementById("moves"),gameWrap:e.getElementById("gameWrap"),gameTableBody:e.getElementById("gameTableBody"),food:e.getElementById("food"),production:e.getElementById("production"),culture:e.getElementById("culture"),Msg:e.getElementById("Msg"),hud:e.getElementById("hud"),sumFood:e.getElementById("sumFood"),foodMax:e.getElementById("foodMax"),cultureMax:e.getElementById("cultureMax"),manpower:e.getElementById("manpower"),sumProduction:e.getElementById("sumProduction"),sumCulture:e.getElementById("sumCulture"),chatContent:e.getElementById("chat-content"),chatInput:e.getElementById("chat-input"),lobbyChatInput:e.getElementById("lobby-chat-input"),titleChatInput:e.getElementById("title-chat-input"),worldWrap:e.getElementById("worldWrap"),motionPath:e.getElementById("motionPath"),troopIcon:e.getElementById("troop-icon"),targetLine:e.getElementById("targetLine"),targetLineBorder:e.getElementById("targetLineBorder"),arrowheadTip:e.getElementById("arrowhead-tip"),arrowhead:e.getElementById("arrowhead"),arrowheadBorder:e.getElementById("arrowhead-border"),targetLineShadow:e.getElementById("targetLineShadow"),targetCrosshair:e.getElementById("targetCrosshair"),target:e.getElementById("target"),targetName:e.getElementById("targetName"),oBonus:e.getElementById("oBonus"),dBonus:e.getElementById("dBonus"),productionBonus:e.getElementById("productionBonus"),foodBonus:e.getElementById("foodBonus"),cultureBonus:e.getElementById("cultureBonus"),foodBar:e.getElementById("foodBar"),cultureBar:e.getElementById("cultureBar"),world:e.getElementById("world"),bgmusic:e.getElementById("bgmusic"),tileName:e.getElementById("tileName"),buildWord:e.getElementById("buildWord"),buildCost:e.getElementById("buildCost"),cannonsCost:e.getElementById("cannonsCost"),missileCost:e.getElementById("missileCost"),nukeCost:e.getElementById("nukeCost"),masonryCost:e.getElementById("masonryCost"),constructionCost:e.getElementById("constructionCost"),gunpowderCost:e.getElementById("gunpowderCost"),engineeringCost:e.getElementById("engineeringCost"),rocketryCost:e.getElementById("rocketryCost"),atomicTheoryCost:e.getElementById("atomicTheoryCost"),futureTechCost:e.getElementById("futureTechCost"),upgradeTileDefense:e.getElementById("upgradeTileDefense"),screenFlash:e.getElementById("screenFlash"),fireCannons:e.getElementById("fireCannons"),launchMissile:e.getElementById("launchMissile"),launchNuke:e.getElementById("launchNuke"),researchMasonry:e.getElementById("researchMasonry"),researchConstruction:e.getElementById("researchConstruction"),researchEngineering:e.getElementById("researchEngineering"),researchGunpowder:e.getElementById("researchGunpowder"),researchRocketry:e.getElementById("researchRocketry"),researchAtomicTheory:e.getElementById("researchAtomicTheory"),researchFutureTech:e.getElementById("researchFutureTech"),lobbyChatLog:e.getElementById("lobbyChatLog"),titleChatLog:e.getElementById("titleChatLog"),mapAnimations:e.getElementById("mapAnimations"),mapCapitals:e.getElementById("mapCapitals"),mapUpgrades:e.getElementById("mapUpgrades"),mapBars:e.getElementById("mapBars"),titleChatBody:e.getElementById("titleChatBody")}}function P(t){if("game"===le.view)var a=confirm("Are you sure you want to surrender?");(a||t||"game"!==le.view)&&(le.lock(1),e.ajax({url:app.url+"php/exitGame.php",data:{view:le.view}}).always(function(){n.reload()}))}function j(){a.getElementById("surrenderScreen").style.display="none",e.ajax({type:"GET",url:app.url+"php/surrender.php"}),ve.play("click")}function O(e){}function R(){if(isLoggedIn){var t="Monarchy"===ue.government?2:0;e("#fireCannons").attr("title","Fire cannons at an adjacent tile. Kills "+(2+ue.oBonus+t)+"-"+(4+ue.oBonus+t)+" troops. Boosted by Great Generals.").tooltip("fixTitle").tooltip({animation:!1}),e("#launchMissile").attr("title","Launch a missile at any territory. Kills "+(7+2*ue.oBonus)+"-"+(12+2*ue.oBonus)+" troops. Boosted by Great Generals.").tooltip("fixTitle").tooltip({animation:!1}),e("#rush").attr("title","Rush "+(2+~~(ue.cultureBonus/50))+" troops from your citizenry. Boosted by culture bonus.").tooltip("fixTitle").tooltip({animation:!1})}}function H(e){ue.food=e.food,ue.production=e.production,ue.culture=e.culture,se.moves.textContent=e.moves,se.production.textContent=e.production,se.food.textContent=e.food,se.culture.textContent=e.culture,se.manpower.textContent=ue.manpower,ue.manpower=e.manpower,se.foodMax.textContent=e.foodMax,se.cultureMax.textContent=e.cultureMax,se.oBonus.textContent=e.oBonus,se.dBonus.textContent=e.dBonus,se.productionBonus.textContent=e.productionBonus,se.foodBonus.textContent=e.foodBonus,se.cultureBonus.textContent=e.cultureBonus,Y(e)}function V(e){e.moves!==G&&(ue.moves=e.moves,se.moves.textContent=e.moves,e.sumMoves)}function U(e){e.production!==G&&o.to(ue,.3,{production:e.production,ease:Quad.easeIn,onUpdate:function(){se.production.textContent=~~ue.production}})}function z(e){V(e),U(e),o.to(ue,.3,{food:e.food===G?ue.food:e.food,culture:e.culture===G?ue.culture:e.culture,ease:Quad.easeIn,onUpdate:function(){se.food.textContent=~~ue.food,se.culture.textContent=~~ue.culture}}),e.manpower!==G&&(e.manpower>ue.manpower?(o.fromTo("#manpower",.5,{color:"#ffaa33"},{color:"#ffff00",repeat:-1,yoyo:!0}),o.to(ue,.5,{manpower:e.manpower,onUpdate:function(){se.manpower.textContent=~~ue.manpower}})):(ue.manpower=e.manpower,se.manpower.textContent=ue.manpower)),e.foodMax!==G&&e.foodMax&&e.foodMax>ue.foodMax&&(se.foodMax.textContent=e.foodMax,ue.foodMax=e.foodMax),e.cultureMax!==G&&e.cultureMax&&e.cultureMax>ue.cultureMax&&(se.cultureMax.textContent=e.cultureMax,ue.cultureMax=e.cultureMax),e.oBonus!==G&&ue.oBonus!==e.oBonus&&(se.oBonus.textContent=e.oBonus,ue.oBonus=e.oBonus,R()),e.dBonus!==G&&ue.dBonus!==e.dBonus&&(se.dBonus.textContent=e.dBonus,ue.dBonus=e.dBonus),e.productionBonus!==G&&ue.productionBonus!==e.productionBonus&&(se.productionBonus.textContent=e.productionBonus,ue.productionBonus=e.productionBonus),e.foodBonus!==G&&ue.foodBonus!==e.foodBonus&&(se.foodBonus.textContent=e.foodBonus,ue.foodBonus=e.foodBonus),e.cultureBonus!==G&&ue.cultureBonus!==e.cultureBonus&&(se.cultureBonus.textContent=e.cultureBonus,ue.cultureBonus=e.cultureBonus,R()),Y(e)}function Y(e){o.to(se.foodBar,.3,{width:e.food/e.foodMax*100+"%"}),o.to(se.cultureBar,.3,{width:e.culture/e.cultureMax*100+"%"})}function q(){return this.account="",this.nation="",this.flag="",this.playerColor=0,this.team=1,this.alive=!0,this.government="",this}function J(){le.lock(1);var t=a.getElementById("mainWrap");null!==t&&o.to(t,.5,{alpha:0}),e.ajax({type:"GET",url:app.url+"maps/"+le.map.key+".php"}).done(function(t){se.worldWrap.innerHTML='<div id="worldWater"></div>'+t,e.ajax({type:"GET",url:app.url+"php/loadGameState.php"}).done(function(t){if(e("#login-modal").remove(),v(function(){e("#title-bg-wrap").remove()},2e3),le.resourceTick=t.resourceTick,le.startGame=1*t.startGame,le.teamMode=t.teamMode,le.gameMode=t.gameMode,le.map.sizeX=t.mapData.sizeX,le.map.sizeY=t.mapData.sizeY,le.map.name=t.mapData.name,le.map.tiles=t.mapData.tiles,t.tiles.length<le.map.tiles)le.loadAttempts<20?v(function(){le.loadAttempts++,J()},500):(le.msg("Failed to load game data"),localStorage.setItem("reload",!1),v(function(){A.onbeforeunload=null,n.reload()},3e3));else{F(),e("meta").remove(),le.screen.resizeMap(),ve.gameMusicInit(),ve.load.game(),ge.load.game(),ue.player=t.player,ue.team=t.team,ue.account=t.account,ue.oBonus=t.oBonus,ue.dBonus=t.dBonus,ue.cultureBonus=t.cultureBonus,ue.tech=t.tech,ue.capital=t.capital,ue.flag=t.flag,ue.nation=t.nation,ue.foodMax=t.foodMax,ue.production=t.production,ue.sumProduction=t.sumProduction,ue.cultureMax=t.cultureMax,ue.moves=t.moves,ue.government=t.government,ue.cannonBonus=t.cannonBonus,ye.updateGovernmentWindow(ue.government),"Monarchy"===ue.government?ue.cannonsBonus=2:"Democracy"===ue.government?ue.maxDeployment=48:"Republic"===ue.government?(ue.sumMoves=t.sumMoves,a.getElementById("moves").textContent=ue.sumMoves):"Fascism"===ue.government?(a.getElementById("moves").textContent=8,ue.deployCost=1,a.getElementById("deployCost").textContent=ue.deployCost):ue.government,ce.initialized=!0;for(var i=0,r=ce.player.length;i<r;i++)ce.player[i]=new q;le.removeContainers(),le.unlock(),le.view="game",o.fromTo(gameWrap,1,{autoAlpha:0},{autoAlpha:1});for(var l=0,r=t.players.length;l<r;l++){c=t.players[l];(i=ce.player[c.player]).account=c.account,i.flag=c.flag,i.nation=c.nation,i.player=c.player,i.playerColor=c.playerColor,i.team=c.team,i.government=c.government,i.cpu=c.cpu,i.difficulty=c.difficulty,i.difficultyShort=c.difficulty.replace(/ /g,"")}a.getElementById("mapCapitals"),a.getElementById("mapUpgrades");for(var s=I.now(),l=0,r=t.tiles.length;l<r;l++){var c=t.tiles[l];ce.tiles[l]={name:c.tileName,account:c.account,player:c.player,nation:c.nation,flag:c.flag,capital:!!(t.capitalTiles.indexOf(l)>-1&&c.flag),units:c.units,food:c.food,production:c.production,culture:c.culture,defense:c.defense,adj:t.adj[l],timestamp:s};var u=a.getElementById("unit"+l);if(null!==u){var d=ce.tiles[l].capital?'<tspan class="unit-star">&#10028;</tspan>'+ce.tiles[l].units:ce.tiles[l].units;u.innerHTML=0===c.units?0:d,c.units&&(u.style.visibility="visible")}c.player&&o.set("#land"+l,{fill:le.color[ce.player[c.player].playerColor],stroke:le.color[ce.player[c.player].playerColor],strokeWidth:1,onComplete:function(){c.player&&o.set(this.target,{stroke:"hsl(+=0%, +=0%, -=30%)"})}})}le.tileCount=r;for(var p=a.getElementsByClassName("unit"),m=(a.getElementById("mapBars"),a.getElementById("mapFlagWrap")),l=0,r=p.length;l<r;l++){var g=ce.tiles[l],f=p[l].getAttribute("x")-20,y=p[l].getAttribute("y")-30,h="blank.png";g!==G&&(!g.flag&&g.units?h="Player0.jpg":g.flag&&(h=g.flag));b=a.createElementNS("http://www.w3.org/2000/svg","image");if(b.id="flag"+l,b.setAttributeNS(null,"height",40),b.setAttributeNS(null,"width",40),b.setAttributeNS(null,"x",f),b.setAttributeNS(null,"y",y),b.setAttributeNS(null,"class","mapFlag"),b.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/flags/"+h),m.appendChild(b),ce.tiles[l]!==G&&ce.tiles[l].capital){var b;(b=a.createElementNS("http://www.w3.org/2000/svg","path")).id="mapCapital"+l,b.setAttributeNS(null,"class","mapStar"),b.setAttributeNS(null,"d","m "+(f+20)+","+y+" 5.79905,17.10796 18.05696,0.50749 -14.47863,10.80187 5.09725,17.33001 -14.74733,-10.43203 -14.90668,10.20304 5.36427,-17.24922 -14.31008,-11.02418 18.06264,-0.22858 z")}var w=a.getElementById("targetCrosshair");o.to(w,10,{force3D:!0,transformOrigin:"50% 50%",rotation:360,repeat:-1,ease:Linear.easeNone})}ce.initMap();for(l=0;l<r;l++)re.initMapBars(l);$.drawDiplomacyPanel();var k=a.getElementById("game-mode-name");k.className=le.gameMode.toLowerCase(),k.textContent=le.gameMode,H(t),v(function(){me=Draggable.create(se.worldWrap,{minimumMovement:4,type:"x,y",bounds:"#gameWrap"}),R(),o.set(se.targetLine,{stroke:le.color[ce.player[ue.player].playerColor]}),o.set(se.targetLine,{stroke:"hsl(+=0%, +=0%, -=5%)"}),o.set(se.arrowheadTip,{fill:le.color[ce.player[ue.player].playerColor]}),o.set(se.arrowheadTip,{fill:"hsl(+=0%, +=0%, -=5%)"}),e("#gameWrap").on("click",".land",function(e){!function(e){if(e.id.slice(4),ue.attackOn){var t=ue.targetData;"attack"===t.attackName||"splitAttack"===t.attackName?be.attack(e):"cannons"===t.attackName?be.fireCannons(e):"missile"===t.attackName?be.launchMissile(e):"nuke"===t.attackName&&be.launchNuke(e)}else $.showTarget(e)}(this)}).on("mouseenter",".land",function(){ue.lastTarget=this,ue.attackOn&&$.showTarget(this,!0),o.set(this,{fill:"hsl(+=0%, +=0%, -=5%)"})}).on("mouseleave",".land",function(){var e=1*this.id.slice(4);if(ce.tiles.length>0){var t=ce.tiles[e]!==G?ce.tiles[e].player:0,a=t?ce.player[t].playerColor:0;o.set(this,{fill:le.color[a]})}}),ue.focusTile(ue.capital),ce.startGameState(),$.setCurrentYear(t.resourceTick),re.paths(),be.setMenu(),D(ue.lastTgt),ce.setVisibilityAll()},350)}}).fail(function(e){v(function(){J()},1500)}).always(function(){le.unlock()})})}function X(){le.mouse.zoom+=10,le.mouse.zoom>150&&(le.mouse.zoom=150),o.to(se.worldWrap,.3,{transformOrigin:le.mouse.transX+"% "+le.mouse.transY+"%",force3D:!1,smoothOrigin:!0,scale:le.mouse.zoom/100,onUpdate:function(){me[0].applyBounds()},onComplete:function(){me[0].applyBounds()}})}function K(){le.mouse.zoom-=10,le.mouse.zoom<100&&(le.mouse.zoom=100),o.to(se.worldWrap,.3,{force3D:!1,smoothOrigin:!0,transformOrigin:le.mouse.transX+"% "+le.mouse.transY+"%",scale:le.mouse.zoom/100,onUpdate:function(){me[0].applyBounds()},onComplete:function(){me[0].applyBounds()}}),me[0].applyBounds()}function _(e,t){var a=~~(e/le.map.sizeX*100),n=~~(t/le.map.sizeY*100);le.mouse.transX=a,le.mouse.transY=n}function Q(e){e===G&&(e={}),this.cost=e.cost!==G?e.cost:2,this.minimum=e.minimum!==G?e.minimum:2,this.attackName=e.attackName?e.attackName:"attack",this.splitAttack=!!e.splitAttack&&e.splitAttack,this.hudMsg=e.hudMsg?e.hudMsg:"Attack: Select Target"}function Z(t){if(le.chatOn=!le.chatOn,le.chatOn)pe.chatInputOpen.css("visibility","hidden"),pe.chatInputWrap.css("visibility","visible"),pe.chatInput.focus();else{var a=pe.chatInput.val().trim();if(t&&a)if("/friend"===a)fe.listFriends();else if(0===a.indexOf("/friend "))fe.toggleFriend(a.slice(8));else if(0===a.indexOf("/unignore ")){n=a.slice(10);fe.removeIgnore(n)}else if("/ignore"===a)fe.listIgnore();else if(0===a.indexOf("/ignore ")){var n=a.slice(8);fe.addIgnore(n)}else 0===a.indexOf("/whisper ")?fe.sendWhisper(a,"/whisper "):0===a.indexOf("/w ")?fe.sendWhisper(a,"/w "):0===a.indexOf("@")?fe.sendWhisper(a,"@"):0===a.indexOf("/who ")?fe.who(a):"/"===a.charAt(0)&&0!==a.indexOf("/me")||e.ajax({url:app.url+"php/insertChat.php",data:{message:a}});pe.chatInput.val("").blur(),pe.chatInputOpen.css("visibility","visible"),pe.chatInputWrap.css("visibility","hidden")}}var $={getTeamIcon:function(e){return le.teamMode?'<span class="diploTeam">'+e+"</span>":""},getDiploRow:function(e){var t=e.cpu?e.difficulty:e.account,a=ye.governmentIcon(e),n=ce.player[e.player].playerColor;return'<div id="diplomacyPlayer'+n+'" class="diplomacyPlayers alive pb'+n+'"><div class="diplo-pipe pbar'+n+'"></div><img src="images/flags/'+e.flagSrc+'" class="diplo-flag no-select"><div class="diplo-data-col"<div><div class="nowrap">'+a+t+'</div><div class="nowrap">'+$.getTeamIcon(e.team)+e.nation+"</div></div></div></div>"},getPlayersByTileRank:function(){var e=[0,0,0,0,0,0,0,0,0];return ce.tiles.forEach(function(t){t.player&&e[t.player]++}),e},drawDiplomacyPanel:function(){for(var e,t=[],n=0,o=ce.player.length,i=$.getPlayersByTileRank();n<o;n++)if((e=ce.player[n]).account&&i[n]){for(e.flagArr=e.flag.split("."),e.flagShort=e.flagArr[0],e.flagSrc=e.flag;t[i[n]]!==G;)i[n]++;t[i[n]]=$.getDiploRow(e)}a.getElementById("diplomacy-body").innerHTML=t.reverse().join("")},resizeWindow:function(){"game"===le.view&&me[0].applyBounds(),le.screen.resizeMap()},windowDefault:"Full Screen",initWindow:function(){var e=localStorage.getItem("window-size");null===e&&(localStorage.setItem("window-size",$.windowDefault),e=$.windowDefault),$.setWindow(e)},setWindow:function(t){if(app.isApp){var a=require("nw.gui").Window.get();v(function(){"Full Screen"===t?!a.isFullscreen&&a.enterFullscreen():"1920 x 1080"===t?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1920,1080),a.maximize()):"1600 x 900"===t?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1600,900)):"1360 x 768"===t?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1360,768)):"1280 x 720"===t?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1280,720)):!a.isFullscreen&&a.enterFullScreen(),e("#window-size").text(t),localStorage.setItem("window-size",t)},100)}},setMobile:function(){},setWorkSafe:function(){e("head").append("<style>.chat-img{ display: none; } #statQuote{ visibility: hidden; } </style>")},click:ee?"mousedown":"click",showTarget:function(e,a,n){if(e.id===G&&(e.id="land0"),"object"==typeof e){var i=1*e.id.slice(4),r=(ce.tiles[i],ue.tgt);if(a||r!==i&&(ue.tgt=i,re.selectTile(r,i)),a&&i!==ue.tgt){ue.targetLine[4]=1*se["unit"+i].getAttribute("x")-10,ue.targetLine[5]=1*se["unit"+i].getAttribute("y")-10;var l="M "+ue.targetLine[0]+","+ue.targetLine[1]+" "+ue.targetLine[4]+","+ue.targetLine[5],c=0;c+=t.abs(ue.targetLine[0]-ue.targetLine[4]),c+=t.abs(ue.targetLine[1]-ue.targetLine[5]),ue.targetLine[2]=(ue.targetLine[0]+ue.targetLine[4])/2,ue.targetLine[3]=(ue.targetLine[1]+ue.targetLine[5])/2-100;var d="M "+ue.targetLine[0]+","+ue.targetLine[1]+" Q "+ue.targetLine[2]+" "+ue.targetLine[3]+" "+ue.targetLine[4]+" "+ue.targetLine[5];o.set(se.targetLineShadow,{visibility:"visible",attr:{d:l}}),o.set([se.targetLine,se.targetLineBorder],{visibility:"visible",attr:{d:c>300?d:l}}),o.set([se.arrowhead,se.arrowheadBorder],{visibility:"hidden"}),o.set(se.targetLineBorder,{stroke:le.color[ce.player[ue.player].playerColor]}),o.to([se.targetLine,se.targetLineBorder,se.targetLineShadow],.2,{startAt:{drawSVG:"0%"},drawSVG:"100%",onComplete:function(){o.set([se.arrowhead,se.arrowheadBorder],{visibility:"visible"}),o.to([se.targetLine,se.targetLineShadow],.5,{startAt:{strokeDasharray:"31,1",strokeDashoffset:0},strokeDashoffset:-32,repeat:-1,force3D:!0,ease:Linear.easeNone}),o.to(se.targetLineBorder,.5,{stroke:"#000"})}}),o.set(se.targetCrosshair,{fill:"#00dd00",visibility:"visible",x:ue.targetLine[4]-255,y:ue.targetLine[5]-257,transformOrigin:"50% 50%"}),o.to(se.targetCrosshair,1,{startAt:{scale:.35},force3D:!0,scale:.175,repeat:-1,ease:u.easeOut}),o.to(se.targetCrosshair,1,{startAt:{opacity:1},force3D:!0,opacity:0,repeat:-1,ease:s.easeIn})}n||(ue.lastTgt=r),D(i)}else ue.attackOn=!1,ue.attackName=""},transformYear:function(e){return(e<=40?4e3-100*e:e<=60?0+50*(e-40):e<=80?1e3+25*(e-60):e<=120?1500+10*(e-80):e<=170?1900+2*(e-120):2e3+1*(e-170))+(e>=40?" A.D.":" B.C.")},setCurrentYear:function(e){se.currentYear.textContent=$.transformYear(e)},setTileUnits:function(e){var t=ce.tiles[e].capital?'<tspan class="unit-star">\t&#10028;</tspan>'+~~ce.tiles[e].units:~~ce.tiles[e].units;se["unit"+e].innerHTML=0===ce.tiles[e].units?"":t,o.to(se["unit"+e],.5,{startAt:{visibility:"visible"},opacity:1,ease:u.easeIn})},updateAdjacentTileVisibility:function(e){},setUnitVisibility:function(e){o.set(se["unit"+e],{startAt:{fill:"#ffffff",visibility:ce.tiles[e].units?"visible":"hidden"},opacity:1})}},ee=(/Xbox/i.test(navigator.userAgent),navigator.userAgent.toLowerCase().indexOf("playstation"),/Nintendo/i.test(navigator.userAgent),function(){var e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e}()),te=!!A.opera||navigator.userAgent.indexOf(" OPR/")>=0,ae="undefined"!=typeof InstallTrigger,ne=M.prototype.toString.call(A.HTMLElement).indexOf("Constructor")>0,oe=(A.chrome,!!navigator.userAgent.match(/Trident\/7\./));!function(){localStorage.getItem("isMobile");oe?e("head").append("<style> text { font-family: Verdana; stroke-width: 0; stroke: #000; fill: #fff; } .unit{ font-size: 26px; } </style>"):ne&&e("head").append("<style> text { fill: #ffffff; stroke: none; stroke-width: 0px; } </style>"),(ee||"#mobiletest"===n.hash)&&$.setMobile(),"#synergist"!==n.hash&&"#sfw"!==n.hash||$.setWorkSafe(),localStorage.setItem("isMobile",ee),v(function(){e("script").remove()},1e3),$.initWindow()}();e("#payment-confirm").on($.click,function(t){le.lock();var o=e("#card-number").val(),i=e("#card-cvc").val(),r=e("#card-month").val(),l=20+e("#card-year").val(),s=!1;Stripe.validateCardNumber(o)||(s=!0,le.msg("The credit card number is invalid.")),Stripe.validateCVC(i)||(s=!0,le.msg("The CVC number is invalid.")),Stripe.validateExpiry(r,l)||(s=!0,le.msg("The expiration date is invalid.")),s?le.unlock():(e("#payment-errors").text(""),Stripe.createToken({number:o,cvc:i,exp_month:r,exp_year:l},function(t,o){o.error?(le.msg(o.error.message),le.unlock()):(le.msg("Communicating with the server..."),e.ajax({url:app.url+"php/purchaseFw.php",data:{stripeToken:o.id}}).done(function(e){le.msg("Thank you for your purchase!<br>Firmament Wars - Complete Game Unlocked!",8),v(function(){n.reload()},3e3)}).fail(function(e){a.getElementById("payment-errors").textContent=e.error}).always(function(){le.unlock()}))}))});!function(){if(!e("#titleMenu").length){var t=localStorage.getItem("email"),a=localStorage.getItem("token");t&&(a?e.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"authenticate",email:t,token:a}}).done(function(o){"Login successful!"===o&&e.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"getToken",email:t}}).done(function(o){a=o,e.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"authenticate",email:t,token:a}}).done(function(e){localStorage.setItem("token",a),n.reload()}).fail(function(e){})})}):e.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"getToken",email:t}}).done(function(e){a=e}))}}();var ie={init:function(e){var t=ue.flag;if(ee)n='<img id="statWorld" style="display: none">';else var n='<img id="statWorld" src="images/FlatWorld90.jpg">';n+='<div id="statResult" class="no-select">\t\t\t<img class="statResultFlag" src="images/flags/'+t+'">\t\t\t<span id="statGameResult">Defeat in '+$.transformYear(e.resourceTick)+'</span>\t\t\t<img class="statResultFlag" src="images/flags/'+t+'">\t\t</div>\t\t<div id="statTabWrap" class="no-select shadow4">\t\t\t<div id="statOverview" class="statTabs active">\t\t\t\tOverview\t\t\t</div><div id="statUnits" class="statTabs">\t\t\t\tUnits\t\t\t</div><div id="statStructures" class="statTabs">\t\t\t\tStructures\t\t\t</div><div id="statWeapons" class="statTabs">\t\t\t\tWeapons\t\t\t</div><div id="statResources" class="statTabs">\t\t\t\tResources\t\t\t</div>\t\t</div>\t\t<table id="gameStatsTable" class="table"></table>\t\t<div id="statFooter" class="container-fluid">\t\t\t<div class="row">\t\t\t\t<div id="statQuote" class="col-xs-7 shadow4 stagBlue">\t\t\t\t\t<div id="muh-bible">'+ie.data.quote+'</div>\t\t\t\t\t<div id="statVerse" class="text-right">'+ie.data.verse+'</div>\t\t\t\t</div>\t\t\t\t<div id="statDuration" class="col-xs-4 stagBlue text-center">\t\t\t\t\t<div id="gameDuration">Game Duration '+ie.gameDuration(le.gameDuration)+'</div>\t\t\t\t\t<button id="statsEndGame" class="btn btn-md btn-block btn-responsive shadow4 lobbyButtons">End Game</button>\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t<div id="ribbonBackdrop"></div>\t\t<div id="ribbonReward" class="fw-primary title-modals">\t\t\t<div class="header text-center">\t\t\t\t<h2 class="header">Achievement Unlocked!</h2>\t\t\t</div>\t\t\t<hr class="fancyhr">\t\t\t<div id="ribbonBody"></div>\t\t</div>',a.getElementById("statWrap").innerHTML=n,ie.events(),re.muhBible(),o.to("#statWorld",300,{startAt:{xPercent:-50,yPercent:-50,rotation:-360},rotation:0,repeat:-1,ease:Linear.easeNone}),ie.setLeaderValues()},setBibleMode:function(t){var n=a.createElement("style");n.id="bible-state",n.type="text/css",n.innerHTML="#statQuote { visibility: visible!important }",t||(n.innerHTML="#statQuote { visibility: hidden }"),e("#bible-state").remove(),a.head.appendChild(n),localStorage.setItem("bible",t?1:0)},show:function(){se.bgmusic.loop=!0,ie.setView("statOverview"),le.victory?(ve.play("bell-8"),ve.play("TheAssault",1),a.getElementById("statGameResult").textContent="Victory in "+$.transformYear(ie.data.resourceTick)):(ve.play("defeat"),ve.play("JourneyOfForgottenSoldiers",1)),a.getElementById("statWrap").style.visibility="visible",o.to("#gameWrap",.5,{startAt:{alpha:0},alpha:1}),ie.achievements.length&&(ve.play("ding3"),o.to("#ribbonBackdrop",.5,{startAt:{visibility:"visible",alpha:0},alpha:1}),o.to("#ribbonReward",1,{startAt:{visibility:"visible",alpha:0,top:0,y:0},alpha:1,y:30})),e("#worldWrap, #targetWrap, #ui2, #resources-ui, #diplomacy-ui, #chat-ui, #chat-input-open, #chat-input-wrap, #surrenderScreen").remove()},events:function(){e("#statWrap").on($.click,".statTabs",function(){e(".statTabs").removeClass("active"),e(this).addClass("active"),ve.play("switch13");var t=e(this).attr("id");ie.setView(t)}).on($.click,"#statsEndGame",function(){n.reload()}).on($.click,"#ribbonBackdrop",function(){o.to("#ribbonBackdrop, #ribbonReward",.25,{alpha:0,onComplete:function(){o.set("#ribbonBackdrop, #ribbonReward",{visibility:"hidden"})}})})},maxValue:{unitsTotal:0,structuresTotal:0,weaponsTotal:0,resourcesTotal:0,overviewTotal:0},setLeaderValues:function(){for(var e=1;e<=8;e++){var t=ie.data[e];if(t!==G){for(var a in t)1===e?ie.maxValue[a]=t[a]:t[a]>ie.maxValue[a]&&(ie.maxValue[a]=t[a]);var n=ie.unitsTotal(e),o=ie.structuresTotal(e),i=ie.weaponsTotal(e),r=ie.resourcesTotal(e),l=ie.overviewTotal(e);n>ie.maxValue.unitsTotal&&(ie.maxValue.unitsTotal=ie.unitsTotal(e)),o>ie.maxValue.structuresTotal&&(ie.maxValue.structuresTotal=o),i>ie.maxValue.weaponsTotal&&(ie.maxValue.weaponsTotal=i),r>ie.maxValue.resourcesTotal&&(ie.maxValue.resourcesTotal=r),l>ie.maxValue.overviewTotal&&(ie.maxValue.overviewTotal=l)}}},currentTabId:"",setView:function(e){if(e!==ie.currentTabId){ie.currentTabId=e;var t=ie[e]();a.getElementById("gameStatsTable").innerHTML=t}},barAnimate:new o.delayedCall(0,""),animate:function(e,t){v(function(){var n={max:100,lastVal:0};ie.barAnimate.kill(),ie.barAnimate=o.to(n,t,{startAt:{max:0},max:100,onUpdate:function(){~~n.lastVal!=~~n.max&&(n.lastVal=n.max,ve.play("rollover5"))},onComplete:function(){ve.play("switch11")},ease:h.easeOut});for(var i=1,r=e.length;i<r;i++){var l=e[i];!function(e,a,n,i){o.to(e,t,{startAt:{max:0},max:e.max,onUpdate:function(){a.textContent=~~e.max},ease:i.easeOut}),o.to(n,t,{startAt:{width:0},width:e.max/ie.maxValue[e.key]*100+"%",ease:i.easeOut})}(l,a.getElementById(l.id),a.getElementById(l.id+"-bar"),h)}})},statOverview:function(){for(var e=ie.playerHead(["Units","Structures","Weapons","Resources","Total Score"]),t=1;t<=8;t++){var a=ie.data[t];if(ie.data[t]!==G){n=[{},{id:"p"+t+"-units",max:ie.unitsTotal(t),key:"unitsTotal"},{id:"p"+t+"-structures",max:ie.structuresTotal(t),key:"structuresTotal"},{id:"p"+t+"-weapons",max:ie.weaponsTotal(t),key:"weaponsTotal"},{id:"p"+t+"-resources",max:ie.resourcesTotal(t),key:"resourcesTotal"},{id:"p"+t+"-total",max:ie.overviewTotal(t),key:"overviewTotal"}];ie.animate(n,1.5),e+='<tr class="statRow no-pointer">'+ie.playerCell(a,t);for(var n,o=ce.player[t].playerColor,i=(n=["units","structures","weapons","resources","total"]).length,r=0;r<i;r++){var l=r+1===i?" statSum":"";e+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'" class="statVal'+l+'">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>'}e+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return e},statUnits:function(){for(var e=ie.playerHead(["Earned","Deployed","Killed","Lost"]),t=1;t<=8;t++){var a=ie.data[t];if(a!==G){n=[{},{id:"p"+t+"-earned",max:a.earned,key:"earned"},{id:"p"+t+"-deployed",max:a.deployed,key:"deployed"},{id:"p"+t+"-killed",max:a.killed,key:"killed"},{id:"p"+t+"-lost",max:a.lost,key:"lost"}];ie.animate(n,1.5),e+='<tr class="stagBlue statRow no-pointer">'+ie.playerCell(a,t);for(var n,o=ce.player[t].playerColor,i=(n=["earned","deployed","killed","lost"]).length,r=0;r<i;r++)e+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'" class="statVal">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>';e+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return e},statStructures:function(){for(var e=ie.playerHead(["Bunkers","Walls","Fortresses"]),t=1;t<=8;t++){var a=ie.data[t];if(a!==G){n=[{},{id:"p"+t+"-bunkers",max:a.bunkers,key:"bunkers"},{id:"p"+t+"-walls",max:a.walls,key:"walls"},{id:"p"+t+"-fortresses",max:a.fortresses,key:"fortresses"}];ie.animate(n,1),e+='<tr class="stagBlue statRow no-pointer">'+ie.playerCell(a,t);for(var n,o=ce.player[t].playerColor,i=(n=["bunkers","walls","fortresses"]).length,r=0;r<i;r++)e+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'" class="statVal">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>';e+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return e},statWeapons:function(){for(var e=ie.playerHead(["Cannons","Missiles","Nukes"]),t=1;t<=8;t++){var a=ie.data[t];if(a!==G){n=[{},{id:"p"+t+"-cannons",max:a.cannons,key:"cannons"},{id:"p"+t+"-missiles",max:a.missiles,key:"missiles"},{id:"p"+t+"-nukes",max:a.nukes,key:"nukes"}];ie.animate(n,1),e+='<tr class="stagBlue statRow no-pointer">'+ie.playerCell(a,t);for(var n,o=ce.player[t].playerColor,i=(n=["cannons","missiles","nukes"]).length,r=0;r<i;r++)e+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+t+"-"+n[r]+'" class="statVal">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>';e+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return e},statResources:function(){for(var e=ie.playerHead(["Energy","Science","Food","Culture"]),t=1;t<=8;t++){var a=ie.data[t];if(a!==G){var n=[{},{id:"p"+t+"-moves",max:a.moves,key:"moves"},{id:"p"+t+"-production",max:a.production,key:"production"},{id:"p"+t+"-food",max:a.food,key:"food"},{id:"p"+t+"-culture",max:a.culture,key:"culture"}];ie.animate(n,1.5),e+='<tr class="stagBlue statRow no-pointer">'+ie.playerCell(a,t);var o=ce.player[t].playerColor;e+='<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+t+'-moves-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+t+'-moves" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+t+'-production-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+t+'-production" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+t+'-food-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+t+'-food" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+t+'-culture-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+t+'-culture" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return e},playerHead:function(e){for(var t='<tr><th style="width: 420px"></th>',a=0,n=e.length;a<n;a++)t+=4===a?'<th class="text-center statHead chat-warning">'+e[a]+"</th>":'<th class="text-center statHead">'+e[a]+"</th>";return t+='</tr><tr class="statSpacer2"></tr>'},playerCell:function(e,t){var a=ce.player[t],n=(a.playerColor,e.flag),o='<td class="stat-detail-wrap">\t\t\t<div class="statWrapper">\t\t\t\t<img class="statFlagBG" src="images/flags/'+n+'">\t\t\t</div>\t\t\t<img class="statsFlags" src="images/flags/'+n+'">\t\t\t<div class="statsPlayerWrap">\t\t\t\t<div class="statsAccount chat-warning nowrap">'+ye.governmentIcon(a);le.teamMode&&(o+='<span class="diploTeam">'+a.team+"</span>");return o+=(1===e.cpu?a.difficulty:e.account)+'</div>\t\t\t\t<div class="statsNation nowrap">'+e.nation+"</div>\t\t\t</div>\t\t</td>"},data:{},gameDuration:function(e){return ie.hours(e)+ie.minutes(e)+":"+ie.seconds(e)},hours:function(e){var t="";return e>=3600&&(t=~~(e/3600)+":"),t},minutes:function(e){var t="";return e<60?e>=3600&&(t="00:"):(t=~~(e/60%60))<10&&(t="0"+t),t},seconds:function(e){var t=~~(e%60);return t<10?"0"+t:t},get:function(){e.ajax({url:app.url+"php/stats.php"}).done(function(e){ie.data=e,ie.init(e),ie.notifyRibbons(e.ribbons),ie.notifySteam(e.ribbons)})},achievements:[],notifyRibbons:function(e){var t="";if(e.forEach(function(e){t+='<div class="ribbonName ranked">'+ce.ribbonTitle[e]+'</div>\t\t\t<div class="ribbonDescription ranked">'+ce.ribbonDescription[e]+'</div>\t\t\t<img class="giantRibbon block" src="images/ribbons/ribbon'+e+'.jpg">'}),a.getElementById("ribbonBody").innerHTML=t,ie.achievements=e,ie.achievements.length&&(new Audio("sound/ding3.mp3"),app.isApp)){var n=require("./greenworks");n.initAPI()&&n.init()}},notifySteam:function(e){if(app.isApp){var t=require("./greenworks");t.initAPI()&&(t.init(),e.forEach(function(e){t.activateAchievement("medal"+e,function(){})}))}},overviewTotal:function(e){ie.data[e];return this.unitsTotal(e)+this.structuresTotal(e)+this.weaponsTotal(e)+this.resourcesTotal(e)},unitsTotal:function(e){var t=ie.data[e];return 100*t.deployed+3*t.killed},structuresTotal:function(e){var t=ie.data[e];return 80*t.bunkers+140*t.walls+200*t.fortresses},weaponsTotal:function(e){var t=ie.data[e];return 40*t.cannons+60*t.missiles+400*t.nukes},resourcesTotal:function(e){var t=ie.data[e];return~~(t.food/20+t.culture/60+t.production/20)}},re={colors:["#ffffff","#ffaa66","#ffcc99","#ffddaa","#ffff99","#ff5555","#ffff55"],randomColor:function(){return re.colors[~~(6*t.random())]},getXY:function(e){var t=se["unit"+e].getBBox();return{x:t.x,y:t.y}},icon:{troops:{audio:"",image:"troops.png",color:"#ff0"},energy:{audio:"",image:"energy.png",color:"#ffa"},food:{audio:"",image:"food.png",color:"#b5ff00"},production:{audio:"",image:"production.png",color:"#7cf"},culture:{audio:"",image:"culture.png",color:"#d2d"},shield:{audio:"build",image:"tile-defense.png",color:"#ff0"}},upgrade:function(e,t,n){re.icon[t].audio&&ve.play(re.icon[t].audio);var i=se["unit"+e].getBBox(),r=i.x+i.width/2-10,l=i.y+i.height/2+10,s=a.createElementNS("http://www.w3.org/2000/svg","g"),c=a.createElementNS("http://www.w3.org/2000/svg","text");c.setAttributeNS(null,"x",r-10),c.setAttributeNS(null,"y",l+10),c.style.fontFamily="FontAwesome",c.style.fontSize="20px",c.style.fill=re.icon[t].color,n&&(c.textContent="+"+n);var u=a.createElementNS("http://www.w3.org/2000/svg","image");u.setAttributeNS(null,"width","3rem"),u.setAttributeNS(null,"height","3rem"),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/icons/"+re.icon[t].image),u.setAttributeNS(null,"x",r+10),u.setAttributeNS(null,"y",l-20),s.appendChild(u),s.appendChild(c),se.mapAnimations.appendChild(s),o.to([c,u],.5,{startAt:{xPercent:-50,yPercent:-50,transformOrigin:"50% 50%",alpha:1,scale:.1},scale:1,ease:d.easeOut.config(3)}),o.to([c,u],1.5,{y:"-=30"}),o.to([c,u],.5,{delay:1.5,alpha:0,onComplete:function(){s.parentNode.removeChild(s)}}),this.updateMapBars(e)},paths:function(){},rifle:function(){o.to(se.troopIcon,.05,{startAt:{x:-1,y:-2},x:1,y:2,repeat:3,yoyo:!0,ease:RoughEase.ease.config({template:r.easeNone,strength:2,points:5,taper:"none",randomize:!0,clamp:!1}),onComplete:function(){o.to(this.target,1.5,{y:0,ease:p.easeOut})}})},updateMapBars:function(t){var a=se["unit"+t].getBBox(),n=a.x+a.width/2-10,o=a.y+a.height/2+10;e(".mapBars"+t).remove(),this.initMapBars(t,n,o)},target:function(){var e={brightness:200};o.to(e,.5,{brightness:100,onUpdate:function(){re.brightness(se.targetUiWrap,e.brightness)}})},initMapBars:function(e,t,n){var o=se["unit"+e],t=o.getAttribute("x")-25,n=o.getAttribute("y")-24,i=0;ce.tiles[e].food&&(i+=6),ce.tiles[e].production&&(i+=6),ce.tiles[e].culture&&(i+=6);var r=ce.tiles[e].defense;r&&(i+=6);var l=5*ce.tiles[e].food;if(l>40&&(l=40),t+=5,i){u=a.createElementNS("http://www.w3.org/2000/svg","rect");if(u.setAttributeNS(null,"width",40),u.setAttributeNS(null,"height",i),u.setAttributeNS(null,"x",t),u.setAttributeNS(null,"y",n+26),u.setAttributeNS(null,"fill","#151515"),u.setAttributeNS(null,"stroke","#000000"),u.setAttributeNS(null,"stroke-width",1),u.setAttributeNS(null,"opacity",1),u.setAttributeNS(null,"class","mapBars"+e),se.mapBars.appendChild(u),n+=23,ce.tiles[e].food){n+=6;(u=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",t),u.setAttributeNS(null,"y1",n),u.setAttributeNS(null,"x2",t+l),u.setAttributeNS(null,"y2",n),u.setAttributeNS(null,"stroke","#b5ff00"),u.setAttributeNS(null,"stroke-width",5),u.setAttributeNS(null,"opacity",1),u.setAttributeNS(null,"class","mapBars mapBars"+e),se.mapBars.appendChild(u)}if(ce.tiles[e].production){n+=6;var s=10*ce.tiles[e].production;s>40&&(s=40);(u=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",t),u.setAttributeNS(null,"y1",n),u.setAttributeNS(null,"x2",t+s),u.setAttributeNS(null,"y2",n),u.setAttributeNS(null,"stroke","#7cf"),u.setAttributeNS(null,"stroke-width",5),u.setAttributeNS(null,"opacity",1),u.setAttributeNS(null,"class","mapBars mapBars2x mapBars"+e),se.mapBars.appendChild(u)}if(ce.tiles[e].culture){n+=6;var c=5*ce.tiles[e].culture;c>40&&(c=40);(u=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",t),u.setAttributeNS(null,"y1",n),u.setAttributeNS(null,"x2",t+c),u.setAttributeNS(null,"y2",n),u.setAttributeNS(null,"stroke","#dd22dd"),u.setAttributeNS(null,"stroke-width",5),u.setAttributeNS(null,"opacity",1),u.setAttributeNS(null,"class","mapBars mapBars"+e),se.mapBars.appendChild(u)}if(r){n+=6;var u,d=10*r;(u=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",t),u.setAttributeNS(null,"y1",n),u.setAttributeNS(null,"x2",t+d),u.setAttributeNS(null,"y2",n),u.setAttributeNS(null,"stroke","#ffff00"),u.setAttributeNS(null,"stroke-width",5),u.setAttributeNS(null,"opacity",1),u.setAttributeNS(null,"class","mapBars mapBars3x mapBars"+e),se.mapBars.appendChild(u)}}},gunfire:function(e,n,o){var i=se["unit"+e].getBBox(),r=se["unit"+n].getBBox(),l=~~(9*t.random()),c=[.6,.6,.43,.43,.43,.43,.9,.43,.76,.43];o&&(ve.play("machine"+l,null,o),ce.tiles[e].player===ue.player&&re.rifle());for(var u=0;u<30;u++)!function(){var e=a.createElementNS("http://www.w3.org/2000/svg","path"),n=r.x+50*t.random(),o=r.y+50*t.random(),d=i.x+~~(16*t.random())-8,p=i.y+~~(16*t.random())-8,m=t.random()>.5?"M "+d+","+p+" "+n+","+o:"M "+n+","+o+" "+d+","+p;e.setAttributeNS(null,"stroke",re.randomColor()),e.setAttributeNS(null,"stroke-width",1),se.world.appendChild(e),TweenLite.to(e,.1,{delay:u/30*c[l],startAt:{attr:{d:m},drawSVG:"0%"},drawSVG:"0% 100%",ease:s.easeIn,onComplete:function(){TweenLite.to(e,.15,{drawSVG:"100% 100%",ease:s.easeOut,onComplete:function(){this.target.parentNode.removeChild(this.target)}})}}),u%8==0?re.flash({d:.1,scale:2,x:n-100,y:o-100}):u%8==4&&re.flash({d:.15,scale:1,x:d-100,y:p-100})}()},flash:function(e){var t=a.createElementNS("http://www.w3.org/2000/svg","image");t.setAttributeNS(null,"width","200px"),t.setAttributeNS(null,"height","200px"),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/flash.png"),t.setAttributeNS(null,"class","no-pointer"),t.setAttributeNS(null,"x",e.x),t.setAttributeNS(null,"y",e.y),se.world.appendChild(t),TweenLite.to(t,e.d,{startAt:{transformOrigin:"50% 50%",scale:e.scale},scale:0,onComplete:function(){this.target.parentNode.removeChild(this.target)}})},flashNuke:function(e){var t=a.createElementNS("http://www.w3.org/2000/svg","image");t.setAttributeNS(null,"width","200px"),t.setAttributeNS(null,"height","200px"),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/flash.png"),t.setAttributeNS(null,"class","no-pointer"),t.setAttributeNS(null,"x",e.x),t.setAttributeNS(null,"y",e.y),se.world.appendChild(t),TweenLite.to(t,e.d,{startAt:{transformOrigin:"50% 50%",scale:0},scale:e.scale,onComplete:function(){this.target.parentNode.removeChild(this.target)}}),TweenLite.to(t,e.d-1.8,{delay:1.8,opacity:0})},cannons:function(e,n,o,i,r){var l=se["unit"+e].getBBox(),s=se["land"+n].getBBox(),c=se["unit"+n].getBBox();if(i=i===G?.08:i,ce.tiles[e].player===ue.player||ce.tiles[n].player===ue.player){var u=~~(3*t.random());o&&ve.play("grenade"+[5,6,8][u])}for(var d=l.x+.5*l.width,p=l.y+.5*l.height,m=.5*s.width,g=m/2,f=.5*s.height,y=f/2-10,v=0;v<20;v++)!function(t){var n=a.createElementNS("http://www.w3.org/2000/svg","circle"),o=c.x+t.random()*m-g,l=c.y+t.random()*f-y;n.setAttributeNS(null,"cx",d),n.setAttributeNS(null,"cy",p),n.setAttributeNS(null,"r",4),n.setAttributeNS(null,"fill",le.color[ce.player[ce.tiles[e].player].playerColor]),n.setAttributeNS(null,"class","no-pointer"),n.setAttributeNS(null,"stroke",re.randomColor()),n.setAttributeNS(null,"strokeWidth",1),se.mapAnimations.appendChild(n),TweenLite.to(n,i,{delay:.0125*v,startAt:{alpha:1},attr:{cx:o,cy:l},ease:Linear.easeNone,onComplete:function(){var e=.5*t.random()+.3,a=r===G?e/2:r,i=10*e+3;TweenLite.to(n,a,{startAt:{fill:"none",strokeWidth:0,attr:{r:0}},strokeWidth:i,attr:{r:i/2},ease:Linear.easeNone,onComplete:function(){v%2==0&&re.flash({d:.25,scale:1,x:o-100,y:l-100}),TweenLite.to(n,a,{attr:{r:i},strokeWidth:0,ease:h.easeOut}),TweenLite.to(n,a,{alpha:0,onComplete:function(){this.target.parentNode.removeChild(this.target)},ease:h.easeOut})}})}}),0===v&&re.flash({d:1,scale:2,x:d-100,y:p-100})}(t);re.smoke(n,c.x,c.y,.8)},missile:function(e,n,i){i&&ve.play("missile7");var r=se["unit"+e],l=r.getBBox(),c=l.x+l.width/2,u=l.y+l.height/2,d=se["unit"+n],p=d.getBBox(),m=p.x+p.width/2,g=p.y+p.height/2;ue.motionPath[0]=1*r.getAttribute("x")-10,ue.motionPath[1]=1*r.getAttribute("y")-10,ue.motionPath[4]=1*d.getAttribute("x")-10,ue.motionPath[5]=1*d.getAttribute("y")-10,ue.motionPath[2]=(ue.motionPath[0]+ue.motionPath[4])/2,ue.motionPath[3]=(ue.motionPath[1]+ue.motionPath[5])/2-t.abs(c-m)/3,o.set(se.motionPath,{attr:{d:"M "+ue.motionPath[0]+","+ue.motionPath[1]+" "+ +ue.motionPath[4]+" "+ue.motionPath[5]}});var f=a.createElementNS("http://www.w3.org/2000/svg","image");f.setAttributeNS(null,"width","200px"),f.setAttributeNS(null,"height","200px"),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/flash-orange.png"),f.setAttributeNS(null,"class","no-pointer"),f.setAttributeNS(null,"x",c),f.setAttributeNS(null,"y",u),se.mapAnimations.appendChild(f),TweenLite.to(f,1,{startAt:{xPercent:-50,yPercent:-50},x:m-c-24,y:g-u-24,ease:s.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}});var y=a.createElementNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"cx",c),y.setAttributeNS(null,"cy",u),y.setAttributeNS(null,"r",12),y.setAttributeNS(null,"fill",le.color[ce.player[ce.tiles[e].player].playerColor]),y.setAttributeNS(null,"stroke","#ffddaa"),y.setAttributeNS(null,"stroke-width",2),y.setAttributeNS(null,"class","no-pointer"),se.mapAnimations.appendChild(y);var h=0;o.to(y,.1,{attr:{r:3},repeat:-1}),TweenLite.to(y,1,{startAt:{alpha:1,xPercent:-50,yPercent:-50},attr:{cx:m,cy:g},ease:s.easeIn,onUpdate:function(){if(++h%2==0){var e=a.createElementNS("http://www.w3.org/2000/svg","image");e.setAttributeNS(null,"height",40),e.setAttributeNS(null,"width",40),e.setAttributeNS(null,"opacity",1),e.setAttributeNS(null,"x",y.getAttribute("cx")-10),e.setAttributeNS(null,"y",y.getAttribute("cy")-10),e.setAttributeNS(null,"class","no-pointer"),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/smoke.png"),se.mapAnimations.appendChild(e),TweenLite.to(e,.3,{startAt:{xPercent:-50,yPercent:-50,transformOrigin:"50% 50%"},scale:3,onComplete:function(){this.target.parentNode.removeChild(this.target)}}),TweenLite.to(e,.5,{alpha:0})}},onComplete:function(){this.target.parentNode.removeChild(this.target),re.missileExplosion(n,le.color[ce.player[ce.tiles[e].player].playerColor])}}),re.flash({d:1,scale:3,x:c-100,y:u-100}),re.flash({d:1,scale:3,x:c-100,y:u-100})},missileExplosion:function(e,n){var i=se["unit"+e].getBBox(),r=~~(3*t.random());ve.play("grenade"+[5,6,8][r]);for(var c=0,d=0,p=0;p<5;p++)!function(e){re.flash({d:.5,scale:3,x:c-100,y:d-100}),re.flash({d:.5,scale:2,x:c-100,y:d-100});var t=a.createElementNS("http://www.w3.org/2000/svg","circle");c=i.x+60*e.random()-30,d=i.y+60*e.random()-30,t.setAttributeNS(null,"cx",c),t.setAttributeNS(null,"cy",d),t.setAttributeNS(null,"r",0),t.setAttributeNS(null,"class","no-pointer"),t.setAttributeNS(null,"fill",n),t.setAttributeNS(null,"stroke","#ffffaa"),se.mapAnimations.appendChild(t);var r=.05*p;TweenLite.to(t,.75,{delay:r,attr:{r:32},onComplete:function(){o.to(t,1,{attr:{r:1},ease:l.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}})},ease:u.easeOut}),o.to(t,.1,{fill:"hsl(+=0%, +=0%, +="+~~(100*e.random())+"%)",repeat:-1}),TweenLite.to(t,1.75,{startAt:{alpha:1},alpha:0,ease:s.easeIn})}(t);re.smoke(e,c,d,1)},nuke:function(e,t){var n=se["unit"+e].getBBox(),i=n.x,r=n.y;shadow=a.createElementNS("http://www.w3.org/2000/svg","ellipse"),shadow.setAttributeNS(null,"cx",i),shadow.setAttributeNS(null,"cy",r),shadow.setAttributeNS(null,"rx",2),shadow.setAttributeNS(null,"ry",1),shadow.setAttributeNS(null,"fill","#000000"),shadow.setAttributeNS(null,"stroke","none"),se.mapAnimations.appendChild(shadow),o.to(shadow,1,{startAt:{opacity:.5},attr:{rx:10,ry:5},ease:l.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}});var s=a.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",i),s.setAttributeNS(null,"cy",r-A.innerHeight),s.setAttributeNS(null,"r",15),s.setAttributeNS(null,"fill",le.color[ce.player[t].playerColor]),s.setAttributeNS(null,"stroke","#ffddaa"),s.setAttributeNS(null,"class","no-pointer"),s.setAttributeNS(null,"stroke-width",2),se.mapAnimations.appendChild(s),TweenLite.to(s,.1,{attr:{r:3},ease:Linear.easeIn,repeat:-1}),TweenLite.to(s,1,{startAt:{alpha:1},attr:{cy:r},ease:l.easeIn,onComplete:function(){this.target.parentNode.removeChild(s)}}),TweenLite.to(le,1,{onComplete:function(){ve.play("bomb9"),re.screenShake(33,7,.033,1),re.sepia(),re.flashNuke({d:2.5,scale:5,opacity:0,x:i-100,y:r-100}),re.flashNuke({d:2.5,scale:4,x:i-100,y:r-100}),re.flashNuke({d:2.5,scale:3,x:i-100,y:r-100}),re.flashNuke({d:2.5,scale:2,x:i-100,y:r-100}),o.to(se.screenFlash,.05,{startAt:{opacity:.7,background:"#ffffff"},opacity:0,background:"#ff8800",ease:y.easeOut});var n=a.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",i),n.setAttributeNS(null,"cy",r),n.setAttributeNS(null,"r",1),n.setAttributeNS(null,"fill",le.color[ce.player[t].playerColor]),n.setAttributeNS(null,"stroke","#ffdd88"),n.setAttributeNS(null,"class","no-pointer"),se.mapAnimations.appendChild(n),TweenLite.to(n,1.5,{startAt:{alpha:1},attr:{r:80},onComplete:function(){o.to(n,1,{attr:{r:50},ease:l.easeIn})},ease:c.easeOut}),o.to(n,.05,{fill:"hsl(+=0%, +=0%, +=20%)",repeat:-1,yoyo:!0,ease:g.config(6)}),TweenLite.to(n,2.5,{alpha:0,ease:u.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}}),re.smoke(e,i,r),re.smoke(e,i,r),re.smoke(e,i,r),re.smoke(e,i,r)}})},sepia:function(){var e={sepia:100,brightness:200,blur:3};TweenLite.to(e,2.5,{sepia:0,brightness:100,blur:0,ease:c.easeOut,onUpdate:function(){o.set(se.worldWrap,{filter:"sepia("+e.sepia+"%) brightness("+e.brightness+"%) blur("+e.blur+"px)"})}})},smoke:function(e,t,n,o){if(t===G){var i=re.getXY(e);t=i.x,n=i.y}o===G&&(o=1.25);var r=a.createElementNS("http://www.w3.org/2000/svg","image");r.setAttributeNS(null,"width",256),r.setAttributeNS(null,"height",256),r.setAttributeNS(null,"x",t),r.setAttributeNS(null,"y",n),r.setAttributeNS(null,"opacity",0),r.setAttributeNS(null,"class","no-pointer"),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/smoke.png"),se.mapUpgrades.appendChild(r),TweenLite.to(r,3,{startAt:{alpha:1,transformOrigin:"50% 50%",xPercent:-50,yPercent:-50,scale:0},ease:u.easeOut,scale:o}),TweenLite.to(r,3,{alpha:0,onComplete:function(){this.target.parentNode.removeChild(this.target)}})},screenShake:function(e,a,n,i){var r=0;!function e(t,a,n,l,s){var c=a/2;i&&r%2==0&&--a<2&&(a=2),TweenLite.to(l,n,{x:~~(s.random()*a-c),y:~~(s.random()*a-c),onComplete:function(){o.to(l,n,{x:~~(s.random()*a-c),y:~~(s.random()*a-c),onComplete:function(){o.to(l,n,{x:~~(s.random()*a-c),y:~~(s.random()*a-c),onComplete:function(){o.to(l,n,{x:0,y:0,onComplete:function(){++r<t&&e(t,a,n,l,s)}})}})}})}})}(e,a,n,se.gameWrap,t)},selectTile:function(e,t){TweenLite.set(se["land"+e],{filter:"",fill:le.color[ce.player[ce.tiles[e].player].playerColor],stroke:ce.tiles[e].player?le.color[ce.player[ce.tiles[e].player].playerColor]:"#aaa",strokeDasharray:"none",strokeDashoffset:0,strokeWidth:1,onComplete:function(){ce.tiles[e].player&&o.set(this.target,{strokeWidth:1,stroke:"hsl(+=0%, +=0%, -=30%)"})}});var n=se["land"+t].cloneNode(!0);se.landWrap.appendChild(n),se["land"+t].parentNode.removeChild(se["land"+t]),se["land"+t]=a.getElementById("land"+t);var i=le.color[ce.player[ce.tiles[t].player?ce.tiles[t].player:ue.player].playerColor],r=le.color[ce.player[ce.tiles[t].player?ce.tiles[t].player:0].playerColor];TweenLite.set(se["land"+t],{fill:r,stroke:i,onComplete:function(){o.set(this.target,{stroke:"hsl(+=0%, +=0%, +=15)"})}}),o.to(se["land"+t],.4,{startAt:{filter:"url(#emboss)",strokeDasharray:"5,5",strokeWidth:3,strokeDashoffset:0},strokeDashoffset:10,repeat:-1,ease:Linear.easeNone})},brightness:function(e,t){TweenLite.set(e,{filter:"brightness("+t+"%)"})},muhBible:function(){var e=new i,t=new SplitText(a.getElementById("muh-bible"),{type:"words,chars"}).chars;e.staggerFromTo(t,.2,{immediateRender:!0,alpha:0},{delay:.1,alpha:1},.033)},energyBar:function(e){if(TweenLite.to(se.energyIndicator,2.7*le.speed,{startAt:{strokeDasharray:"0,100"},force3D:!0,strokeDasharray:"100,100",ease:Linear.easeNone}),TweenLite.to(se.currentYear,3,{startAt:{color:"#ff0"},color:"#fff"}),e){se.currentYear.textContent=$.transformYear(e);var t={blur:15};TweenLite.to(t,1,{blur:0,ease:Linear.easeIn,onUpdate:function(){re.blur(se.currentYear,t.blur)}})}},blur:function(e,t){TweenLite.set(e,{filter:"blur("+t+"px)"})},research:function(t){var n=a.createElement("div"),i=a.createElement("div"),r=a.createElement("div"),l=a.createElement("div"),s=a.getElementById(t.element);n.className="research-progress",i.className="research-label",i.innerHTML=t.tech,r.className="research-bar",l.className="research-bar-bg",s.parentNode.insertBefore(n,s.nextSibling),n.appendChild(i),n.appendChild(r),r.appendChild(l),o.to(l,t.duration,{startAt:{width:0},width:"100%",ease:Linear.easeIn,onComplete:function(){n.parentNode.removeChild(n),we[t.method](),"Future Tech"===t.tech&&e("#researchFutureTech").css("display","flex")}}),"Future Tech"===t.tech?e("#researchFutureTech").css("display","none"):s.parentNode.removeChild(s),e(".tooltip.in").remove()}};e.ajaxSetup({type:"POST",timeout:5e3}),o.defaultEase=Quad.easeOut;var le={cannonTimer:0,missileTimer:0,nukeTimer:0,Msg:a.getElementById("Msg"),msgTimer:new o.delayedCall(0,""),msg:function(e,t){if(e.trim()){0===t?o.set(le.Msg,{overwrite:1,startAt:{opacity:1}}):((t===G||t<2)&&(t=2),le.msgTimer.kill(),le.msgTimer=o.to(le.Msg,t,{startAt:{scaleY:1,opacity:1},onComplete:function(){le.msgClose()}})),e&&(le.Msg.innerHTML=e);var a=new i,n=new SplitText(le.Msg,{type:"words,chars"}).chars;a.staggerFromTo(n,.01,{immediateRender:!0,alpha:0},{delay:.1,alpha:1},.01)}},msgClose:function(){o.to(le.Msg,.3,{scaleY:0})},gameDuration:0,spectateStatus:0,modalSpeed:ee?0:.5,friends:[],ignore:[],color:["#02063a","#bb0000","#0077ff","#a5a500","#006000","#b06000","#33ddff","#b050b0","#5500aa","#660000","#0000bb","#663300","#33dd33","#222222","#00ff99","#ff6666","#ff00ff","#e4e4e4","#220088","#404000","#888888"],rankedMode:0,teamMode:0,joinedGame:!1,searchingGame:!1,defaultTitle:"Firmament Wars",titleFlashing:!1,name:"",password:"",speed:12,focusUpdateNationName:!1,focusGameName:!1,view:"title",resizeX:1,resizeY:1,sfxFood:!1,sfxCulture:!1,chatOn:!1,overlay:a.getElementById("overlay"),over:0,showSpectateButton:1,victory:!1,startTime:I.now(),keyLock:!1,loadAttempts:0,upgradeCost:[40,50,60],isModalOpen:!1,lock:function(e){le.overlay.style.display="block",le.overlay.style.opacity=void 0===e?0:1,le.keyLock=!0},unlock:function(e){le.overlay.style.display="none",le.overlay.style.opacity=e?0:1,le.keyLock=!1},unlockFade:function(e){e||(e=1),o.to(le.overlay,e,{startAt:{opacity:1},ease:c.easeIn,opacity:0,onComplete:function(){le.overlay.style.display="none"}})},TDC:function(){return new o.delayedCall(0,"")},screen:{resizeMap:function(){e("#mapStyle").remove();var t='<style id="mapStyle">#worldWrap{ position: absolute; top: 0%; left: 0%; width: '+le.map.sizeX/A.innerWidth*100+"%; height: "+le.map.sizeY/A.innerHeight*100+"%; }</style>";pe.head.append(t)}},mouse:{zoom:100,mouseTransX:50,mouseTransY:50},map:{sizeX:3200,sizeY:1500,name:"Earth Omega",key:"EarthOmega",tiles:85},updateUserInfo:function(){"localhost"!==n.host&&e.ajax({async:!0,type:"GET",dataType:"jsonp",url:"https://geoip-db.com/json/geoip.php?jsonp=?"}).done(function(t){t.latitude+="",t.longitude+="",le.geo=t,e.ajax({url:app.url+"php/updateUserInfo.php",data:{location:le.geo}}).done(function(){localStorage.setItem("geo",E.stringify(le.geo)),localStorage.setItem("geoSeason",1),localStorage.setItem("geoTime",I.now())})})},checkPlayerData:function(){var t=localStorage.getItem(ue.account+"_geo"),a=localStorage.getItem(ue.account+"_geoTime"),n=localStorage.getItem(ue.account+"_geoSeason");null!==a||null===n?(I.now()-a>7776e3||null===n)&&le.updateUserInfo():null===t&&le.updateUserInfo();var o=localStorage.getItem("ignore");if(null!==o)le.ignore=E.parse(o);else{app.isApp&&fe.configureNation();localStorage.setItem("ignore",E.stringify([]))}var i=1*localStorage.getItem("bible");e("#bible-status").prop("checked",!!i),ie.setBibleMode(i)},config:{audio:{musicVolume:10,soundVolume:20}},geo:{},keepAlive:function(){e.ajax({type:"GET",url:app.url+"php/keepAlive.php"}).always(function(){v(le.keepAlive,12e4)})},removeContainers:function(){e("#firmament-wars-logo-wrap, #mainWrap").remove()},notification:{},sendNotification:function(e){a.hasFocus()||"game"===le.view||"function"!=typeof Notification||Notification.requestPermission().then(function(t){if("granted"===t){var n=" says: ";if(e.flag&&(e.msg||e.message)){"chat-whisper"===e.type&&(n=" whispers: ");var o=e.account+n,i=e.flag.replace(/-/g," ")+("Nepal"===e.flag?".png":".jpg");le.notification=new Notification(o,{icon:"images/flags/"+i,tag:"Firmament Wars",body:e.msg?e.msg:e.message}),le.notification.onclick=function(){A.focus()},le.titleFlashing||(le.titleFlashing=!0,function e(t){a.hasFocus()||(a.title=t%2==0?o:le.defaultTitle,v(e,3e3,++t))}(0)),ve.play("chat")}}})},chat:function(e,t){var a={message:e,type:t};"title"===le.view?fe.chat(a):"lobby"===le.view?ye.chat(a):ce.chat(a)},getRandomFlag:function(){var e=[],a=0;for(var n in le.flagData)le.flagData[n].name.forEach(function(t){e[a++]=t});var o=e.length,i=~~(t.random()*o);return e[i]},flagData:{Africa:{group:"Africa",name:["Algeria","Botswana","Cameroon","Cape Verde","Ivory Coast","Egypt","Ghana","Kenya","Liberia","Morocco","Mozambique","Namibia","Nigeria","South Africa","Uganda"]},Asia:{group:"Asia",name:["Bangladesh","Cambodia","China","Hong Kong","India","Indonesia","Iran","Japan","Malaysia","Mongolia","Myanmar","Nepal","North Korea","Pakistan","Philippines","Singapore","South Korea","Sri Lanka","Suriname","Taiwan","Thailand","Vietnam"]},Europe:{group:"Europe",name:["Albania","Austria","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Czech Republic","Denmark","England","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Ireland","Italy","Kosovo","Latvia","Lithuania","Macedonia","Montenegro","Netherlands","Norway","Poland","Portugal","Romania","Russia","Scotland","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Ukraine","United Kingdom","Vatican City"]},Eurasia:{group:"Eurasia",name:["Armenia","Azerbaijan","Georgia","Kazakhstan","Uzbekistan"]},Historic:{group:"Historic",name:["Benin Empire","Byzantine Empire","Confederate Flag","Flanders","Gadsden Flag","Holy Roman Empire","Isle of Man","Rising Sun Flag","NSDAP Flag","NSDAP War Ensign","Ottoman Empire","Rhodesia","Shahanshahi","USSR","Veneto","Welsh"]},MiddleEast:{group:"Middle East",name:["Israel","Jerusalem","Jordan","Kurdistan","Lebanon","Palestine","Qatar","Saudi Arabia","Syria","Turkey"]},NorthAmerica:{group:"North America",name:["Bahamas","Barbados","Canada","Costa Rica","Cuba","Haiti","Honduras","Mexico","Saint Lucia","Trinidad and Tobago","United States"]},Oceania:{group:"Oceania",name:["Australia","New Zealand"]},US_States:{group:"US States",name:["Alaska","Alabama","Arkansas","Arizona","California","Maryland","Mississippi","Montana","South Carolina","Texas","Virginia"]},Miscellaneous:{group:"Miscellaneous",name:["Anarcho-Capitalist","Anarcho-Syndicalist","Cascadia","Christian","Edgemaster","European Union","High Energy","ISIS","Jefferson State","Jolly Roger","Kekistan","Northwest Front","Pan-African Flag","pol","Rainbow Flag","Sicily","United Nations"]},SouthAmerica:{group:"South America",name:["Argentina","Bolivia","Brazil","Chile","Colombia","Ecuador","Paraguay","Peru","Uruguay","Venezuela"]}},initGameCallback:function(t){app.isApp?e("#logout").remove():e("#logout").css("display","inline-block"),o.staggerTo(a.getElementsByClassName("action-btn"),.5,{startAt:{x:-30},x:0,opacity:1},.1),ue.channel=t.initChannel,e(".actionButtons").tooltip({animation:!1,placement:"left",container:"body"}),e("[title]").tooltip({animation:!1,placement:"bottom",container:"body"}),t.account?(app.account=t.account,isLoggedIn=1,e("#logout").text("Logout "+t.account),app.isApp&&e("#login-modal").remove(),fe.chat({message:"There are "+t.currentPlayers+" people playing Firmament Wars."}),a.getElementById("updateNationFlag").src="images/flags/"+t.flag,a.getElementById("selectedFlag").textContent=t.flagShort,fe.refreshGamesCallback(t.games),ue.account=t.account,ue.flag=t.flag,ue.rating=t.rating,le.checkPlayerData(),fe.friendGetCallback(t.friends),le.msgClose()):notLoggedIn();var n=a.getElementById("firmamentWarsLogo"),i={shadow:2,brightness:100};o.to(i,3,{overwrite:1,shadow:12,brightness:150,repeat:-1,yoyo:!0,ease:u.easeIn,onUpdate:function(){!function(e){n.style.filter="drop-shadow(0px 0px "+e.shadow+"px #048) brightness("+e.brightness+"%)"}(i)}}),he.init(),t.isNewAccount&&fe.configureNation()}};le.init=function(){le.lock(),app.isApp&&e("#exit-game").on("click",function(){fe.exitGame()});var t="";for(var i in le.flagData)t+="<li class='dropdown-header'>"+le.flagData[i].group+"</li>",le.flagData[i].name.forEach(function(e){t+="<li><a class='flagSelect no-select'>"+e+"</a></li>"});if(a.getElementById("flagDropdown").innerHTML=t,o.to("#title-stars-1",50,{startAt:{backgroundPosition:"0"},force3D:!0,backgroundPosition:"-1920px",repeat:-1,ease:Linear.easeNone}),o.to("#title-stars-2",75,{startAt:{backgroundPosition:"200px -200px"},backgroundPosition:"-1720px -200px",repeat:-1,ease:Linear.easeNone}),o.to("#title-stars-3",100,{startAt:{backgroundPosition:"400px -400px"},backgroundPosition:"-1520px -400px",repeat:-1,ease:Linear.easeNone}),o.to("#title-backdrop",12,{startAt:{scale:1,transformOrigin:"0% 100%"},scale:3,repeat:-1,yoyo:!0,ease:l.easeInOut}),o.to("#firmamentWarsBG",1,{startAt:{y:"-47%"},y:"-50%",onComplete:function(){o.to("#firmamentWarsBG",10,{startAt:{scale:1},scale:1.08,repeat:-1,yoyo:!0,ease:l.easeInOut})}}),app.isApp){le.lock(1),le.msg("Verifying Steam Credentials...");var r=require("./greenworks"),s={screenName:"",steamid:"",handle:0};if(r.initAPI()){r.init();var c=r.getSteamId();s.screenName=c.screenName,s.steamid=c.steamId,r.getAuthSessionTicket(function(t){s.handle=t.handle,e.ajax({type:"POST",url:app.url+"php/init-game.php",data:{screenName:s.screenName,steamid:s.steamid,ticket:t.ticket.toString("hex")}}).done(function(e){le.initGameCallback(e),r.cancelAuthTicket(s.handle)}).fail(function(e){e.responseText&&le.msg(e.responseText)})})}else le.msg("Unable to detect Steam. Please launch Steam and try again!",999)}else e.ajax({type:"POST",url:app.url+"php/init-game.php",data:{screenName:"",steamid:"",ticket:""}}).done(function(e){le.initGameCallback(e)}).fail(function(e){le.msg(e.responseText)});("localhost"===n.hostname&&"#stop"!==n.hash||localStorage.getItem("resync")&&!1!==localStorage.getItem("reload"))&&(localStorage.setItem("resync",0),e.ajax({type:"GET",url:app.url+"php/rejoinGame.php"}).done(function(e){e.gameId>0&&(ue.player=e.player,ue.playerColor=e.player,le.teamMode=e.teamMode,le.rankedMode=e.rankedMode,ue.team=e.team,ce.id=e.gameId,le.map=e.mapData,v(function(){ye.init(e),ye.join(0),H(e),ue.government=e.government,ye.updateGovernmentWindow(ue.government),he.joinGame()},111))}).fail(function(e){le.msg(e.responseText)}))}();var se,ce={name:"",tiles:[],initialized:!1,ribbonTitle:["","National Combat Medal","Tactical Nuke Recognition Award","Good Conduct Award","Patriot's Service Ribbon","Civic Service Ribbon","Bronze Meritorious Medal","Bronze Service Medal","Bronze Expeditionary Medal","Bronze Cross","Silver Cross","Golden Cross","Platinum Cross","Revolutionary Cause Award","Strategic Warfare Award","Combat Service Award","Combat Gallantry Award","Stalwart Conqueror's Medal","Dictator's Sword","King's Regalia","Archon's Scales","Divine Covenant","Emperor's Fasces","Eagle's Branch","Comrade's Sickle","Golden Expeditionary Medal","Golden Meritorious Medal","Golden Service Medal","Champion's Medal","Conqueror's Medal","Commander's Medal","Intrepid Heroism Award","Global War Expeditionary Medal","Silver Expeditionary Medal","Silver Meritorious Medal","Silver Service Medal","Engineer's Service Ribbon"],ribbonDescription:["","Established your nation","Destroyed a fortress with a nuclear weapon","Added two comrades to your friend list","Updated your national flag","Updated your nation's name","Won 10 ranked games","Won 10 team games","Won 10 FFA games","Achieved 1800+ rating","Achieved 2100+ rating","Achieved 2400+ rating","Achieved 2700+ rating","Great Revolutionary conquered a tile with 100+ units","Win a game with a 2-to-1 kill ratio","Won 10 games in a row","Won 25 games in a row","Conquered a tile with a fortress","Won a game under Despotism","Won a game as a Monarchy","Won a game as a Democracy","Won a game under Fundamentalism","Won a game under Fascism","Won a game as a Republic","Won a game under Communism","Won 500 FFA games","Won 500 ranked games","Won 500 team games","Hit top #10 on the ranked leaderboard","Hit top #100 on the ranked leaderboard","Hit top #1000 on the ranked leaderboard","Defeated the Juggernaut","Win an 8-player FFA game","Won 100 FFA games","Won 100 ranked games","Won 100 team games","Build a fortress"],toggleGameWindows:function(){var t="visible"===e("#targetWrap").css("visibility");o.set(se.gameWindows,{visibility:t?"hidden":"visible"}),t?o.to("#hotkey-ui",.5,{startAt:{opacity:0,visibility:"visible"},opacity:1}):o.to("#hotkey-ui",.5,{visibility:"hidden"})},player:[0,0,0,0,0,0,0,0,0],initMap:function(){!function(e,t){for(var a=0;a<t;a++)se["land"+a]=e.getElementById("land"+a),se["flag"+a]=e.getElementById("flag"+a),se["unit"+a]=e.getElementById("unit"+a)}(a,ce.tiles.length)},chat:function(e){for(;se.chatContent.childNodes.length>10;)se.chatContent.removeChild(se.chatContent.firstChild);var t=a.createElement("div");e.type&&(t.className=e.type),t.innerHTML=e.message,se.chatContent.appendChild(t),v(function(){t!==G&&null!==t.parentNode&&o.to(t,.125,{alpha:0,onComplete:function(){null!==t.parentNode&&t.parentNode.removeChild(t)}})},12e3)},eliminatePlayer:function(t){var a=t.player,n=0,i=0,r=[];ce.player[a].alive=!1,ce.player.forEach(function(e,t){e.account&&e.alive&&(e.cpu||(n++,-1===r.indexOf(e.team)&&r.push(e.team)),e.cpu&&i++)}),e("#diplomacyPlayer"+a).removeClass("alive"),le.teamMode?r.length<=1&&(le.showSpectateButton=0):n<=1&&(le.showSpectateButton=0),le.over||(a===ue.player?(new Audio("sound/shotgun2.mp3"),e.ajax({type:"GET",url:app.url+"php/gameDefeat.php"}).done(function(e){var t="";e.ceaseFire?t='<p>Armistice!</p>\t\t\t<div>The campaign has been suspended!</div>\t\t\t<div id="ceaseFire" class="endBtn">\t\t\t\t<div class="modalBtnChild">Cease Fire</div>\t\t\t</div>':e.gameDone&&(t="<p>Defeat!</p>\t\t\t<div>Your campaign for world domination has failed!</div>",le.showSpectateButton&&(t+='<div id="spectate" class="endBtn">\t\t\t\t\t<div class="modalBtnChild">Spectate</div>\t\t\t\t</div>'),t+='<div id="endWar" class="endBtn">\t\t\t\t<div class="modalBtnChild">Concede Defeat</div>\t\t\t</div>'),t&&W(t)}).fail(function(e){})):le.teamMode?r.length<=1&&v(function(){L()},1e3):n<=1&&!i&&v(function(){L()},1e3)),o.set("#diplomacyPlayer"+a,{autoAlpha:0,onComplete:function(){e("#diplomacyPlayer"+a).css("display","none")}}),o.set("#diplomacyPlayer"+a,0,{startAt:{transformPerspective:400,transformOrigin:"50% 0",rotationX:0},paddingTop:0,paddingBottom:0,height:0,rotationX:-90}),ce.removePlayer(a)},removePlayer:function(e){ce.tiles[e].account="",ce.tiles[e].nation="",ce.tiles[e].flag="";for(var t=0,a=ce.tiles.length;t<a;t++)ce.tiles[t].player===e&&(ce.tiles[t].account="",ce.tiles[t].defense="",ce.tiles[t].flag="",ce.tiles[t].nation="",ce.tiles[t].player=0,ce.tiles[t].units=0,ce.tiles[t].tile=t,ce.updateTile(ce.tiles[t]))},getGameState:function(){e.ajax({type:"GET",url:app.url+"php/getGameState.php"}).done(function(e){for(var t=0,a=e.tiles.length;t<a;t++){var n=e.tiles[t],i=!1;if(n.player!==ce.tiles[t].player){ce.tiles[t].units||o.set(se["unit"+t],{visibility:"visible"}),ce.tiles[t].player=n.player,ce.tiles[t].account=ce.player[n.player].account,ce.tiles[t].nation=ce.player[n.player].nation,ce.tiles[t].flag=ce.player[n.player].flag,ue.tgt===t&&(i=!0);var r=ce.player[n.player].flag?ce.player[n.player].flag:"blank.png";null!==se["flag"+t]&&(se["flag"+t].href.baseVal="images/flags/"+r),o.set(se["land"+t],{fill:le.color[ce.player[n.player].playerColor],stroke:n.player?le.color[ce.player[n.player].playerColor]:"#aaa",strokeWidth:1,onComplete:function(){n.player&&o.set(this.target,{stroke:"hsl(+=0%, +=0%, -=30%)"})}})}if(n.units!==ce.tiles[t].units){n.units,ce.tiles[t].units;ce.tiles[t].units=n.units,ue.tgt===t&&(i=!0),$.setTileUnits(t)}i&&$.showTarget(se["land"+t])}}).fail(function(e){})},updateDefense:function(e){var t=e.tile;ce.tiles[t].defense=e.defense,re.updateMapBars(t),ue.tgt===t&&$.showTarget(se["land"+ue.tgt])},updateTile:function(e){var t=1*e.tile,a=e.player,n=1e3*e.timestamp;if(!(n<ce.tiles[t].timestamp)){ce.tiles[t].player=a,ce.tiles[t].account=ce.player[a].account,ce.tiles[t].nation=ce.player[a].nation,ce.tiles[t].flag=ce.player[a].flag,ce.tiles[t].timestamp=n;var i=ce.player[a].flag?ce.player[a].flag:ce.tiles[t].units?"Player0.jpg":"blank.png";null!==se["flag"+t]&&(se["flag"+t].href.baseVal="images/flags/"+i),o.set(se["land"+t],{fill:le.color[ce.player[a].playerColor],stroke:a?le.color[ce.player[a].playerColor]:"#aaa",strokeWidth:1,onComplete:function(){a&&o.set(this.target,{stroke:"hsl(+=0%, +=0%, "+(ue.tgt===t?"+=15%)":"-=30%)")})}}),e.units?e.units!==ce.tiles[t].units&&(ce.tiles[t].units=e.units,$.setTileUnits(t)):(ce.tiles[t].units=0,o.set(se["unit"+t],{visibility:"hidden"})),ue.tgt===t&&$.showTarget(se["land"+t]),$.drawDiplomacyPanel()}},isMineOrAdjacent:function(e){if(ce.tiles[e].player===ue.player)return 1;if(!ce.tiles[e].units)return 0;var t=0;return ce.tiles[e].adj.forEach(function(e){ce.tiles[e].player===ue.player&&(t=1)}),t},setVisibilityAll:function(){ce.tiles.forEach(function(e,t){$.setUnitVisibility(t)})},setSumValues:function(){for(var e={food:0,production:0,culture:0},t=0;t<le.tileCount;t++)ue.player===ce.tiles[t].player&&(e.food+=ce.tiles[t].food,e.production+=ce.tiles[t].production,e.culture+=ce.tiles[t].culture)},energyTimer:0,startGameState:function(){ce.getGameState(),ce.energyTimer=b(ce.updateResources,1e3*le.speed),re.energyBar()},triggerNextTurn:function(e){k(ce.energyTimer),ce.energyTimer=b(ce.updateResources,1e3*le.speed),ce.updateResources()},updateResources:function(){if(!le.over){var t=0,a=0;ce.player.forEach(function(e){e.alive&&(e.cpu?xe.takeTurn(e):0===e.cpu&&(t||(t=1,e.account===ue.account&&(a=1))))}),e.ajax({url:app.url+"php/updateResources.php",data:{pingCpu:a,resourceTick:le.resourceTick}}).done(function(e){le.resourceTick=e.resourceTick,z(e),ce.reportMilestones(e),re.energyBar(e.resourceTick)}).fail(function(e){O()})}},reportMilestones:function(e){if(e.cultureMsg!==G&&e.cultureMsg){var t={message:e.cultureMsg};ce.chat(t),ve.play("culture"),ve.play("cheer3"),R()}}},ue={window:"Full Screen",lastReceivedWhisper:"",account:"",channel:"",player:0,playerColor:0,team:0,gameName:"Earth Alpha",max:8,tgt:1,lastTgt:1,capital:0,lastTarget:{},units:0,food:0,production:25,culture:0,oBonus:-1,dBonus:-1,productionBonus:-1,foodBonus:-1,cultureBonus:-1,sumProduction:10,foodMax:25,cultureMax:300,manpower:0,focusTile:0,moves:4,sumMoves:4,sumFood:0,sumProduction:0,sumCulture:0,flag:"",targetLine:[0,0,0,0,0,0],motionPath:[0,0,0,0,0,0],attackOn:!1,splitAttack:!1,splitAttackCost:1,attackCost:2,deployCost:1,rushCost:2,maxDeployment:12,cannonBonus:0,targetData:{},selectedFlag:"Default",selectedFlagFull:"Default.jpg",government:"Despotism",tech:{masonry:0,construction:0,engineering:0,gunpowder:0,rocketry:0,atomicTheory:0},hud:function(e,t){de.hud.kill(),se.hud.style.visibility="visible",se.hud.textContent=e,t&&(de.hud=o.to(se.hud,5,{onComplete:function(){se.hud.style.visibility="hidden"}}))},clearHud:function(){de.hud.kill(),se.hud.style.visibility="hidden",o.set([se.targetLine,se.targetLineBorder,se.targetLineShadow,se.targetCrosshair],{visibility:"hidden",strokeDashoffset:0}),e("#style-land-pointer").remove(),pe.head.append('<style id="style-land-pointer">.land{ cursor: pointer; }</style>')},checkSelectLastTarget:function(){ce.tiles[ue.tgt].player!==ue.player&&(ce.tiles[ue.lastTgt].player===ue.player?ue.nextTarget(!1,ue.lastTgt):ue.nextTarget(!1))},nextTarget:function(e,a){if(!le.spectateStatus){ue.lastTgt=ue.tgt;var n=0,o=ce.tiles.length;for(a===G?e?ue.tgt--:ue.tgt++:ue.tgt=a,ue.tgt<0&&(ue.tgt=o-1);n<65535&&ue.player!==ce.tiles[ue.tgt%o].player;)e?ue.tgt--:ue.tgt++,ue.tgt<0&&(ue.tgt=o-1),n++;ue.tgt=a===G?e?t.abs(ue.tgt):ue.tgt%o:a,ue.focusTile(ue.tgt,.1),re.selectTile(ue.lastTgt,ue.tgt)}},focusTile:function(e,t){var a=se["land"+e];if(null!==a){var n=a.getBBox();t===G&&(t=.5);var i=512-n.x;i>0&&(i=0);var r=-1*(le.map.sizeX-A.innerWidth);i<r&&(i=r);var l=234-n.y;l>0&&(l=0);var s=-1*(le.map.sizeY-A.innerHeight);l<s&&(l=s),o.to(se.worldWrap,t,{force3D:!1,x:i*le.resizeX,y:l*le.resizeY}),$.showTarget(se["land"+e],!1,1)}}},de={hud:le.TDC()};F();var pe={head:e("#head"),chatInputOpen:e("#chat-input-open"),chatInputWrap:e("#chat-input-wrap"),chatInput:e("#chat-input"),lobbyChatInput:e("#lobby-chat-input"),titleChatInput:e("#title-chat-input")},me=[],ge={cache:{},load:{game:function(){for(var e=["smoke.png"],t=0,a=e.length;t<a;t++){var n=e[t];ge.cache[n]=new Image,ge.cache[n].src="images/"+n}}}},fe={players:[],games:[],getLeaderboard:function(t){var n=a.getElementById("leaderboardBody");n.innerHTML="",le.lock(),e.ajax({url:app.url+"php/leaderboard.php",data:{type:t}}).done(function(e){n.innerHTML=e.str,le.unlock()})},refreshTimer:0,refreshGames:function(){I.now()-fe.refreshTimer>5e3&&(fe.refreshTimer=I.now(),le.lock(1),e("#title-chat-input").focus(),o.to("#refresh-game-button",1,{rotation:"+=360",ease:Linear.easeIn}),e.ajax({type:"GET",url:app.url+"php/refreshGames.php"}).done(function(e){fe.refreshGamesCallback(e.games)}).fail(function(e){}).always(function(){le.unlock()}))},refreshGamesCallback:function(e){var t=a.getElementById("gameTableBody");if(null!==t){for(var n="",o=0,i=e.length;o<i;o++){var r=e[o];fe.games[r.id]=1*r.players,n+="<tr id='game_"+r.id+"' class='shadow4 wars wars-"+r.gameMode+" no-select' data-name='"+r.name+"'>\t\t\t\t<td class='warCells'>"+r.name+"</td>\t\t\t\t<td class='warCells'>"+r.map+"</td>\t\t\t\t<td class='warCells'>"+r.gameMode+"</td>\t\t\t</tr>"}t.innerHTML=n}},init:void e(a).ready(function(){e("#titleChatLog").on("mousedown",function(){fe.chatDrag=!0}).on("mouseup",function(){fe.chatDrag=!1}),e("#title-chat-input").on("focus",function(){fe.chatOn=!0}).on("blur",function(){fe.chatOn=!1}),e(".createGameInput").on("focus",function(){fe.createGameFocus=!0}).on("blur",function(){fe.createGameFocus=!1}),e("#login-container").on($.click,".nw-link",function(){fe.openWindow(e(this).attr("href"))}),v(function(){le.keepAlive()},18e4)}),updateTimer:0,updatePlayers:function(t){w(fe.updateTimer),fe.titleUpdate=e("#titleChatPlayers").length,fe.titleUpdate?function a(){isLoggedIn&&"title"===le.view&&e.ajax({type:"POST",url:app.url+"php/titleUpdate.php",data:{channel:ue.channel}}).done(function(e){fe.updatePlayerCallback(e)}).always(function(){t||(fe.updateTimer=v(a,5e3))})}():e("#titleChat, #titleMenu").remove()},updatePlayerCallback:function(e){if("title"===le.view){if(e.playerData!==G){for(var t=[],n=0,o=(m=e.playerData).length;n<o;n++){var i=m[n].account,r=m[n].flag,l=m[n].rating;if(fe.players[i]===G)fe.addPlayer(i,r,l);else if(fe.players[i].flag!==r){var s=a.getElementById("titlePlayerFlag_"+i);if(null!==s){var c=r.split(".");s.className="flag "+c[0].replace(/ /g,"-")}}t.push(i)}for(var u in fe.players)if(-1===t.indexOf(u)){var d={account:u};fe.removePlayer(d)}}a.getElementById("titleChatHeaderCount").textContent=o!==G?"("+o+")":"";var p=[];if(e.gameData!==G)for(var m=e.gameData,n=0,o=m.length;n<o;n++)p[m[n].id]={players:1*m[n].players,max:1*m[n].max};fe.games.forEach(function(e,t){if(p[t]===G){a={id:t};fe.removeGame(a)}else if(p[t].players!==fe.games[t]){var a={id:t,players:p[t].players,max:p[t].max};fe.setToGame(a)}})}},addPlayer:function(e,t,n){fe.players[e]={flag:t};o=a.getElementById("titlePlayer"+e);null!==o&&o.parentNode.removeChild(o);var o;(o=a.createElement("div")).className="titlePlayer",o.id="titlePlayer"+e;var i=t.split(".");i=i[0].replace(/ /g,"-"),o.innerHTML='<div id="titlePlayerFlag_'+e+'" class="flag '+i+'"></div><span class="chat-rating">['+n+']</span> <span class="titlePlayerAccount">'+e+"</span>",e&&t&&fe.titleUpdate&&se.titleChatBody.appendChild(o)},removePlayer:function(e){delete fe.players[e.account];var t=a.getElementById("titlePlayer"+e.account);null!==t&&t.parentNode.removeChild(t)},updateGame:function(e){"addToGame"===e.type?fe.addToGame(e):"removeFromGame"===e.type?fe.removeFromGame(e):"addGame"===e.type?fe.addGame(e):"removeGame"===e.type&&fe.removeGame(e)},updatePlayerText:function(e){var t=a.getElementById("game_players_"+e);null!==t&&(t.textContent=fe.games[e])},setToGame:function(e){var t=e.id;fe.games[t]=e.players},addToGame:function(e){var t=e.id;fe.games[t]!==G?fe.games[t]+1>e.max?fe.games[t]=e.max:fe.games[t]++:fe.games[t]=1},removeFromGame:function(e){var t=e.id;fe.games[t]!==G?fe.games[t]-1<1?fe.games[t]=1:fe.games[t]--:fe.games[t]=1},addGame:function(e){fe.games[e.id]=1;var t=a.createElement("tr"),n="Ranked"===e.gameMode?"Ranked":"Team"===e.gameMode?"Team":"FFA";t.id="game_"+e.id,t.className="shadow4 wars wars-"+n+" no-select",t.setAttribute("data-name",e.name),t.innerHTML="<td class='warCells'>"+e.name+"</td>\t\t\t<td class='warCells'>"+e.map+"</td>\t\t\t<td class='warCells'>"+n+"</td>",se.gameTableBody.insertBefore(t,se.gameTableBody.childNodes[0])},removeGame:function(e){delete fe.games[e.id];var t=a.getElementById("game_"+e.id);null!==t&&t.parentNode.removeChild(t)},mapData:{EarthOmega:{name:"Earth Omega",tiles:78,players:8},France:{name:"France",tiles:81,players:8},Italy:{name:"Italy",tiles:81,players:8},Japan:{name:"Japan",tiles:47,players:3},Turkey:{name:"Turkey",tiles:75,players:7},UnitedKingdom:{name:"United Kingdom",tiles:69,players:8},UnitedStates:{name:"United States",tiles:48,players:2}},chatDrag:!1,chatOn:!1,scrollBottom:function(){fe.chatDrag||(se.titleChatLog.scrollTop=se.titleChatLog.scrollHeight)},chat:function(e){if("title"===le.view&&e.message){for(;se.titleChatLog.childNodes.length>500;)se.titleChatLog.removeChild(se.titleChatLog.firstChild);"inserted-image"===e.type&&function e(t){++t<10&&(fe.scrollBottom(),v(e,200,t))}(0);var t=a.createElement("div");e.type&&(t.className=e.type),t.innerHTML=e.message,se.titleChatLog.appendChild(t),fe.scrollBottom()}},friendGet:function(){le.friends=[],e.ajax({type:"GET",url:app.url+"php/friendGet.php"}).done(function(e){fe.friendGetCallback(e.friends)})},friendGetCallback:function(e){e.forEach(function(e){le.friends.push(e)})},toggleFriend:function(t){(t=t.trim())!==ue.account?e.ajax({url:app.url+"php/friendToggle.php",data:{account:t}}).done(function(e){"fail"===e.action?le.chat("You cannot have more than 20 friends!"):"remove"===e.action?(le.chat("Removed "+t+" from your friend list"),fe.friendGet()):"add"===e.action&&(le.chat("Added "+t+" to your friend list"),fe.friendGet())}):le.chat("You can't be friends with yourself!","chat-muted")},listIgnore:function(){var e=le.ignore.length;le.chat("<div>Ignore List ("+e+")</div>");for(var t=0;t<e;t++){var a='<div><span class="chat-muted titlePlayerAccount">'+le.ignore[t]+"</span></div>";le.chat(a)}},addIgnore:function(e){e=e.toLowerCase().trim(),le.chat("<div>Ignoring "+e+"</div>"),-1===le.ignore.indexOf(e)&&e?le.ignore.length<20?e!==ue.account?(le.ignore.push(e),localStorage.setItem("ignore",E.stringify(le.ignore)),le.chat("Now ignoring account: "+e,"chat-muted")):le.chat("<div>You can't ignore yourself!</div><img src='images/chat/random/autism.jpg'>","chat-muted"):le.chat("You cannot ignore more than 20 accounts!","chat-muted"):le.chat("Already ignoring "+e+"!","chat-muted")},removeIgnore:function(e){if((e=e.toLowerCase().trim())&&le.ignore.indexOf(e)>-1){var t=le.ignore.indexOf(e);le.ignore.splice(t,1),localStorage.setItem("ignore",E.stringify(le.ignore)),le.chat("Stopped ignoring account: "+e,"chat-muted")}else le.chat(e+" is not on your ignore list.","chat-muted")},chatReceive:function(e){if("title"===le.view)"remove"===e.type?fe.removePlayer(e):"add"===e.type?fe.addPlayer(e.account,e.flag,e.rating):e.message!==G&&fe.chat(e);else if("lobby"===le.view)"hostLeft"===e.type?ye.hostLeft():"lobby-set-cpu-difficulty"===e.type?ye.updateDifficulty(e):"updateGovernment"===e.type?ye.updateGovernment(e):"updatePlayerColor"===e.type?ye.updatePlayerColor(e):"updateTeamNumber"===e.type?ye.updateTeamNumber(e):"countdown"===e.type?ye.countdown(e):"updateLobbyPlayer"===e.type?ye.updatePlayer(e):"updateLobbyCPU"===e.type?ye.updateCPU(e):e.message!==G&&ye.chat(e);else{if("cannons"===e.type)re.cannons(e.attackerTile,e.tile,!0),ce.updateTile(e);else if("missile"===e.type)re.missile(e.attacker,e.defender,!0);else if("nuke"===e.type)v(function(){re.nuke(e.tile,e.attacker)},5e3);else if("nukeHit"===e.type)ce.updateTile(e),ce.updateDefense(e);else if("gunfire"===e.type){var t=e.player===ue.player||e.playerB===ue.player?.7:.2;re.gunfire(e.attackerTile,e.tile,t),ce.updateTile(e),e.rewardUnits&&re.upgrade(e.tile,"troops",e.rewardUnits)}else"updateTile"===e.type?(ce.updateTile(e),ce.setSumValues(),e.rewardUnits&&re.upgrade(e.tile,"troops",e.rewardUnits),"sniper0"===e.sfx&&re.upgrade(e.tile,"culture")):"food"===e.type?e.account.indexOf(ue.account)>-1&&ve.play("hup2"):"upgrade"===e.type?(ce.updateDefense(e),re.upgrade(e.tile,"shield")):"eliminated"===e.type?ce.eliminatePlayer(e):"endTurnCheck"===e.type?ce.triggerNextTurn(e):"disconnect"===e.type&&ce.eliminatePlayer(e);e.message&&("gunfire"===e.type?e.defender===ue.account&&ce.chat(e):ce.chat(e)),e.sfx&&ve.play(e.sfx)}},sendWhisper:function(t,a){var n=t.split(a)[1].split(" ").shift(),o=a.length,i=n.length,t=t.substr(o+i+1),r=ue.flag.split(".");r=r[0].replace(/ /g,"-"),e.ajax({url:app.url+"php/insertWhisper.php",data:{account:n,flag:r,playerColor:ue.playerColor,message:t,action:"send"}})},lastWhisper:{account:"",message:"",timestamp:0},receiveWhisper:function(e){"title"===le.view?fe.chat(e):"lobby"===le.view?ye.chat(e):ce.chat(e)},changeChannel:function(e,t){var a=e.split(t);he.setChannel(a[1])},who:function(t){var a=t.split("/who ");e.ajax({url:app.url+"php/whoUser.php",data:{account:a[1]}}).done(function(e){var t='<div class="who-wrap"><div class="who-wrap-left">';t+=e.str,e.account!==ue.account&&-1===le.friends.indexOf(e.account)&&(t+='<button style="pointer-events: initial" class="addFriend btn btn-xs fwBlue" data-account="'+e.account+'">Add Friend</button>'),t+='</div><div class="who-wrap-right">',t+=function(){var t="";if(e.ribbons!==G){e.ribbons.reverse();var a,n=0,o=e.ribbons.length;if(o){for(t+='<div class="ribbon-wrap">';n<o;n++)t+='<img class="pointer ribbon" data-ribbon="'+(a=e.ribbons[n])+'" src="images/ribbons/ribbon'+a+'.jpg">';t+="</div>"}}return t}()+"</div></div>",le.chat(t)}).fail(function(){le.chat("No data found.")})},help:function(){['<div class="chat-warning">Chat Commands:</div>',"<div>#channel: join channel</div>","<div>@account: whisper user</div>","<div>/ignore account: ignore account</div>","<div>/unignore account: stop ignoring account</div>","<div>/friend account: add/remove friend</div>","<div>/who account: check account info (or click account name)</div>"].forEach(function(e){fe.chat({message:e,type:"chat-muted"})})},broadcast:function(t){e.ajax({url:app.url+"php/insertBroadcast.php",data:{message:t}})},closeApp:function(){e.ajax({type:"GET",url:app.url+"php/close-app.php"}).done(function(){})},url:function(t){e.ajax({url:app.url+"php/insertUrl.php",data:{url:t}})},img:function(t){e.ajax({url:app.url+"php/insertImg.php",data:{url:t}})},video:function(t){e.ajax({url:app.url+"php/insertVideo.php",data:{url:t}})},fwpaid:function(t){e.ajax({url:app.url+"php/fwpaid.php",data:{message:t}})},addRibbon:function(t,a){e.ajax({url:app.url+"php/fw-add-ribbon.php",data:{account:t,ribbon:a}})},sendMsg:function(t){var a=pe.titleChatInput.val().trim();if(t||fe.chatOn){if(a)if("/friend"===a)fe.listFriends();else if(0===a.indexOf("/friend "))fe.toggleFriend(a.slice(8));else if(0===a.indexOf("/unignore ")){o=a.slice(10);fe.removeIgnore(o)}else if("/ignore"===a)fe.listIgnore();else if(0===a.indexOf("/ignore ")){o=a.slice(8);fe.addIgnore(o)}else if(0===a.indexOf("/join "))fe.changeChannel(a,"/join ");else if(0===a.indexOf("#"))fe.changeChannel(a,"#");else if(0===a.indexOf("/j "))fe.changeChannel(a,"/j ");else if(0===a.indexOf("/whisper "))fe.sendWhisper(a,"/whisper ");else if(0===a.indexOf("/w "))fe.sendWhisper(a,"/w ");else if(0===a.indexOf("@"))fe.sendWhisper(a,"@");else if(0===a.indexOf("/who "))fe.who(a);else if(0===a.indexOf("/broadcast "))fe.broadcast(a);else if(0===a.indexOf("/closeApp"))fe.closeApp();else if(0===a.indexOf("/url "))fe.url(a);else if(0===a.indexOf("/img "))fe.img(a);else if(0===a.indexOf("/video "))fe.video(a);else if(0===a.indexOf("/fw-paid ")){o=a.slice(8);fe.fwpaid(o)}else if(0===a.indexOf("/fw-add-ribbon ")){var n=a.split(" "),o=n[1],i=n[2];fe.addRibbon(o,i)}else"/"===a.charAt(0)&&0!==a.indexOf("/me")||"/me"===a||e.ajax({url:app.url+"php/insertTitleChat.php",data:{message:a}});pe.titleChatInput.val("")}},listFriendsThrottle:0,listFriends:function(){if(!(I.now()-fe.listFriendsThrottle<5e3)){fe.listFriendsThrottle=I.now();var t=le.friends.length;le.chat("<div>Checking friends list...</div>"),le.friends.length?e.ajax({url:app.url+"php/friendStatus.php",data:{friends:le.friends}}).done(function(e){n="<div>Friend List ("+t+")</div>";le.chat(n);for(var a=0;a<t;a++){var n="",o=e.players.indexOf(le.friends[a]);o>-1?(n+='<div><span class="chat-online titlePlayerAccount">'+le.friends[a]+"</span>","number"==typeof e.locations[o]?n+=" playing in game: "+e.locations[o]:(n+=" in chat channel: ","title"===le.view?n+='<span class="chat-online chat-join">'+e.locations[o]+"</span>":n+=e.locations[o]),n+="</div>",le.chat(n)):le.chat('<div><span class="chat-muted titlePlayerAccount">'+le.friends[a]+"</span></div>")}}):le.chat("<div>You don't have any friends! Use /friend account to add a new friend.</div>","chat-muted"),e("#title-chat-input").focus()}},showBackdrop:function(e){o.to("#titleViewBackdrop",.3,{startAt:{visibility:"visible",alpha:0},alpha:1,onComplete:function(){e!==G&&e.focus()}}),le.isModalOpen=!0;var t={blur:0};o.to(t,.3,{blur:3,onUpdate:function(){re.blur("#mainWrap, #gameWrap",t.blur)}})},toggleModal:function(){le.isModalOpen?fe.closeModal():fe.showModal()},showModal:function(){o.to("#optionsModal",le.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),fe.showBackdrop();var e={blur:0};o.to(e,.3,{blur:3,onUpdate:function(){re.blur("#mainWrap, #gameWrap",e.blur)}})},closeModal:function(){o.set(".title-modals, #titleViewBackdrop",{alpha:0,visibility:"hidden"}),le.isModalOpen=!1;var e={blur:3};o.to(e,.3,{blur:0,onUpdate:function(){re.blur("#mainWrap, #gameWrap",e.blur)}})},exitGame:function(){fe.closeGame(),nw.App.closeAllWindows()},closeGame:function(){if(app.isApp){require("nw.gui");ue.account&&he.removePlayer(ue.account),"lobby"===le.view?P():"game"===le.view&&j()}},addCpu:0,createGameFocus:!1,createGame:function(){var t=e("#gameName").val(),a=e("#gamePassword").val(),n=1*e("#gamePlayers").val(),o=le.speed;!le.rankedMode&&(t.length<4||t.length>32)?(le.msg("Game name must be at least 4-32 characters.",1),v(function(){e("#gameName").focus().select()},100)):!le.rankedMode&&(n<2||n>8||n%1!=0)?le.msg("Game must have 2-8 players.",1):fe.createGameService(t,a,fe.mapData[le.map.key].name,n,le.rankedMode,le.teamMode,o)},openWindow:function(e){app.isApp},configureNation:function(){o.to("#configureNation",le.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),fe.showBackdrop()},createGameService:function(t,a,n,o,i,r,l){le.lock(1),ve.play("click"),le.rankedMode=i,le.teamMode=r,e.ajax({url:app.url+"php/createGame.php",data:{name:t,pw:a,map:n,max:o,rating:i,teamMode:r,speed:l}}).done(function(e){he.removePlayer(ue.account),ue.player=e.player,ue.playerColor=e.playerColor,ue.team=e.team,ce.id=e.gameId,ce.name=e.gameName,ye.init(e),ye.join(),he.joinGame(),ye.styleStartGame()}).fail(function(e){le.msg(e.statusText),le.unlock(1)})},joinGame:function(){if(le.name=e("#joinGame").val(),!le.name)return le.msg("Game name is not valid!",1.5),void e("#joinGame").focus().select();le.password=e("#joinGamePassword").val(),le.lock(),ve.play("click"),e.ajax({url:app.url+"php/joinGame.php",data:{name:le.name,password:le.password}}).done(function(e){fe.joinGameCallback(e)}).fail(function(e){le.msg(e.statusText,1.5)}).always(function(){le.unlock()})},joinGameCallback:function(e){he.removePlayer(ue.account),ue.player=e.player,ue.playerColor=e.player,le.teamMode=e.teamMode,le.rankedMode=e.rankedMode,ue.team=e.team,ce.id=e.id,ce.name=e.gameName,le.map=e.mapData,ye.init(e),ye.join(),he.joinGame()},submitNationName:function(){var t=e("#updateNationName").val();le.lock(),ve.play("click"),e.ajax({url:app.url+"php/updateNationName.php",data:{name:t}}).done(function(e){le.msg("Your new nation name is: "+t)}).fail(function(e){le.msg(e.statusText)}).always(function(){le.unlock()})}};!function(){var t="";for(var n in fe.mapData)t+="<li><a class='mapSelect' href='#'>"+fe.mapData[n].name+"</a></li>";var o=a.getElementById("mapDropdown");null!==o&&(o.innerHTML=t),isLoggedIn&&e("[title]").tooltip({animation:!1})}();var ye={data:[{account:""},{account:""},{account:""},{account:""},{account:""},{account:""},{account:""},{account:""},{account:""}],startClassOn:"btn btn-md btn-block btn-responsive shadow4 lobbyButtons",startClassOff:"btn btn-md btn-block btn-responsive shadow4 lobbyButtons",totalPlayers:function(){for(var e=0,t=0,a=ye.data.length;t<a;t++)ye.data[t].account&&e++;return e},addCpuPlayer:function(){e.ajax({url:app.url+"php/cpu-add-player.php",data:{flag:le.getRandomFlag()}})},updateGovernmentWindow:function(e){var t="";"Despotism"===e?t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Despotism.png" class="fw-icon-sm">Despotism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>Free movement through own tiles</div>\t\t\t\t\t<div>Start with gunpowder</div>\t\t\t\t\t<div>Start with a bunker</div>\t\t\t\t\t<div>2x maximum army attack size</div>\t\t\t\t</div>':"Monarchy"===e?t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Monarchy.png" class="fw-icon-sm">Monarchy</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>+2 defense</div>\t\t\t\t\t<div>+1 culture from 2 food</div>\t\t\t\t\t<div>50% starting culture bonus</div>\t\t\t\t\t<div>+2 cannon damage</div>\t\t\t\t</div>':"Democracy"===e?t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Democracy.png" class="fw-icon-sm">Democracy</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>4x maximum troop deployment</div>\t\t\t\t\t<div>50% starting science bonus</div>\t\t\t\t\t<div>Reduced culture milestone requirement</div>\t\t\t\t\t<div>+3 troops when you lose a tile</div>\t\t\t\t</div>':"Fundamentalism"===e?t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Fundamentalism.png" class="fw-icon-sm">Fundamentalism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>Overrun: Instant win with 4x advantage</div>\t\t\t\t\t<div>Infiltration: -1 structure defense</div>\t\t\t\t\t<div>Fast growth: Reduced food milestone requirement</div>\t\t\t\t\t<div>+2 troop reward bonus</div>\t\t\t\t</div>':"Fascism"===e?t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Fascism.png" class="fw-icon-sm">Fascism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>+1 attack</div>\t\t\t\t\t<div>+4 attack vs barbarians</div>\t\t\t\t\t<div>Bonus troop with each deployment</div>\t\t\t\t\t<div>2x science rewards from barbarians</div>\t\t\t\t</div>':"Republic"===e?t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Republic.png" class="fw-icon-sm">Republic</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>+1 energy</div>\t\t\t\t\t<div>Combat medics heal 50% troops upon victory</div>\t\t\t\t\t<div>Start with masonry</div>\t\t\t\t\t<div>+50% plunder reward bonus from barbarians</div>\t\t\t\t</div>':"Communism"===e&&(t='<div id="lobbyGovName" class="text-primary">\t\t\t\t<img src="images/icons/Communism.png" class="fw-icon-sm">Communism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>Start with a great person</div>\t\t\t\t\t<div>+1 science from 4 food</div>\t\t\t\t\t<div>Can deploy troops to uninhabited territory</div>\t\t\t\t\t<div>2x discovered reward bonus from barbarians</div>\t\t\t\t</div>'),a.getElementById("lobbyGovernment"+ue.player).innerHTML="Random"===e?e:'<img src="images/icons/'+e+'.png" class="fw-icon-sm">'+e,a.getElementById("lobbyGovernmentDescription").innerHTML="Random"===e?'<div id="lobbyGovName" class="text-primary">Random</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>???</div>\t\t\t\t\t<div>???</div>\t\t\t\t\t<div>???</div>\t\t\t\t\t<div>???</div>\t\t\t\t</div>':t},chat:function(e){for(;se.lobbyChatLog.childNodes.length>200;)se.lobbyChatLog.removeChild(se.lobbyChatLog.firstChild);var t=a.createElement("div");e.type&&(t.className=e.type),t.innerHTML=e.message,se.lobbyChatLog.appendChild(t),ye.chatDrag||(se.lobbyChatLog.scrollTop=se.lobbyChatLog.scrollHeight)},chatDrag:!1,gameStarted:!1,chatOn:!1,sendMsg:function(t){var a=pe.lobbyChatInput.val().trim();if(t||ye.chatOn){if(a)if("/friend"===a)fe.listFriends();else if(0===a.indexOf("/friend "))fe.toggleFriend(a.slice(8));else if(0===a.indexOf("/unignore ")){n=a.slice(10);fe.removeIgnore(n)}else if("/ignore"===a)fe.listIgnore();else if(0===a.indexOf("/ignore ")){var n=a.slice(8);fe.addIgnore(n)}else 0===a.indexOf("/whisper ")?fe.sendWhisper(a,"/whisper "):0===a.indexOf("/w ")?fe.sendWhisper(a,"/w "):0===a.indexOf("@")?fe.sendWhisper(a,"@"):0===a.indexOf("/who ")?fe.who(a):"/"===a.charAt(0)&&0!==a.indexOf("/me")||e.ajax({url:app.url+"php/insertLobbyChat.php",data:{message:a}});pe.lobbyChatInput.val("")}},difficulties:["Very Easy","Easy","Normal","Hard","Very Hard","Mania","Juggernaut"],governments:["Despotism","Monarchy","Democracy","Fundamentalism","Fascism","Republic","Communism","Random"],init:function(e){if(!ye.initialized){a.getElementById("lobbyChatLog").innerHTML="You have joined the game: "+e.name,ye.sendMsg();var t=a.getElementById("lobbyGameName");if(null!==t){e.rating&&(a.getElementById("lobbyRankedMatch").style.display="block",a.getElementById("lobbyGameNameWrap").style.display="none"),t.innerHTML=e.name,a.getElementById("lobbyGameMode").textContent=e.gameMode,e.password&&(a.getElementById("lobbyGamePasswordWrap").style.display="block",a.getElementById("lobbyGamePassword").innerHTML=e.password),a.getElementById("lobbyGameMap").innerHTML=e.map,a.getElementById("lobbyGameMax").innerHTML=e.max,a.getElementById("startGame").style.display=1===e.player?"block":"none",e.startGame||(a.getElementById("mainWrap").style.display="flex");for(var n='<div id="lobbyWrap">',o=1;o<=8;o++){if(n+='<div id="lobbyRow'+o+'" class="lobbyRow">\t\t\t\t\t<div class="lobby-row-col-1">\t\t\t\t\t\t<img id="lobbyFlag'+o+'" class="lobbyFlags block center no-select" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=">\t\t\t\t\t</div>\t\t\t\t\t<div class="lobby-row-col-2 lobbyDetails">\t\t\t\t\t\t<div class="lobbyAccounts">',le.teamMode){n+='<span><div id="lobbyTeam'+o+'" data-placement="right" class="lobbyTeams dropdown-toggle pointer2" data-toggle="dropdown">',n+='<i class="fa fa-flag pointer2 lobbyTeamFlag"></i> <span id="lobbyTeamNumber'+o+'" class="lobbyTeamNumbers">'+o+"</span></div>",n+='<ul id="teamDropdown" class="dropdown-menu">\t\t\t\t\t\t\t\t\t<li class="header text-center selectTeamHeader">Team</li>';for(i=1;i<=8;i++)n+='<li class="teamChoice" data-player="'+o+'">Team '+i+"</li>";n+="</ul></span>"}if(n+='<span><i id="lobbyPlayerColor'+o+'" class="fa fa-square player'+o+" lobbyPlayer dropdown-toggle",o===ue.player&&(n+=" pointer2"),n+='" data-placement="right" data-toggle="dropdown"></i>',o===ue.player){n+='<ul id="teamColorDropdown" class="dropdown-menu">\t\t\t\t\t\t\t\t\t<li class="header text-center selectTeamHeader">Player Color</li><li id="team-color-flex">';for(var i=1;i<=20;i++)n+='<div class="pbar'+i+' playerColorChoice" data-playercolor="'+i+'"></div>';n+="</li></ul></span>"}if(n+='<span id="lobbyAccountName'+o+'" class="lobbyAccountName chat-warning"></span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div id="lobbyName'+o+'" class="lobbyNames nowrap"></div>\t\t\t\t\t</div>\t\t\t\t\t<div class="lobby-row-col-3">',o===e.player){n+='<div id="gov-dropdown-player'+o+'" class="dropdown govDropdown">\t\t\t\t\t\t\t<button class="btn btn-primary btn-responsive dropdown-toggle shadow4 fwDropdownButton" type="button" data-toggle="dropdown">\t\t\t\t\t\t\t\t<span id="lobbyGovernment'+o+'">Despotism</span>\t\t\t\t\t\t\t\t<i id="lobbyCaret'+o+'" class="fa fa-caret-down text-warning lobbyCaret"></i>\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t<ul class="governmentDropdown dropdown-menu no-select">';for(var r=0,l=ye.governments.length;r<l;r++)n+='<li class="governmentChoice"><a>'+ye.governments[r]+"</a></li>";n+="</ul>\t\t\t\t\t\t</div>"+ye.getCpuDropdown(o)}else n+='<div id="gov-dropdown-player'+o+'" class="dropdown govDropdown">\t\t\t\t\t\t\t<button style="cursor: default" class="btn btn-primary btn-responsive dropdown-toggle shadow4 fwDropdownButton fwDropdownButtonEnemy" type="button">\t\t\t\t\t\t\t\t<span id="lobbyGovernment'+o+'" class="pull-left">Despotism</span>\t\t\t\t\t\t\t\t<i id="lobbyCaret'+o+'" class="fa fa-caret-down text-disabled lobbyCaret"></i>\t\t\t\t\t\t\t</button>\t\t\t\t\t\t</div>'+ye.getCpuDropdown(o);n+="</div>\t\t\t\t\t</div>"}n+="</div>",1!==ue.player||le.rankedMode||(n+='<div id="lobby-cpu-row" class="row buffer2">\t\t\t\t\t<div class="col-xs-12">\t\t\t\t\t\t<button id="cpu-remove-player" type="button" class="btn fwBlue btn-responsive shadow4 pull-right cpu-button">\t\t\t\t\t\t\t<img src="images/icons/computer.png" class="fw-icon-sm"> Remove CPU\t\t\t\t\t\t</button>\t\t\t\t\t\t<button id="cpu-add-player" type="button" class="btn fwBlue btn-responsive shadow4 pull-right cpu-button">\t\t\t\t\t\t\t<img src="images/icons/computer.png" class="fw-icon-sm"> Add CPU\t\t\t\t\t\t</button>\t\t\t\t\t</div>\t\t\t\t</div>'),a.getElementById("lobbyPlayers").innerHTML=n,ye.updateGovernmentWindow(ue.government)}}},initialized:0,getCpuDropdown:function(e){for(var t='<div id="gov-dropdown-cpu'+e+'" class="dropdown govDropdown none">\t\t\t<button class="btn btn-primary btn-responsive dropdown-toggle shadow4 fwDropdownButton" type="button" data-toggle="dropdown">\t\t\t\t<img src="images/icons/computer.png" class="fw-icon-sm">\t\t\t\t<span id="lobby-difficulty-cpu'+e+'">Very Easy</span>\t\t\t\t<i id="lobby-caret-cpu'+e+'" class="fa fa-caret-down text-warning lobbyCaret"></i>\t\t\t</button>\t\t\t<ul class="governmentDropdown dropdown-menu no-select">',a=0,n=ye.difficulties.length;a<n;a++)t+='<li class="cpu-choice" data-player="'+e+'"><a>'+ye.difficulties[a]+"</a></li>";return t+="</ul>\t\t</div>"},join:function(t){t===G&&(t=.5),le.lock(1),le.view="lobby",fe.closeModal(),o.to("header",t,{y:"-200%",ease:Quad.easeIn}),o.to("#titleChat",t,{x:"100%",ease:Quad.easeIn}),a.getElementById("lobbyFirmamentWarsLogo").src="images/title/firmament-wars-logo-1280.png",a.getElementById("worldTitle").src="images/FlatWorld90.jpg",o.to("#titleMenu",t,{x:"-100%",ease:Quad.easeIn,onComplete:function(){o.to(["#titleMain","#logoWrap","#firmamentWarsLogoWrap"],.5,{alpha:0,onComplete:function(){e("#titleMain, #title-bg-wrap").remove(),le.unlock(1),o.fromTo("#joinGameLobby",t,{autoAlpha:0},{autoAlpha:1}),fe.addCpu&&ye.addCpuPlayer(),fe.addCpu=0}})}}),t?function t(){if("lobby"===le.view){var a=0;1===ue.player&&ye.data.forEach(function(e){e.cpu&&(a=1)}),e.ajax({url:app.url+"php/updateLobby.php",data:{pingCpu:a}}).done(function(e){if("lobby"===le.view){localStorage.setItem("reload",!0);for(var a=!1,n=1;n<=8;n++){var o=e.playerData[n];if(o!==G)o.account!==ye.data[n].account&&ye.updatePlayer(o),1===o.gameHost&&(a=!0);else if(ye.data[n].account){i={message:ye.data[n].account+" has disconnected",type:"chat-warning"};ye.chat(i);var i={player:n};ye.updatePlayer(i)}}a||ye.hostLeft(),v(t,5e3)}}).fail(function(e){O()})}}():!1!==localStorage.getItem("reload")&&J()},hostLeft:function(){v(function(){le.msg("The host has left the lobby."),v(function(){P(!0)},1e3)},500)},updatePlayer:function(t){var n=t.player;if(t.account!==G){a.getElementById("lobbyRow"+n).style.display="flex",a.getElementById("lobbyAccountName"+n).innerHTML=t.cpu?"Computer":t.account,a.getElementById("lobbyName"+n).innerHTML=t.nation;var o=t.flag;a.getElementById("lobbyFlag"+n).src="images/flags/"+o,isLoggedIn||e("#lobbyFlag"+n).attr("title",t.flag.split(".").shift()).tooltip({animation:!1,placement:"right",container:"body"}),ue.player===n&&!ee&&isLoggedIn&&(e("#lobbyPlayerColor"+n).attr("title","Select Player Color").tooltip({container:"body",animation:!1}),e("#lobbyTeam"+n).attr("title","Select Team").tooltip({container:"body",animation:!1})),ye.updateGovernment(t),ye.data[n]=t,ye.updatePlayerColor(t),a.getElementById("lobbyGovernment"+n).innerHTML=t.cpu?'<img src="images/icons/computer.png" class="fw-icon-sm">'+t.difficulty:'<img src="images/icons/Despotism.png" class="fw-icon-sm">Despotism',e("#lobbyCaret"+n).removeClass("text-warning text-disabled").addClass(ue.player===n||t.cpu&&1===ue.player?"text-warning":"text-disabled"),a.getElementById("gov-dropdown-player"+t.player).style.display=t.cpu?"none":"block",a.getElementById("gov-dropdown-cpu"+t.player).style.display=t.cpu?"block":"none"}else a.getElementById("lobbyRow"+n).style.display="none",a.getElementById("lobby-difficulty-cpu"+n).innerHTML="Very Easy",ye.data[n]={account:"",cpu:0};ye.styleStartGame()},updateTeamNumber:function(e){var t=e.player,n=a.getElementById("lobbyTeamNumber"+t);null!==n&&(n.textContent=e.team)},updatePlayerColor:function(t){var a=t.player,n=ue.player===a?"fa fa-square lobbyPlayer dropdown-toggle pointer2 player"+t.playerColor:"fa fa-square lobbyPlayer dropdown-toggle player"+t.playerColor;e("#lobbyPlayerColor"+a).removeClass().addClass(n).data("playerColor",t.playerColor),ye.data[a].playerColor=t.playerColor},updateGovernment:function(e){var t=e.player;a.getElementById("lobbyGovernment"+t).innerHTML="Random"===e.government?e.government:'<img src="images/icons/'+e.government+'.png" class="fw-icon-sm">'+e.government,ye.data[t].government=e.government},updateDifficulty:function(e){var t=e.player;a.getElementById("lobby-difficulty-cpu"+t).innerHTML=e.difficulty,ye.data[t].difficulty=e.difficulty},styleStartGame:function(){1===ue.player&&(1===ye.totalPlayers()?startGame.className=ye.startClassOff:startGame.className=ye.startClassOn)},countdown:function(t){he.unsubscribe("title:refreshGames"),ye.gameStarted||(e("#lobby-cpu-row").remove(),ye.gameStarted=!0,new Audio("sound/beepHi.mp3"),countdown.style.display="block",function e(t){countdown.textContent="Starting game in "+t--,t>=0?(ve.play("beep"),v(e,1e3,t)):(ve.play("beepHi"),ve.load.game(),ge.load.game()),1===t&&(o.to("#mainWrap",1.5,{delay:1,alpha:0,ease:Linear.easeNone,onComplete:function(){var e=1===ue.player?0:750;v(function(){J()},e),sessionStorage.setItem("gameDuration",I.now())}}),ve.fade())}(5),cancelGame.style.display="none",e("#teamDropdown").css("display","none"))},governmentIcon:function(e){var t="";return e.cpu?t+='<img src="images/icons/computer.png" class="fw-icon-sm">':t+='<img src="images/icons/'+e.government+'.png" class="fw-icon-sm">',t},startGame:function(){1===ue.player&&(ye.totalPlayers()>=2?(startGame.style.display="none",cancelGame.style.display="none",le.lock(),ve.play("click"),e.ajax({type:"GET",url:app.url+"php/startGame.php"}).fail(function(e){le.msg(e.statusText),startGame.style.display="block",cancelGame.style.display="block"}).always(function(){le.unlock()})):le.msg("You need two players to start a game! Wait for players to join or add a computer player to begin."))}},he={initialConnection:!0,removePlayer:function(e){var t={type:"remove",account:ue.account};he.zmq.publish("title:"+ue.channel,t),delete fe.players[e]},addPlayer:function(e,t){e&&(he.zmq.publish("title:"+ue.channel,{type:"add",account:ue.account,flag:ue.flag,rating:ue.rating}),fe.players[e]={flag:t})},unsubscribe:function(e){try{he.zmq.unsubscribe(e)}catch(e){}},firstInit:0,setChannel:function(t){"title"===le.view&&((t=t.trim())?he.firstInit&&t===ue.channel||(he.firstInit=1,e.ajax({type:"POST",url:app.url+"php/titleChangeChannel.php",data:{channel:t}}).done(function(e){he.removePlayer(ue.account),he.unsubscribe("title:"+ue.channel),ue.channel=e.channel;for(var t in fe.players)delete fe.players[t];e.skip=!0,e.message="You have joined channel: "+e.channel,e.type="chat-warning",fe.chat(e),he.zmq.subscribe("title:"+ue.channel,function(e,t){-1===le.ignore.indexOf(t.account)&&fe.chatReceive(t)}),he.addPlayer(ue.account,ue.flag),"title"===le.view&&(a.getElementById("titleChatHeaderChannel").textContent=e.channel,a.getElementById("titleChatBody").innerHTML=""),fe.updatePlayers(0),n.hash=ue.channel}).fail(function(){le.chat("That channel name is not valid.")})):le.chat("That channel name is not valid. Channel names may only contain alphanumeric values."))},enableWhisper:function(){var t="account:"+ue.account;he.zmq.subscribe(t,function(t,a){if(a.message)if("send"===a.action){var n=ue.flag.split(".");n=n[0].replace(/ /g,"-"),ue.lastReceivedWhisper=a.account,e.ajax({url:app.url+"php/insertWhisper.php",data:{action:"receive",flag:a.flag,playerColor:a.playerColor,account:a.account,message:a.message}}),a.type="chat-whisper",a.msg=a.message,a.message=a.chatFlag+a.account+" whispers: "+a.message,fe.receiveWhisper(a)}else a.timestamp-fe.lastWhisper.timestamp<500&&a.account===fe.lastWhisper.account&&a.message===fe.lastWhisper.message||(fe.lastWhisper.account=a.account,fe.lastWhisper.timestamp=a.timestamp,fe.lastWhisper.message=a.message,a.msg=a.message,a.message=a.chatFlag+"To "+a.account+": "+a.message,a.type="chat-whisper",fe.receiveWhisper(a))}),"localhost"!==n.host&&b(console.clear,6e5),function e(){he.zmq.publish("fw:hb",{}),v(e,2e4)}()},joinGame:function(){!function e(){he.enabled?(he.unsubscribe("title:"+ue.channel),he.unsubscribe("game:"+ce.id),he.zmq.subscribe("game:"+ce.id,function(e,t){-1===le.ignore.indexOf(t.account)&&fe.chatReceive(t)})):v(e,100)}()},enabled:!1,init:function(){he.zmq=new ab.Session("wss://"+app.socketUrl+"/wss2/",function(){he.connectionSuccess()},function(){he.reconnect()},{skipSubprotocolCheck:!0})},connectionSuccess:function(){he.enabled=!0,"title"===le.view&&(he.initialConnection&&(le.unlock(),he.zmq.subscribe("title:refreshGames",function(e,t){fe.updateGame(t)}),he.zmq.subscribe("admin:broadcast",function(e,t){t.msg?le.chat(t.msg,t.type):"close-app"===t.category&&fe.exitGame()}),he.zmq.subscribe("fw:hb",function(e,t){t.msg&&le.chat(t.msg,t.type)}),function e(){ue.account?he.enableWhisper():v(e,200)}()),he.initialConnection=!1,a.getElementById("titleChatHeaderChannel").innerHTML=ue.channel,he.setChannel(ue.channel)),"game"===le.view&&ce.getGameState()},connectionTries:0,connectionRetryDuration:100,reconnect:function(){he.enabled=!1,v(he.init,he.connectionRetryDuration)}},ve={ext:function(e){return e.canPlayType&&e.canPlayType("audio/mpeg;").replace(/no/,"")?"mp3":"ogg"}(a.createElement("audio")),on:!!a.createElement("audio").canPlayType,play:function(e,t,a){if(e)if(t)se.bgmusic.pause(),se.bgmusic.src="music/"+e+".mp3",se.bgmusic.volume=le.config.audio.musicVolume/100;else{var n=new Audio("sound/"+e+".mp3"),o=a||1;n.volume=o*(le.config.audio.soundVolume/100),n.play()}},save:function(){var e=E.stringify(le.config);localStorage.setItem("config",e)},setMusicVolume:function(e){le.config.audio.musicVolume?e||ve.pause():ve.musicStart(),se.bgmusic.volume=e/100,le.config.audio.musicVolume=e,ve.save()},setSoundVolume:function(e){le.config.audio.soundVolume=e,ve.save()},pause:function(){se.bgmusic.pause()},gameMusicInit:function(){le.config.audio.musicVolume&&(ve.pause(),se.bgmusic.loop=!1,ve.gameMusicPlayNext())},trackIndex:~~(8*t.random()),tracks:["BehindTheShield","DeceptionPoint","HeroicReturn","HeartOfChampions","LeadingTheCharge","RiseAgainstTheMachine","TheAssault","WithGreatPower"],gameMusicPlayNext:function(){ve.totalTracks=ve.tracks.length;var e=ve.tracks[++ve.trackIndex%ve.totalTracks];se.bgmusic.pause(),se.bgmusic.src="music/"+e+".mp3",se.bgmusic.volume=le.config.audio.musicVolume/100,se.bgmusic.onended=function(){ve.gameMusicPlayNext()}},fade:function(){var e={vol:le.config.audio.musicVolume/100};o.to(e,2.5,{vol:0,ease:Linear.easeNone,onUpdate:function(){se.bgmusic.volume=e.vol}})},move:function(){ve.play("march"+~~(3*t.random()))},deploy:function(){ve.play("deploy"+~~(3*t.random()))},cache:{},load:{title:function(){for(var e=["click","beep"],t=0,a=e.length;t<a;t++){var n=e[t];ve.cache[n]=new Audio("sound/"+n+".mp3")}},game:function(){for(var e=["machine0","machine1","machine2","machine3","machine4","machine5","machine6","machine7","machine8","machine9","march0","march1","march2","deploy0","deploy1","deploy2","chat","hup2","cheer3","culture","error","build","grenade5","grenade6","grenade8","missile7","bomb9","warning","research"],t=0,a=e.length;t<a;t++){var n=e[t];ve.cache[n]=new Audio("sound/"+n+".mp3")}}},musicStart:function(){"game"!==le.view?ve.play("ReturnOfTheFallen",1):ve.gameMusicPlayNext()}};ve.init=function(){var t=localStorage.getItem("config");if(null===t)ve.save();else{var a=E.parse(t);le.config.audio.musicOn===G&&(le.config.audio=a.audio)}ve.load.title(),le.config.audio.musicVolume?ve.musicStart():ve.pause();var n=!1,o=e("#musicSlider");o.length&&o.slider({min:0,max:100,formatter:function(e){return n?(ve.setMusicVolume(e),e):le.config.audio.musicVolume}}).slider("setValue",le.config.audio.musicVolume),e("#soundSlider").slider({min:0,max:100,value:le.config.audio.soundVolume,tooltip_position:"bottom",formatter:function(e){return n?(ve.setSoundVolume(e),e):le.config.audio.soundVolume}}).on("slideStop",function(e){ve.play("machine0",null,.7)}).slider("setValue",le.config.audio.soundVolume),n=!0}();var be={error:function(e){e===G&&(e="Not enough science!"),le.msg(e,1.5),ue.clearHud(),$.showTarget(se["land"+ue.tgt])},target:function(t){return ue.targetData=t,ue.checkSelectLastTarget(),ue.attackOn&&t.attackName===ue.attackName?(ue.attackOn=!1,ue.attackName="",ue.clearHud(),void $.showTarget(se["land"+ue.tgt])):ce.tiles[ue.tgt].units<t.minimum?(le.msg("You need at least "+t.minimum+" troops to attack!",1.5),void ue.clearHud()):void(ue.player===ce.tiles[ue.tgt].player&&(ue.attackOn=!0,ue.attackName=t.attackName,ue.splitAttack=t.splitAttack,ue.hud(t.hudMsg),e("#style-land-crosshair").remove(),pe.head.append('<style id="style-land-crosshair">.land{ cursor: crosshair; }</style>'),ue.targetLine[0]=1*se["unit"+ue.tgt].getAttribute("x")-10,ue.targetLine[1]=1*se["unit"+ue.tgt].getAttribute("y")-10,$.showTarget(ue.lastTarget,!0)))},attack:function(t){var a=ue.tgt,n=1*t.id.slice(4);if(ue.tgt!==n)if(-1!==ce.tiles[a].adj.indexOf(n)){if(ce.tiles[n].player===ue.player&&ce.tiles[n].units>=65535)return le.msg("That territory has the maximum number of units!",1.5),void ue.clearHud();if(ue.attackOn=!1,ue.attackName="",1===ce.tiles[ue.tgt].units)return le.msg("You need at least 2 troops to move/attack!",1.5),void ue.clearHud();if("Despotism"===ue.government&&ce.tiles[n].player===ue.player);else if(ue.moves<2&&!ue.splitAttack||ue.moves<1&&ue.splitAttack)return void be.error("Not enough energy!");$.showTarget(t),ue.clearHud(),le.teamMode&&ce.tiles[n].player&&ue.account!==ce.tiles[n].account&&ue.team===ce.player[ce.tiles[n].player].team&&le.msg("Friendly fire! That's your teammate!");var i={brightness:200},r=ue.splitAttack?"#splitAttack":"#attack";o.to(i,.5,{brightness:100,onUpdate:function(){re.brightness(r,i.brightness)}}),e.ajax({url:app.url+"php/attackTile.php",data:{attacker:a,defender:n,split:ue.splitAttack?1:0,randomTile:be.getRandomDemocracyTile(n,ce.tiles[n].player),defGovernment:ce.player[ce.tiles[n].player].government}}).done(function(e){ce.tiles[n].player!==ue.player?ce.tiles[n].units||ve.move():ve.move(),e.rewardMsg&&(ce.chat({message:'<span class="chat-news">'+e.rewardMsg+"</span>"}),z(e),e.foodReward&&e.productionReward&&e.cultureReward?(re.upgrade(n,"food",e.foodReward+"%"),v(function(){re.upgrade(n,"production",e.productionReward+"%")},500),v(function(){re.upgrade(n,"culture",e.cultureReward+"%")},1e3)):e.sumFood?re.upgrade(n,"food",e.sumFood):e.sumProduction?re.upgrade(n,"production",e.sumProduction):e.sumCulture?re.upgrade(n,"culture",e.sumCulture):e.sumMoves?re.upgrade(n,"energy",e.sumMoves):e.foodReward?re.upgrade(n,"food",e.foodReward+"%"):e.productionReward?re.upgrade(n,"production",e.productionReward+"%"):e.cultureReward&&re.upgrade(n,"culture",e.cultureReward+"%")),V(e),e.victory||$.showTarget(se["land"+a]),ce.reportMilestones(e)}).fail(function(e){be.targetNotAdjacent(e.statusText,a)})}else be.targetNotAdjacent("You can only attack adjacent territories.",a)},getRandomDemocracyTile:function(e,a){var n=[],o=0;ce.tiles.forEach(function(t,i){t.player===a&&i!==e&&(n[o++]=i)});var i=n.length;return n[~~(t.random()*i)]},targetNotAdjacent:function(e,t){ve.play("error"),le.msg(e,1.5),$.showTarget(se["land"+t])},deploy:function(){("Communism"!==ue.government||ce.tiles[ue.tgt].player||ce.tiles[ue.tgt].units)&&ue.checkSelectLastTarget();var t=ce.tiles[ue.tgt];if(ue.moves<ue.deployCost)be.error("Not enough energy!");else if(ue.manpower){if(t.units<65535){var a=ue.tgt,n={brightness:200};o.to(n,.5,{brightness:100,onUpdate:function(){re.brightness("#deploy",n.brightness)}}),e.ajax({url:app.url+"php/deploy.php",data:{target:a}}).done(function(e){ve.deploy(),ce.tiles[a].units=e.units,ue.manpower=e.manpower,z(e)}).fail(function(e){ve.play("error")}).always(function(){$.setTileUnits(a)}),o.set("#manpower",{color:"#fff"})}}else be.error("No troops available for deployment!")},rush:function(){ue.checkSelectLastTarget();var t=ce.tiles[ue.tgt],a=ue.tgt;if(ue.moves<ue.rushCost)be.error("Not enough energy!");else if(t.units<65535){var n={brightness:200};o.to(n,.5,{brightness:100,onUpdate:function(){re.brightness("#rush",n.brightness)}}),e.ajax({url:app.url+"php/rush.php",data:{target:a}}).done(function(e){ve.deploy(),V(e),ce.tiles[a].units=e.units,$.setTileUnits(a)}).fail(function(e){ve.play("error")}).always(function(e){z(e)})}},upgradeTileDefense:function(){ue.checkSelectLastTarget();var t=ce.tiles[ue.tgt],a=t.defense-t.capital?1:0;if(!(a>2))if(ue.production<le.upgradeCost[a])be.error();else{var n={brightness:200};o.to(n,.5,{brightness:100,onUpdate:function(){re.brightness("#upgradeTileDefense",n.brightness)}}),e.ajax({url:app.url+"php/upgradeTileDefense.php",data:{target:ue.tgt}}).done(function(e){U(e)}).fail(function(e){le.msg(e.statusText),ve.play("error")})}},timeoutWeaponButton:function(e,t){var n=a.getElementById(e+"Overlay"),i=a.getElementById(e+"Reload");o.set(n,{opacity:1}),o.to(i,t/1e3,{startAt:{opacity:1,width:"0%"},width:"100%",ease:Linear.easeIn,onComplete:function(){o.set(i,{opacity:0})}}),v(function(){o.set(n,{opacity:0})},t)},fireCannons:function(t){var a=I.now();if(!(a-le.cannonTimer<2e3)){var n=ue.tgt,o=1*t.id.slice(4);ue.tgt!==o&&0!==ce.tiles[ue.tgt].units&&(ue.attackOn=!1,ue.attackName="",ue.production<24?be.error():(be.timeoutWeaponButton("fireCannons",2e3),le.cannonTimer=a,ue.clearHud(),$.showTarget(se["land"+n]),e.ajax({url:app.url+"php/fireCannons.php",data:{attacker:n,defender:o}}).done(function(e){U(e)}).fail(function(e){ve.play("error"),e.statusText&&le.msg(e.statusText,1.5)})))}},launchMissile:function(t){var a=I.now();if(!(a-le.missileTimer<5e3)){var n=ue.tgt,o=1*t.id.slice(4);ue.tgt!==o&&0!==ce.tiles[ue.tgt].units&&(ue.attackOn=!1,ue.attackName="",ue.production<50?be.error():(be.timeoutWeaponButton("launchMissile",5e3),le.missileTimer=a,ue.clearHud(),$.showTarget(se["land"+n]),e.ajax({url:app.url+"php/launchMissile.php",data:{attacker:n,defender:o}}).done(function(t){t.production!==G&&U(t),v(function(){e.ajax({url:app.url+"php/launchMissileHit.php",data:{attacker:n,defender:o}}).fail(function(e){e.statusText&&le.msg(e.statusText,1.5)})},1e3)}).fail(function(e){ve.play("error"),e.statusText&&le.msg(e.statusText,1.5)})))}},launchNuke:function(t){var a=I.now();if(!(a-le.nukeTimer<3e4)){var n=ue.tgt,o=1*t.id.slice(4);ue.tgt!==o&&0!==ce.tiles[ue.tgt].units&&(ue.attackOn=!1,ue.attackName="",ue.production<150?be.error():(be.timeoutWeaponButton("launchNuke",3e4),le.nukeTimer=a,ue.clearHud(),$.showTarget(se["land"+n]),e.ajax({url:app.url+"php/launchNuke.php",data:{attacker:n,defender:o}}).done(function(t){v(function(){e.ajax({url:app.url+"php/launchNukeHit.php",data:{defender:o}})},6e3),U(t)}).fail(function(e){ve.play("error"),e.statusText&&le.msg(e.statusText,1.5)})))}},setMenu:function(){se.researchMasonry.style.display=ue.tech.masonry?"none":"flex",se.researchConstruction.style.display=ue.tech.masonry&&!ue.tech.construction?"flex":"none",se.researchEngineering.style.display=ue.tech.construction&&!ue.tech.engineering?"flex":"none",se.researchGunpowder.style.display=ue.tech.gunpowder?"none":"flex",se.researchRocketry.style.display=ue.tech.gunpowder&&!ue.tech.rocketry?"flex":"none",se.researchAtomicTheory.style.display=ue.tech.rocketry&&ue.tech.engineering&&!ue.tech.atomicTheory?"flex":"none",se.researchFutureTech.style.display=ue.tech.atomicTheory?"flex":"none",be.setBuildButton(),se.fireCannons.style.display=ue.tech.gunpowder?"flex":"none",se.launchMissile.style.display=ue.tech.rocketry?"flex":"none",se.launchNuke.style.display=ue.tech.atomicTheory?"flex":"none"},setBuildButton:function(){var e=ce.tiles[ue.tgt],t=e.defense-(e.capital?1:0),a="none";ue.tech.masonry&&e.player===ue.player&&(0===t||1===t&&ue.tech.construction||2===t&&ue.tech.engineering)&&(a="flex"),se.upgradeTileDefense.style.display=a}};e("#gameWrap").on($.click,"#attack",function(){var e=new Q({});be.target(e)}).on($.click,"#deploy",function(){be.deploy()}).on($.click,"#splitAttack",function(){var e=new Q({cost:1,attackName:"splitAttack",hudMsg:"Split Attack: Select Target",splitAttack:!0});be.target(e)}).on($.click,"#rush",function(){be.rush()}).on($.click,"#upgradeTileDefense",function(){be.upgradeTileDefense()}).on($.click,"#researchMasonry",function(){we.masonry()}).on($.click,"#researchConstruction",function(){we.construction()}).on($.click,"#researchGunpowder",function(){we.gunpowder()}).on($.click,"#researchEngineering",function(){we.engineering()}).on($.click,"#researchRocketry",function(){we.rocketry()}).on($.click,"#researchAtomicTheory",function(){we.atomicTheory()}).on($.click,"#researchFutureTech",function(){we.futureTech()}).on($.click,"#fireCannons",function(){var e=new Q({cost:0,minimum:0,attackName:"cannons",hudMsg:"Fire Cannons"});be.target(e)}).on($.click,"#launchMissile",function(){var e=new Q({cost:0,minimum:0,attackName:"missile",hudMsg:"Launch Missile"});be.target(e)}).on($.click,"#launchNuke",function(){var e=new Q({cost:0,minimum:0,attackName:"nuke",hudMsg:"Launch Nuclear Weapon"});be.target(e)});var we={masonry:function(){ue.production<40||e.ajax({type:"GET",url:app.url+"php/researchMasonry.php"}).done(function(e){U(e),re.research({element:"researchMasonry",duration:20,tech:"Masonry",method:"masonryDone"})})},masonryDone:function(){e.ajax({type:"GET",url:app.url+"php/researchMasonryDone.php"}).done(function(e){ue.tech.masonry=1,we.report(e,"Masonry")})},construction:function(){ue.production<60||e.ajax({type:"GET",url:app.url+"php/researchConstruction.php"}).done(function(e){U(e),re.research({element:"researchConstruction",duration:30,tech:"Construction",method:"constructionDone"})})},constructionDone:function(){e.ajax({type:"GET",url:app.url+"php/researchConstructionDone.php"}).done(function(e){ue.tech.construction=1,we.report(e,"Construction")})},gunpowder:function(){ue.production<60||e.ajax({type:"GET",url:app.url+"php/researchGunpowder.php"}).done(function(e){U(e),re.research({element:"researchGunpowder",duration:25,tech:"Gunpowder",method:"gunpowderDone"})})},gunpowderDone:function(){e.ajax({type:"GET",url:app.url+"php/researchGunpowderDone.php"}).done(function(e){ue.tech.gunpowder=1,we.report(e,"Gunpowder")})},engineering:function(){ue.production<80||e.ajax({type:"GET",url:app.url+"php/researchEngineering.php"}).done(function(e){U(e),re.research({element:"researchEngineering",duration:45,tech:"Engineering",method:"engineeringDone"})})},engineeringDone:function(){e.ajax({type:"GET",url:app.url+"php/researchEngineeringDone.php"}).done(function(e){ue.tech.engineering=1,we.report(e,"Engineering")})},rocketry:function(){ue.production<200||e.ajax({type:"GET",url:app.url+"php/researchRocketry.php"}).done(function(e){U(e),re.research({element:"researchRocketry",duration:40,tech:"Rocketry",method:"rocketryDone"})})},rocketryDone:function(){e.ajax({type:"GET",url:app.url+"php/researchRocketryDone.php"}).done(function(e){ue.tech.rocketry=1,we.report(e,"Rocketry")})},atomicTheory:function(){ue.production<500||e.ajax({type:"GET",url:app.url+"php/researchAtomicTheory.php"}).done(function(e){U(e),re.research({element:"researchAtomicTheory",duration:60,tech:"Atomic Theory",method:"atomicTheoryDone"})})},atomicTheoryDone:function(){e.ajax({type:"GET",url:app.url+"php/researchAtomicTheoryDone.php"}).done(function(e){ue.tech.atomicTheory=1,we.report(e,"Atomic Theory")})},futureTech:function(){ue.production<800||e.ajax({type:"GET",url:app.url+"php/researchFutureTech.php"}).done(function(e){U(e),re.research({element:"researchFutureTech",duration:90,tech:"Future Tech",method:"futureTechDone"})})},futureTechDone:function(){e.ajax({type:"GET",url:app.url+"php/researchFutureTechDone.php"}).done(function(e){we.report(e,"Future Tech")})},report:function(e,t){a={message:"You have finished researching "+t+"."};if(ce.chat(a),e.cultureMsg){var a={message:e.cultureMsg};ce.chat(a)}ve.play("research"),be.setMenu()}};e(A).focus(function(){a.title=le.defaultTitle,le.titleFlashing=!1,le.notification.close!==G&&le.notification.close()}),e(A).on("load",function(){v(function(){o.to("body",.3,{startAt:{display:"flex",opacity:0},opacity:1})},100),ee?(a.getElementById("worldTitle").style.display="none",o.set("#worldTitle",{xPercent:-50,yPercent:-50,top:"50%",left:"50%",width:"1600px",height:"1600px"})):o.to("#worldTitle",600,{startAt:{xPercent:-50,yPercent:-50,rotation:-360},rotation:0,repeat:-1,ease:Linear.easeNone})}).on("resize",function(){$.resizeWindow()}),function(){function i(t){var n=a.getElementById("createGameHead"),i=a.getElementById("createRankedGameHead"),r=e("#gameName"),l=a.getElementById("createGameNameWrap"),s=a.getElementById("createGamePasswordWrap"),c=a.getElementById("createGameMaxPlayerWrap");le.rankedMode=0,le.teamMode=0,"ranked"===t?(le.rankedMode=1,n.style.display="none",i.style.display="block",l.style.display="none",s.style.display="none",c.style.display="none"):(n.style.display="block",i.style.display="none",l.style.display="block",s.style.display="block",c.style.display="block"),"team"===t&&(le.teamMode=1,n.textContent="Create Team Game"),r.val("").select(),e("#gamePassword").val(""),o.to("#createGameWrap",le.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),fe.showBackdrop(r)}e("#mainWrap").on($.click,".titlePlayerAccount, .lobbyAccountName",function(){fe.who("/who "+e(this).text())}),e("#gameView").on("dragstart","img",function(e){e.preventDefault()}),e("img").on("dragstart",function(e){e.preventDefault()}),e("#logout").on($.click,function(){return function(){le.lock(),he.removePlayer(ue.account),e.ajax({type:"GET",url:app.url+"php/deleteFromFwtitle.php"});try{FB.getLoginStatus(function(e){e.authResponse&&FB.logout(function(e){})})}catch(e){}try{gapi.auth2.getAuthInstance().signOut().then(function(){})}catch(e){}localStorage.removeItem("email"),localStorage.removeItem("token"),v(function(){e.ajax({type:"GET",url:app.url+"php/logout.php"}).done(function(e){localStorage.removeItem("token"),n.reload(),le.msg("Logout successful")}).fail(function(){le.msg("Logout failed.")})},1e3)}(),!1}),e("#login").on($.click,function(){he.removePlayer(ue.account),e.ajax({type:"GET",url:app.url+"php/deleteFromFwtitle.php"})}),e("#titleMenu").on($.click,".wars",function(){var t=e(this).data("name");e("#joinGame").val(t),e("#joinGamePassword").val(""),fe.joinGame()}),e("#mainWrap").on($.click,".chat-join",function(){he.setChannel(e(this).text())}),e("#create").on($.click,function(){i("ffa")}),e("#createRankedBtn").on($.click,function(){i("ranked")}),e("#createTeamBtn").on($.click,function(){i("team")}),e("#createGame").on($.click,function(){fe.createGame()}),e("#play-now-btn").on($.click,function(){fe.addCpu=1,fe.createGameService(ue.account+"_"+~~(999999*t.random()),"","Earth Omega",8,0,0,20)}),app.isLocal||e(a).on("contextmenu",function(){return!1}),e("body").on($.click,"#options",function(){fe.showModal()}).on($.click,"#hotkeys",function(){o.to("#hotkeysModal",le.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),fe.showBackdrop()}).on($.click,"#hide-ui",function(){ce.toggleGameWindows(1)}).on($.click,"#surrender",function(e){a.getElementById("surrenderScreen").style.display="block",ve.play("click")}),e("#hotkeysDone, #optionsDone, #cancelCreateGame").on($.click,function(){fe.closeModal()}),e("#joinPrivateGameModal").on($.click,"#joinPrivateGameBtn",function(){fe.joinGame()}),e("#refresh-game-button").on($.click,function(){fe.refreshGames()}),e("#titleChat").on($.click,".nw-link",function(){fe.openWindow(e(this).attr("href"))}),e("#titleChatPlayers").on($.click,"#friend-status",function(){fe.listFriends()}).on($.click,"#ignore-status",function(){fe.listIgnore()}),e("#get-help").on($.click,function(){fe.help(),e("#title-chat-input").focus()}),e("#ignore-user").on($.click,function(){e("#title-chat-input").val("/ignore ").focus()}),e("#share-url").on($.click,function(){e("#title-chat-input").val("/url ").focus()}),e("#share-image").on($.click,function(){e("#title-chat-input").val("/img ").focus()}),e("#share-video").on($.click,function(){e("#title-chat-input").val("/video ").focus()}),e("#who-account").on($.click,function(){e("#title-chat-input").val("/who ").focus()}),e("#add-friend").on($.click,function(){e("#title-chat-input").val("/friend ").focus()}),e("#whisper-account").on($.click,function(){e("#title-chat-input").val("@").focus()}),e("#change-channel").on($.click,function(){e("#title-chat-input").val("#").focus()}),e("#body").on($.click,"#cancelGame",function(){P()}).on($.click,"#startGame",function(){ye.startGame()}).on($.click,".addFriend",function(){fe.toggleFriend(e(this).data("account"))}).on($.click,".ribbon",function(){var t=1*e(this).data("ribbon");le.chat(ce.ribbonTitle[t]+": "+ce.ribbonDescription[t],"chat-warning")}),e("#toggleNation").on($.click,function(){fe.configureNation()}),e("#joinPrivateGameBtn").on($.click,function(){var t=e("#joinGame");t.val(""),o.to("#joinPrivateGameModal",le.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1,onComplete:function(){t.focus()}}),fe.showBackdrop()}),e("#mainWrap").on($.click,".unlockGameBtn",function(){fe.closeModal(),o.to("#unlockGame",le.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),v(function(){e("#card-number").focus()},100),fe.showBackdrop()}),e("#leaderboardBtn").on($.click,function(){o.to("#leaderboard",le.modalSpeed,{startAt:{visibility:"visible",top:0,alpha:0},top:30,alpha:1}),fe.showBackdrop(),fe.getLeaderboard("Ranked")}),e("#leaderboardFFABtn").on($.click,function(){fe.getLeaderboard("FFA")}),e("#leaderboardRankedBtn").on($.click,function(){fe.getLeaderboard("Ranked")}),e("#leaderboard-trips-btn").on($.click,function(){fe.getLeaderboard("Trips")}),e("#leaderboard-quads-btn").on($.click,function(){fe.getLeaderboard("Quads")}),e("#leaderboard-pents-btn").on($.click,function(){fe.getLeaderboard("Pents")}),e("#leaderboardTeamBtn").on($.click,function(){fe.getLeaderboard("Team")}),e("#window-select-wrap").on($.click,".window-select",function(){ue.window=this.textContent.trim(),$.setWindow(ue.window)}),e("#bible-status").on($.click,function(){ie.setBibleMode(e(this).prop("checked"))}),e("#flagDropdown").on($.click,".flagSelect",function(t){ue.selectedFlag=e(this).text().trim(),ue.selectedFlagFull="Nepal"===ue.selectedFlag?ue.selectedFlag+".png":ue.selectedFlag+".jpg",e(".flagPurchaseStatus").css("display","none"),e("#updateNationFlag").attr("src","images/flags/"+ue.selectedFlagFull).css("display","block"),le.lock(1),e.ajax({url:app.url+"php/updateFlag.php",data:{flag:ue.selectedFlagFull}}).done(function(t){ue.flag=ue.selectedFlagFull,e(".nationFlag").attr({src:"images/flags/"+ue.selectedFlagFull,title:ue.selectedFlag}),le.msg("Your nation's flag is now: "+ue.selectedFlag),a.getElementById("selectedFlag").textContent=ue.selectedFlag,e("[title]").tooltip("fixTitle").tooltip({animation:!1})}).always(function(){le.unlock(1),o.to("#updateNationFlag",1,{startAt:{alpha:0},alpha:1})}),t.preventDefault()}),e("#submitNationName").on("mousedown",function(){fe.submitNationName()}),e("#updateNationName").on("focus",function(){le.focusUpdateNationName=!0}).on("blur",function(){le.focusUpdateNationName=!1}),e("#refreshGameWrap").on("focus","#gameName",function(){le.focusGameName=!0}),e("#refreshGameWrap").on("blur","#gameName",function(){le.focusGameName=!1}),e("#titleViewBackdrop, .close-btn").on($.click,function(){fe.closeModal()}),e("#mainWrap").on($.click,"#unlockGameDone, #configureNationDone, #leaderboardDone",function(){ve.play("click"),fe.closeModal()}),e("#joinRankedGame").on($.click,function(){ve.play("click"),le.lock(1),le.searchingGame=!0,le.msg("Searching for ranked games...",0),function t(a){a<4&&!le.joinedGame?(v(function(){le.searchingGame&&t(++a)},1e3),e.ajax({url:app.url+"php/joinRankedGame.php"}).done(function(e){le.searchingGame&&(o.set(se.Msg,{opacity:0}),le.joinedGame=1,le.unlock(),le.searchingGame=!1,fe.joinGameCallback(e))})):!le.joinedGame&&le.searchingGame&&(le.msg("No ranked games found!<br>Try creating a ranked game instead.",5),le.unlock(),le.searchingGame=!1)}(0)})}(),e("#chat-input-open").on($.click,function(){Z()}),e("#chat-input-send").on($.click,function(){Z(!0)}),e("#lobby-chat-input").on("focus",function(){ye.chatOn=!0}).on("blur",function(){ye.chatOn=!1}),e("#lobbyChatSend").on($.click,function(){ye.sendMsg(!0)}),e("#lobbyChatLog").on("mousedown",function(){ye.chatDrag=!0}).on("mouseup",function(){ye.chatDrag=!1}),e("#joinGameLobby").on($.click,".governmentChoice",function(t){var a=e(this).text();ye.updateGovernmentWindow(a),e.ajax({url:app.url+"php/changeGovernment.php",data:{government:a}})}).on($.click,".cpu-choice",function(t){var a=e(this).text();e.ajax({url:app.url+"php/change-cpu-difficulty.php",data:{difficulty:a,player:e(this).data("player")}})}).on($.click,".playerColorChoice",function(t){var a=e(this).data("playercolor");e.ajax({url:app.url+"php/changePlayerColor.php",data:{playerColor:1*a}}).done(function(e){ue.playerColor=e.playerColor}).fail(function(e){le.msg(e.statusText,1.5)})}).on($.click,".teamChoice",function(){var t=e(this).text().slice(5),a=e(this).data("player");e.ajax({url:app.url+"php/changeTeam.php",data:{team:t,player:a}}).done(function(e){ue.player===1*e.player&&(ue.team=e.team)})}).on($.click,"#cpu-add-player",function(e){ve.play("click"),ye.addCpuPlayer()}).on($.click,"#cpu-remove-player",function(t){ve.play("click"),e.ajax({url:app.url+"php/cpu-remove-player.php"})}),ae?(e("body").on("DOMMouseScroll",function(e){"game"===le.view&&(_(e.originalEvent.layerX,e.originalEvent.layerY),me[0].applyBounds())}),e("#worldWrap").on("DOMMouseScroll",function(e){e.originalEvent.detail>0?K():X(),me[0].applyBounds()})):(e("body").on("mousewheel",function(e){"game"===le.view&&(_(e.offsetX,e.offsetY),me[0].applyBounds())}),e("#worldWrap").on("mousewheel",function(e){e.originalEvent.wheelDelta>0?X():K(),me[0].applyBounds()})),e("#worldWrap").on("mousemove",function(e){ae?_(e.originalEvent.layerX,e.originalEvent.layerY):_(e.offsetX,e.offsetY)}),e("#createGameWrap").on($.click,".mapSelect",function(t){var n=e(this).text(),o=n.replace(/ /g,"");le.map.name=n,le.map.key=o,a.getElementById("createGameMap").innerHTML=n,a.getElementById("createGamePlayers").innerHTML=fe.mapData[o].players;var i=e("#gamePlayers");i.attr("max",fe.mapData[o].players),1*i.val()>fe.mapData[o].players&&i.val(fe.mapData[o].players),t.preventDefault()}),e("#mainWrap").on($.click,".gameSelect",function(e){e.preventDefault()}),e("#bgmusic").on("ended",function(){var e=a.getElementById("bgmusic");e.currentTime=0,e.play()}),e("#bgamb1").on("ended",function(){var e=a.getElementById("bgamb1");e.currentTime=0,e.play()}),e("#bgamb2").on("ended",function(){var e=a.getElementById("bgamb2");e.currentTime=0,e.play()}),e("#cancelSurrenderButton").on($.click,function(){ve.play("click"),a.getElementById("surrenderScreen").style.display="none"}),e("#surrenderButton").on($.click,function(){j()});if(e(a).on("keydown",function(t){var a=t.keyCode;if(t.ctrlKey){if(82===a)return!1}else"title"===le.view?(!le.isModalOpen&&isLoggedIn&&e("#title-chat-input").focus(),27===a&&fe.toggleModal()):"lobby"===le.view?(e("#lobby-chat-input").focus(),27===a&&fe.toggleModal()):9===a?(t.shiftKey?ue.nextTarget(!0):ue.nextTarget(!1),t.preventDefault()):86===a?"game"!==le.view||le.chatOn||ce.toggleGameWindows(1):27===a&&!ue.attackOn&&!le.chatOn&&fe.toggleModal()}).on("keyup",function(t){a=t.keyCode;if("title"===le.view)13===a&&(le.focusUpdateNationName?fe.submitNationName():le.focusGameName?fe.createGame():fe.chatOn?13===a&&fe.sendMsg():fe.createGameFocus&&fe.createGame());else if("lobby"===le.view)ye.chatOn&&13===a&&ye.sendMsg();else if("game"===le.view)if(le.chatOn)13!==a&&27!==a||Z(!0);else if(13===a)Z();else if(27===a)ue.attackOn&&(ue.attackOn=!1,ue.attackName="",ue.clearHud(),$.showTarget(se["land"+ue.tgt]));else if(65===a){n=new Q;be.target(n)}else if(83===a){n=new Q({cost:1,attackName:"splitAttack",hudMsg:"Split Attack: Select Target",splitAttack:!0});be.target(n)}else if(68===a)le.keyLock||be.deploy();else if(82===a){if(!le.keyLock){if(t.ctrlKey){var a;return(a=ue.lastReceivedWhisper)&&("title"===le.view?e("#title-chat-input").val("/w "+a+" ").focus():"lobby"===le.view?e("#lobby-chat-input").val("/w "+a+" ").focus():(le.chatOn||Z(),e("#chat-input").val("/w "+a+" ").focus())),!1}be.rush()}}else if(89===a)we.masonry();else if(79===a)we.construction();else if(69===a)we.engineering();else if(71===a)we.gunpowder();else if(75===a)we.rocketry();else if(84===a)we.atomicTheory();else if(70===a)we.futureTech();else if(66===a)be.upgradeTileDefense();else if(67===a){n=new Q({cost:0,minimum:0,attackName:"cannons",hudMsg:"Fire Cannons"});be.target(n)}else if(77===a){n=new Q({cost:0,minimum:0,attackName:"missile",hudMsg:"Launch Missile"});be.target(n)}else if(78===a){var n=new Q({cost:0,minimum:0,attackName:"nuke",hudMsg:"Launch Nuclear Weapon"});be.target(n)}}),e("#dictatorAvatar").on("change",function(t){function n(e){o.html(e),ve.play("error")}var o=e("#uploadErr"),i=t.target.files[0],r=new FileReader;r.readAsDataURL(i),"image/jpeg"!==i.type?n("Wrong file type! Image must be in jpg format."):r.addEventListener("load",function(){r.result.length<7e4?e.ajax({url:app.url+"php/uploadDictator.php",type:"POST",data:{uri:r.result},beforeSend:function(){o.text("")}}).done(function(e){o.text("Avatar updated successfully!"),a.getElementById("configureAvatarImage").src=r.result}).fail(function(e){n(e.statusText)}):(n("File size too large! Image must be less than 40 kb."),o.html())},!1)}),app.isApp){var ke=require("nw.gui");win=ke.Window.get(),win.on("close",function(){this.hide(),fe.closeGame(),this.close(!0)})}var xe={structureDefense:[1,1.5,2,2.5,3],scoreTargetAttack:function(e){var a=50;return le.teamMode?ce.player[e.attacker].team===ce.player[e.defender].team?a-=25:e.defenderUnits?0===e.defender?a+=10:ce.player[e.attacker].team!==ce.player[e.defender].team?a+=25:e.attacker===e.defender&&(a-=5):a+=50:0===e.defender?a+=50:e.attacker!==e.defender?a+=25:a-=10,e.attacker!==e.defender&&(a-=e.defenderUnits*xe.structureDefense[e.defense+e.capital],a+=~~(e.food+10*t.random()-5)),a},getAttackTarget:function(e){var t=-1,a=-1,n=0;return ce.tiles.forEach(function(o,i){if(o.player===e&&o.units>=5){var r=0;o.capital&&(r-=20),o.adj.forEach(function(l){var s=ce.tiles[l],c=xe.scoreTargetAttack({attacker:e,defender:s.player,attackerUnits:o.units,defenderUnits:s.units,unitDiff:o.units-s.units,defense:s.defense,food:s.food,production:s.production,culture:s.culture,capital:s.capital});r+c>n&&(n=c,t=i,a=l)})}}),[t,a,n]},scoreTargetWeapon:function(e){var a=50;return le.teamMode?ce.player[e.attacker].team===ce.player[e.defender].team?a-=25:0===e.defender?a-=10:ce.player[e.attacker].team!==ce.player[e.defender].team?a+=30:e.attacker===e.defender&&(a-=5):0===e.defender?a+=10:e.attacker!==e.defender?a+=25:a-=10,e.attacker!==e.defender&&(a-=e.unitDiff,a+=~~(e.food+10*t.random()-5)),a},getWeaponTarget:function(e){var t=-1,a=-1,n=0;return ce.tiles.forEach(function(o,i){o.player===e&&o.adj.forEach(function(r){var l=ce.tiles[r],s=xe.scoreTargetWeapon({attacker:e,defender:l.player,attackerUnits:o.units,unitDiff:o.units-l.units,defense:l.defense,food:l.food,production:l.production,culture:l.culture,capital:l.capital});s>n&&(n=s,t=i,a=r)})}),[t,a,n]},getRangedWeaponTarget:function(e){var t=-1,a=-1,n=0;return ce.tiles.forEach(function(o,i){if(o.player!==e){var r=50;le.teamMode&&ce.player[o.player].team===ce.player[e].team?r-=25:(r+=o.units,r+=20*o.defense,o.capital&&(r+=5),o.player||(r=0)),r>n&&(n=r,a=i)}else t=i}),[t,a,n]},attack:function(t){var a=xe.getAttackTarget(t.player);a[0]>-1&&e.ajax({url:app.url+"php/attack-ai.php",data:{attacker:a[0],defender:a[1],player:t.player,randomTile:be.getRandomDemocracyTile(a[1],ce.tiles[a[1]].player),defGovernment:ce.player[ce.tiles[a[1]].player].government}})},scoreTargetDeploy:function(e){var a=50;return e.player?e.sameTeam?e.sameTeam&&(a-=10):(a+=10,e.player&&!e.unitDiff&&(a+=-1*e.unitDiff)):a+=20,a+=~~(6*t.random()-3)},getDeployTarget:function(e){var t=-1,a=le.team?ce.player[e].team:0,n=0;return ce.tiles.forEach(function(o,i){var r=ce.tiles[i].units,l=0,s=0,c=0,u=o.defense+(o.capital?1:0);if(o.player===e&&o.units<65535&&o.flag){o.capital&&r<24&&(s+=20),o.adj.forEach(function(t){c++;var n=ce.tiles[t];n.sameTeam=le.teamMode?a===ce.player[n.player].team:e===n.player,n.unitDiff=r-n.units,n.cpuUnits=r,n.tileDefense=u,l+=xe.scoreTargetDeploy(n)});var d=s+~~(l/c);d>n&&(n=d,t=i)}}),t},getDefenseTarget:function(e){var t=-1,a=0;return ce.tiles.forEach(function(n,o){var i=0;n.player===e&&n.units<65535&&n.flag&&(i+=n.units,(i+=10*(3-n.defense))>a&&(a=i,t=o))}),t},deploy:function(t,a){var n=xe.getDeployTarget(t.player);n!==G&&e.ajax({url:app.url+"php/deploy-ai.php",data:{tile:n,food:a.food}})},getResourceTotal:function(e){var t={food:0,production:0,culture:0};return ce.tiles.forEach(function(a){e===a.player&&(t.food+=a.food,t.production+=a.production,t.culture+=a.culture)}),t},weaponDelay:function(){return 11e3*t.random()+1e3},fireCannons:function(t){var a=xe.getWeaponTarget(t.player);a[0]>-1&&e.ajax({url:app.url+"php/ai-fireCannons.php",data:{attacker:a[0],defender:a[1]}})},launchMissile:function(t){var a=xe.getRangedWeaponTarget(t.player);a[0]>-1&&e.ajax({url:app.url+"php/ai-launchMissile.php",data:{attacker:a[0],defender:a[1]}}).done(function(){v(function(){e.ajax({url:app.url+"php/ai-launchMissileHit.php",data:{account:t.account,attacker:a[0],defender:a[1]}})},1e3)})},launchNuke:function(t){var a=xe.getRangedWeaponTarget(t.player);a[0]>-1&&e.ajax({url:app.url+"php/ai-launchNuke.php",data:{attacker:a[0],defender:a[1]}}).done(function(){v(function(){e.ajax({url:app.url+"php/ai-launchNukeHit.php",data:{account:t.account,defender:a[1]}})},6e3)})},upgradeTileDefense:function(t){var a=xe.getDefenseTarget(t.player);a>-1&&e.ajax({url:app.url+"php/ai-upgradeTileDefense.php",data:{target:a,account:t.account}})},deployRate:{VeryEasy:6,Easy:5,Normal:4,Hard:4,VeryHard:3,Mania:2,Juggernaut:1},deployFood:{VeryEasy:50,Easy:40,Normal:30,Hard:22,VeryHard:15,Mania:10,Juggernaut:5},attackFood:{VeryEasy:40,Easy:30,Normal:50,Hard:40,VeryHard:30,Mania:20,Juggernaut:10},attackMax:{VeryEasy:2,Easy:3,Normal:3,Hard:4,VeryHard:5,Mania:6,Juggernaut:8},attackBaseTurns:{VeryEasy:0,Easy:0,Normal:1,Hard:1,VeryHard:1,Mania:2,Juggernaut:3},unlockNuke:{VeryEasy:250,Easy:150,Normal:100,Hard:90,VeryHard:80,Mania:60,Juggernaut:20},unlockMissile:{VeryEasy:100,Easy:65,Normal:50,Hard:40,VeryHard:30,Mania:20,Juggernaut:10},unlockCannons:{VeryEasy:50,Easy:30,Normal:20,Hard:15,VeryHard:10,Mania:5,Juggernaut:0},missileRate:{VeryEasy:.875,Easy:.75,Normal:.66,Hard:.6,VeryHard:.5,Mania:.33,Juggernaut:0},cannonRate:{VeryEasy:.75,Easy:.66,Normal:.5,Hard:.35,VeryHard:.2,Mania:.1,Juggernaut:0},unlockStructures:{VeryEasy:30,Easy:20,Normal:10,Hard:8,VeryHard:5,Mania:2,Juggernaut:0},updateResources:function(t,a){e.ajax({url:app.url+"php/ai-updateResources.php",data:{player:a,moves:4+~~(t.food/50),food:t.food,production:t.production,culture:t.culture}})},randomTime:function(){return t.random()*(1e3*le.speed)},takeTurn:function(e){var a=xe.getResourceTotal(e.player);if(xe.updateResources(a,e.player),le.resourceTick%xe.deployRate[e.difficultyShort]==0){xe.deploy(e,a);(i=~~(a.food/xe.deployFood[e.difficultyShort]))>3&&(i=3);for(r=0;r<i;r++)xe.deploy(e,a)}var n=t.ceil(a.food/xe.attackFood[e.difficultyShort])+xe.attackBaseTurns[e.difficultyShort];n>xe.attackMax[e.difficultyShort]&&(n=xe.attackMax[e.difficultyShort]);for(r=0;r<n;r++)!function(e,a){v(function(){xe.attack(a)},r*(100*le.speed)+1e3*t.random()-500)}(0,e);var o=0;if(le.resourceTick>xe.unlockNuke[e.difficultyShort]&&t.random()>.95&&(o=1,v(function(){xe.launchNuke(e)},xe.weaponDelay())),!o)if(le.resourceTick>xe.unlockMissile[e.difficultyShort]){if(t.random()>xe.missileRate[e.difficultyShort])for(var i=t.ceil(a.food/60),r=0;r<i;r++)v(function(){xe.launchMissile(e)},xe.weaponDelay())}else if(le.resourceTick>xe.unlockCannons[e.difficultyShort]&&t.random()>xe.cannonRate[e.difficultyShort])for(var i=t.ceil(a.food/30),r=0;r<i;r++)v(function(){xe.fireCannons(e)},xe.weaponDelay());le.resourceTick>xe.unlockStructures[e.difficultyShort]&&t.random()>.875&&v(function(){xe.upgradeTileDefense(e)},xe.weaponDelay())}}}($,Math,document,location,TweenMax,TimelineMax,Power0,Power1,Power2,Power3,Power4,Back,Elastic,Bounce,SteppedEase,Circ,Expo,Sine,setTimeout,setInterval,clearTimeout,clearInterval,void 0===window.webkitRequestAnimationFrame||webkitRequestAnimationFrame,void 0===window.webkitCancelAnimationFrame||webkitCancelAnimationFrame,getComputedStyle,requestAnimationFrame,cancelAnimationFrame,window,Array,JSON,Date,Object);