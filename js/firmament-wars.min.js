!function(t,e,a,n,o,i,r,l,s,c,u,d,p,m,g,f,y,h,v,b,w,k,x,C,B,T,S,A,N,E,I,M,G){function D(t,e){ct["unit"+t].textContent=0===ut.tiles[t].units?"":~~ut.tiles[t].units,"#00ff00"===e||o.to(ct["unit"+t],$.delay(.5),{startAt:{fill:"#ff0000"},ease:u.easeIn,fill:"#ffffff"})}function P(){new Audio("sound/sniper0.mp3");var e=0;!function a(){t.ajax({type:"GET",url:app.url+"php/gameVictory.php"}).done(function(t){var e="";t.ceaseFire?(e='<p>Armistice!</p>\t\t\t\t<div>The campaign has been suspended!</div>\t\t\t\t<div id="ceaseFire" class="endBtn">\t\t\t\t\t<div class="modalBtnChild">Cease Fire</div>\t\t\t\t</div>',bt.play("shotgun2")):t.gameDone&&(e='<p>Congratulations!</p>\t\t\t\t<div>Your campaign for global domination has succeeded!</div>\t\t\t\t<div id="endWar" class="endBtn">\t\t\t\t\t<div class="modalBtnChild">Victory</div>\t\t\t\t</div>',st.victory=!0),e&&F(e,1)}).fail(function(t){++e<5&&v(function(){a()},2500)})}()}function F(e,i){t("*").off("click mousedown keydown keyup keypress"),st.gameDuration=~~((I.now()-1*sessionStorage.getItem("gameDuration"))/1e3),t("#chat-input-open, #chat-input-wrap").remove(),A.onbeforeunload=null,v(function(){st.over=1},1500),rt.get(),ot||it||tt||new Image("images/FlatWorld90.jpg"),v(function(){var r=a.getElementById("victoryScreen");r.innerHTML=e,r.style.display="block",i?bt.play("sniper0"):bt.play("shotgun2"),t("#endWar").on("mousedown",function(e){1===e.which&&(t("#endWar").off(),st.view="stats",o.to("#gameWrap",.05,{alpha:0,onComplete:function(){t("#diplomacy-ui, #ui2, #resources-ui, #chat-input-open, #chat-ui, #chat-input-wrap, #hud, #worldWrap, #victoryScreen").remove(),rt.show()}}))}),t("#ceaseFire").on($.click,function(){n.reload()}),t("#spectate").on($.click,function(e){t("#victoryScreen, #ui2, #resourceBody, #targetWrap").remove(),a.getElementById("surrender").style.display="none",a.getElementById("exitSpectate").style.display="inline",st.spectateStatus=1}),t("#exitSpectate").on($.click,function(){t(this).off($.click),rt.get(),o.to("#diplomacy-ui",1,{alpha:0,onComplete:function(){rt.show()}})})},2500)}function L(){var t=a;ct={endTurn:t.getElementById("endTurn"),energyIndicator:t.getElementById("energyIndicator"),currentYear:t.getElementById("currentYear"),currentYearWrap:t.getElementById("currentYearWrap"),targetFlag:t.getElementById("targetFlag"),targetResources:t.getElementById("targetResources"),targetNameWrap:t.getElementById("targetNameWrap"),targetBarsWrap:t.getElementById("targetBarsWrap"),targetNameAnchor:t.getElementById("targetNameAnchor"),landWrap:t.getElementById("landWrap"),gameWindows:t.getElementsByClassName("gameWindow"),sumMoves:t.getElementById("sumMoves"),moves:t.getElementById("moves"),gameWrap:t.getElementById("gameWrap"),gameTableBody:t.getElementById("gameTableBody"),food:t.getElementById("food"),production:t.getElementById("production"),culture:t.getElementById("culture"),Msg:t.getElementById("Msg"),hud:t.getElementById("hud"),sumFood:t.getElementById("sumFood"),foodMax:t.getElementById("foodMax"),cultureMax:t.getElementById("cultureMax"),manpower:t.getElementById("manpower"),sumProduction:t.getElementById("sumProduction"),sumCulture:t.getElementById("sumCulture"),chatContent:t.getElementById("chat-content"),chatInput:t.getElementById("chat-input"),lobbyChatInput:t.getElementById("lobby-chat-input"),titleChatInput:t.getElementById("title-chat-input"),worldWrap:t.getElementById("worldWrap"),motionPath:t.getElementById("motionPath"),targetLine:t.getElementById("targetLine"),targetLineBorder:t.getElementById("targetLineBorder"),arrowheadTip:t.getElementById("arrowhead-tip"),arrowhead:t.getElementById("arrowhead"),arrowheadBorder:t.getElementById("arrowhead-border"),targetLineShadow:t.getElementById("targetLineShadow"),targetCrosshair:t.getElementById("targetCrosshair"),target:t.getElementById("target"),targetName:t.getElementById("targetName"),oBonus:t.getElementById("oBonus"),dBonus:t.getElementById("dBonus"),productionBonus:t.getElementById("productionBonus"),foodBonus:t.getElementById("foodBonus"),cultureBonus:t.getElementById("cultureBonus"),foodBar:t.getElementById("foodBar"),cultureBar:t.getElementById("cultureBar"),world:t.getElementById("world"),bgmusic:t.getElementById("bgmusic"),tileName:t.getElementById("tileName"),tileActionsOverlay:t.getElementById("tileActionsOverlay"),buildWord:t.getElementById("buildWord"),buildCost:t.getElementById("buildCost"),cannonsCost:t.getElementById("cannonsCost"),missileCost:t.getElementById("missileCost"),nukeCost:t.getElementById("nukeCost"),masonryCost:t.getElementById("masonryCost"),constructionCost:t.getElementById("constructionCost"),gunpowderCost:t.getElementById("gunpowderCost"),engineeringCost:t.getElementById("engineeringCost"),rocketryCost:t.getElementById("rocketryCost"),atomicTheoryCost:t.getElementById("atomicTheoryCost"),futureTechCost:t.getElementById("futureTechCost"),upgradeTileDefense:t.getElementById("upgradeTileDefense"),screenFlash:t.getElementById("screenFlash"),fireCannons:t.getElementById("fireCannons"),launchMissile:t.getElementById("launchMissile"),launchNuke:t.getElementById("launchNuke"),researchMasonry:t.getElementById("researchMasonry"),researchConstruction:t.getElementById("researchConstruction"),researchEngineering:t.getElementById("researchEngineering"),researchGunpowder:t.getElementById("researchGunpowder"),researchRocketry:t.getElementById("researchRocketry"),researchAtomicTheory:t.getElementById("researchAtomicTheory"),researchFutureTech:t.getElementById("researchFutureTech"),lobbyChatLog:t.getElementById("lobbyChatLog"),titleChatLog:t.getElementById("titleChatLog"),mapAnimations:t.getElementById("mapAnimations"),mapCapitals:t.getElementById("mapCapitals"),mapUpgrades:t.getElementById("mapUpgrades"),mapBars:t.getElementById("mapBars"),titleChatBody:t.getElementById("titleChatBody")}}function W(e){if("game"===st.view)var a=confirm("Are you sure you want to surrender?");(a||e||"game"!==st.view)&&(st.lock(1),t.ajax({url:app.url+"php/exitGame.php",data:{view:st.view}}).always(function(){n.reload()}))}function j(){a.getElementById("surrenderScreen").style.display="none",t.ajax({type:"GET",url:app.url+"php/surrender.php"}),bt.play("click")}function O(t){}function R(){!tt&&isLoggedIn&&(t("#fireCannons").attr("title","Fire cannons at an adjacent tile. Kills "+(2+dt.oBonus)+"-"+(4+dt.oBonus)+" troops. Boosted by Great Generals.").tooltip("fixTitle").tooltip({animation:!1}),t("#launchMissile").attr("title","Launch a missile at any territory. Kills "+(7+2*dt.oBonus)+"-"+(12+2*dt.oBonus)+" troops. Boosted by Great Generals.").tooltip("fixTitle").tooltip({animation:!1}),t("#rush").attr("title","Rush "+(2+~~(dt.cultureBonus/50))+" troops from your citizenry. Boosted by culture bonus.").tooltip("fixTitle").tooltip({animation:!1}))}function H(t){dt.food=t.food,dt.production=t.production,dt.culture=t.culture,ct.moves.textContent=t.moves,ct.production.textContent=t.production,ct.food.textContent=t.food,ct.culture.textContent=t.culture,ct.manpower.textContent=dt.manpower,dt.manpower=t.manpower,ct.foodMax.textContent=t.foodMax,ct.cultureMax.textContent=t.cultureMax,ct.oBonus.textContent=t.oBonus,ct.dBonus.textContent=t.dBonus,ct.productionBonus.textContent=t.productionBonus,ct.foodBonus.textContent=t.foodBonus,ct.cultureBonus.textContent=t.cultureBonus,Y(t)}function V(t){t.moves!==G&&(dt.moves=t.moves,ct.moves.textContent=t.moves,t.sumMoves)}function z(t){t.production!==G&&o.to(dt,$.delay(.3),{production:t.production,ease:Quad.easeIn,onUpdate:function(){ct.production.textContent=~~dt.production}})}function U(t){V(t),z(t),o.to(dt,$.delay(.3),{food:t.food===G?dt.food:t.food,culture:t.culture===G?dt.culture:t.culture,ease:Quad.easeIn,onUpdate:function(){ct.food.textContent=~~dt.food,ct.culture.textContent=~~dt.culture}}),t.manpower!==G&&(t.manpower>dt.manpower?(o.fromTo("#manpower",.5,{color:"#ffaa33"},{color:"#ffff00",repeat:-1,yoyo:!0}),o.to(dt,$.delay(.5),{manpower:t.manpower,onUpdate:function(){ct.manpower.textContent=~~dt.manpower}})):(dt.manpower=t.manpower,ct.manpower.textContent=dt.manpower)),t.foodMax!==G&&t.foodMax&&t.foodMax>dt.foodMax&&(ct.foodMax.textContent=t.foodMax,dt.foodMax=t.foodMax),t.cultureMax!==G&&t.cultureMax&&t.cultureMax>dt.cultureMax&&(ct.cultureMax.textContent=t.cultureMax,dt.cultureMax=t.cultureMax),t.sumFood!==G&&t.sumFood&&t.sumFood!==dt.sumFood&&(dt.sumFood=t.sumFood),t.sumProduction!==G&&t.sumProduction&&t.sumProduction!==dt.sumProduction&&(dt.sumProduction=t.sumProduction),t.sumCulture!==G&&t.sumCulture&&t.sumCulture!==dt.sumCulture&&(dt.sumCulture=t.sumCulture),t.oBonus!==G&&dt.oBonus!==t.oBonus&&(ct.oBonus.textContent=t.oBonus,dt.oBonus=t.oBonus,R()),t.dBonus!==G&&dt.dBonus!==t.dBonus&&(ct.dBonus.textContent=t.dBonus,dt.dBonus=t.dBonus),t.productionBonus!==G&&dt.productionBonus!==t.productionBonus&&(ct.productionBonus.textContent=t.productionBonus,dt.productionBonus=t.productionBonus),t.foodBonus!==G&&dt.foodBonus!==t.foodBonus&&(ct.foodBonus.textContent=t.foodBonus,dt.foodBonus=t.foodBonus),t.cultureBonus!==G&&dt.cultureBonus!==t.cultureBonus&&(ct.cultureBonus.textContent=t.cultureBonus,dt.cultureBonus=t.cultureBonus,R()),Y(t)}function Y(t){o.to(ct.foodBar,$.delay(.3),{width:t.food/t.foodMax*100+"%"}),o.to(ct.cultureBar,$.delay(.3),{width:t.culture/t.cultureMax*100+"%"})}function q(){return this.account="",this.nation="",this.flag="",this.playerColor=0,this.team=1,this.alive=!0,this.government="",this}function J(){st.lock(1);var e=a.getElementById("mainWrap");null!==e&&o.to(e,.5,{alpha:0}),t.ajax({type:"GET",url:app.url+"maps/"+st.map.key+".php"}).done(function(e){ct.worldWrap.innerHTML='<div id="worldWater"></div>'+e,t.ajax({type:"GET",url:app.url+"php/loadGameState.php"}).done(function(e){function i(t){var e=t.cpu?t.difficulty:t.account,a=ht.governmentIcon(t);t.cpu||t.government;return'<div id="diplomacyPlayer'+t.player+'" class="diplomacyPlayers alive pb'+t.player+'"><div class="diplo-pipe pbar'+t.player+'"></div><img src="images/flags/'+t.flagSrc+'" class="diplo-flag no-select"><div class="diplo-data-col"<div><div class="nowrap">'+a+e+'</div><div class="nowrap">'+function(t){return st.teamMode?'<span class="diploTeam">'+t+"</span>":""}(t.team)+t.nation+"</div></div></div></div>"}if(v(function(){t("#title-bg-wrap").remove()},2e3),st.resourceTick=e.resourceTick,st.startGame=1*e.startGame,st.teamMode=e.teamMode,st.gameMode=e.gameMode,st.map.sizeX=e.mapData.sizeX,st.map.sizeY=e.mapData.sizeY,st.map.name=e.mapData.name,st.map.tiles=e.mapData.tiles,e.tiles.length<st.map.tiles)st.loadAttempts<20?v(function(){st.loadAttempts++,J()},500):(st.msg("Failed to load game data"),localStorage.setItem("reload",!1),v(function(){A.onbeforeunload=null,n.reload()},3e3));else{L(),t("meta").remove(),st.screen.resizeMap(),bt.gameMusicInit(),bt.load.game(),ft.load.game(),dt.player=e.player,dt.team=e.team,dt.account=e.account,dt.oBonus=e.oBonus,dt.dBonus=e.dBonus,dt.cultureBonus=e.cultureBonus,dt.tech=e.tech,dt.capital=e.capital,dt.flag=e.flag,dt.nation=e.nation,dt.foodMax=e.foodMax,dt.production=e.production,dt.sumProduction=e.sumProduction,dt.cultureMax=e.cultureMax,dt.moves=e.moves,dt.government=e.government,dt.buildCost=e.buildCost,ht.updateGovernmentWindow(dt.government),"Monarchy"===dt.government?dt.buildCost=.5:"Democracy"===dt.government?dt.maxDeployment=48:"Republic"===dt.government?(dt.sumMoves=e.sumMoves,a.getElementById("moves").textContent=dt.sumMoves):"Fascism"===dt.government?(a.getElementById("moves").textContent=8,dt.deployCost=1,a.getElementById("deployCost").textContent=dt.deployCost):"Communism"===dt.government&&(ct.cannonsCost.textContent=18,ct.missileCost.textContent=38,ct.nukeCost.textContent=113,dt.weaponCost=.75),ut.initialized=!0;for(var r=0,l=ut.player.length;r<l;r++)ut.player[r]=new q;st.removeContainers(),st.unlock(),st.view="game",o.fromTo(gameWrap,1,{autoAlpha:0},{autoAlpha:1});for(var s=0,l=e.players.length;s<l;s++){u=e.players[s];(r=ut.player[u.player]).account=u.account,r.flag=u.flag,r.nation=u.nation,r.player=u.player,r.playerColor=u.playerColor,r.team=u.team,r.government=u.government,r.cpu=u.cpu,r.difficulty=u.difficulty,r.difficultyShort=u.difficulty.replace(/ /g,"")}for(var c=a.getElementById("mapCapitals"),s=(a.getElementById("mapUpgrades"),0),l=e.tiles.length;s<l;s++){var u=e.tiles[s];ut.tiles[s]={name:u.tileName,account:u.account,player:u.player,nation:u.nation,flag:u.flag,capital:!!(e.capitalTiles.indexOf(s)>-1&&u.flag),units:u.units,food:u.food,production:u.production,culture:u.culture,defense:u.defense,adj:e.adj[s]};var d=a.getElementById("unit"+s);null!==d&&(d.textContent=0===u.units?0:u.units,u.units&&(d.style.visibility="visible")),u.player&&o.set("#land"+s,{fill:st.color[ut.player[u.player].playerColor],stroke:st.color[ut.player[u.player].playerColor],strokeWidth:1,onComplete:function(){u.player&&o.set(this.target,{stroke:"hsl(+=0%, +=0%, -=30%)"})}})}st.tileCount=l;for(var p=a.getElementsByClassName("unit"),m=(a.getElementById("mapBars"),a.getElementById("mapFlagWrap")),s=0,l=p.length;s<l;s++){var g=ut.tiles[s],f=p[s].getAttribute("x")-20,y=p[s].getAttribute("y")-30,h="blank.png";g!==G&&(!g.flag&&g.units?h="Player0.jpg":g.flag&&(h=g.flag));b=a.createElementNS("http://www.w3.org/2000/svg","image");if(b.id="flag"+s,b.setAttributeNS(null,"height",40),b.setAttributeNS(null,"width",40),b.setAttributeNS(null,"x",f),b.setAttributeNS(null,"y",y+5),b.setAttributeNS(null,"class","mapFlag"),b.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/flags/"+h),m.appendChild(b),ut.tiles[s]!==G&&ut.tiles[s].capital){var b;(b=a.createElementNS("http://www.w3.org/2000/svg","path")).id="mapCapital"+s,b.setAttributeNS(null,"class","mapStar"),b.setAttributeNS(null,"d","m "+f+","+y+" 5.79905,17.10796 18.05696,0.50749 -14.47863,10.80187 5.09725,17.33001 -14.74733,-10.43203 -14.90668,10.20304 5.36427,-17.24922 -14.31008,-11.02418 18.06264,-0.22858 z"),c.appendChild(b),tt||o.to(b,60,{transformOrigin:"50% 50%",rotation:360,repeat:-1,ease:Linear.easeNone})}var w=a.getElementById("targetCrosshair");o.to(w,10,{force3D:!0,transformOrigin:"50% 50%",rotation:360,repeat:-1,ease:Linear.easeNone})}ut.initMap();for(s=0;s<l;s++)lt.initMapBars(s);for(var k="",x=[k],s=0,l=ut.player.length;s<l;s++){var C=ut.player[s];if(C.account)if(C.flagArr=C.flag.split("."),C.flagShort=C.flagArr[0],C.flagSrc="Default.jpg"===C.flag?"Player"+ut.player[C.player].playerColor+".jpg":C.flag,st.teamMode){var B=i(C);x[100*C.team+s]=B}else k+=i(C)}var T='<div id="game-mode"><div>Game Mode:</div><div class="'+st.gameMode.toLowerCase()+'">'+st.gameMode+"</div></div>";st.teamMode?a.getElementById("diplomacy-body").innerHTML=T+x.join(""):a.getElementById("diplomacy-body").innerHTML=T+k,H(e),v(function(){function a(t){if(dt.attackOn){var e=dt.targetData;"attack"===e.attackName||"splitAttack"===e.attackName?wt.attack(t):"cannons"===e.attackName?wt.fireCannons(t):"missile"===e.attackName?wt.launchMissile(t):"nuke"===e.attackName&&wt.launchNuke(t)}else $.showTarget(t)}gt=Draggable.create(ct.worldWrap,{minimumMovement:4,type:"x,y",bounds:"#gameWrap"}),R(),o.set(ct.targetLine,{stroke:st.color[ut.player[dt.player].playerColor]}),o.set(ct.targetLine,{stroke:"hsl(+=0%, +=0%, -=5%)"}),o.set(ct.arrowheadTip,{fill:st.color[ut.player[dt.player].playerColor]}),o.set(ct.arrowheadTip,{fill:"hsl(+=0%, +=0%, -=5%)"});var i=t("#gameWrap");ot||it?i.on("mousedown",".land",function(){a(this),o.set(this,{fill:"hsl(+=0%, +=0%, -=5%)"})}):i.on("click",".land",function(t){n.host,a(this)}),i.on("mouseenter",".land",function(){dt.lastTarget=this,dt.attackOn&&$.showTarget(this,!0),o.set(this,{fill:"hsl(+=0%, +=0%, -=5%)"})}).on("mouseleave",".land",function(){var t=1*this.id.slice(4);if(ut.tiles.length>0){var e=ut.tiles[t]!==G?ut.tiles[t].player:0,a=e?ut.player[e].playerColor:0;o.set(this,{fill:st.color[a]})}}),dt.focusTile(dt.capital),ut.startGameState(),$.setCurrentYear(e.resourceTick),lt.paths()},350)}}).fail(function(t){v(function(){J()},1500)}).always(function(){st.unlock()})})}function X(){}function _(){}function K(t,e){var a=~~(t/st.map.sizeX*100),n=~~(e/st.map.sizeY*100);st.mouse.transX=a,st.mouse.transY=n}function Q(t){t===G&&(t={}),this.cost=t.cost!==G?t.cost:2,this.minimum=t.minimum!==G?t.minimum:2,this.attackName=t.attackName?t.attackName:"attack",this.splitAttack=!!t.splitAttack&&t.splitAttack,this.hudMsg=t.hudMsg?t.hudMsg:"Attack: Select Target"}function Z(e){if(st.chatOn=!st.chatOn,st.chatOn)mt.chatInputOpen.css("visibility","hidden"),mt.chatInputWrap.css("visibility","visible"),mt.chatInput.focus();else{var a=mt.chatInput.val().trim();if(e&&a)if("/friend"===a)yt.listFriends();else if(0===a.indexOf("/friend "))yt.toggleFriend(a.slice(8));else if(0===a.indexOf("/unignore ")){n=a.slice(10);yt.removeIgnore(n)}else if("/ignore"===a)yt.listIgnore();else if(0===a.indexOf("/ignore ")){var n=a.slice(8);yt.addIgnore(n)}else 0===a.indexOf("/whisper ")?yt.sendWhisper(a,"/whisper "):0===a.indexOf("/w ")?yt.sendWhisper(a,"/w "):0===a.indexOf("@")?yt.sendWhisper(a,"@"):0===a.indexOf("/who ")?yt.who(a):"/"===a.charAt(0)&&0!==a.indexOf("/me")||t.ajax({url:app.url+"php/insertChat.php",data:{message:a}});mt.chatInput.val("").blur(),mt.chatInputOpen.css("visibility","visible"),mt.chatInputWrap.css("visibility","hidden")}}var $={resizeWindow:function(){"game"===st.view&&gt[0].applyBounds(),st.screen.resizeMap()},windowDefault:"Full Screen",initWindow:function(){var t=localStorage.getItem("window-size");null===t&&localStorage.setItem("window-size",$.windowDefault),$.setWindow(t)},setWindow:function(e){if(app.isApp){var a=require("nw.gui").Window.get();v(function(){"Full Screen"===e?!a.isFullscreen&&a.enterFullscreen():"1920 x 1080"===e?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1920,1080),a.maximize()):"1600 x 900"===e?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1600,900)):"1360 x 768"===e?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1360,768)):"1280 x 720"===e?(a.isFullscreen&&a.leaveFullscreen(),a.resizeTo(1280,720)):!a.isFullscreen&&a.enterFullScreen(),t("#window-size").text(e),localStorage.setItem("window-size",e)},100)}},setMobile:function(){},setWorkSafe:function(){t("head").append("<style>.chat-img{ display: none; } #statQuote{ visibility: hidden; } </style>")},click:tt?"mousedown":"click",delay:function(t){return tt?0:t},showTarget:function(a,n,i){if(a.id===G&&(a.id="land0"),"object"==typeof a){var r=1*a.id.slice(4),l=(ut.tiles[r],dt.tgt);if(n||l!==r&&(dt.tgt=r,lt.selectTile(l,r)),n&&r!==dt.tgt){dt.targetLine[4]=1*ct["unit"+r].getAttribute("x")-10,dt.targetLine[5]=1*ct["unit"+r].getAttribute("y")-10;var c="M "+dt.targetLine[0]+","+dt.targetLine[1]+" "+dt.targetLine[4]+","+dt.targetLine[5],d=0;d+=e.abs(dt.targetLine[0]-dt.targetLine[4]),d+=e.abs(dt.targetLine[1]-dt.targetLine[5]),dt.targetLine[2]=(dt.targetLine[0]+dt.targetLine[4])/2,dt.targetLine[3]=(dt.targetLine[1]+dt.targetLine[5])/2-100;var p="M "+dt.targetLine[0]+","+dt.targetLine[1]+" Q "+dt.targetLine[2]+" "+dt.targetLine[3]+" "+dt.targetLine[4]+" "+dt.targetLine[5];o.set(ct.targetLineShadow,{visibility:"visible",attr:{d:c}}),o.set([ct.targetLine,ct.targetLineBorder],{visibility:"visible",attr:{d:d>300?p:c}}),o.set([ct.arrowhead,ct.arrowheadBorder],{visibility:"hidden"}),o.set(ct.targetLineBorder,{stroke:st.color[ut.player[dt.player].playerColor]}),o.to([ct.targetLine,ct.targetLineBorder,ct.targetLineShadow],.2,{startAt:{drawSVG:"0%"},drawSVG:"100%",onComplete:function(){o.set([ct.arrowhead,ct.arrowheadBorder],{visibility:"visible"}),o.to([ct.targetLine,ct.targetLineShadow],.5,{startAt:{strokeDasharray:"31,1",strokeDashoffset:0},strokeDashoffset:-32,repeat:-1,force3D:!0,ease:Linear.easeNone}),o.to(ct.targetLineBorder,.5,{stroke:"#000"})}}),o.set(ct.targetCrosshair,{fill:"#00dd00",visibility:"visible",x:dt.targetLine[4]-255,y:dt.targetLine[5]-257,transformOrigin:"50% 50%"}),o.to(ct.targetCrosshair,1,{startAt:{scale:.35},force3D:!0,scale:.175,repeat:-1,ease:u.easeOut}),o.to(ct.targetCrosshair,1,{startAt:{opacity:1},force3D:!0,opacity:0,repeat:-1,ease:s.easeIn})}i||(dt.lastTgt=l),function(e){var a=ut.tiles[e],n="Default.jpg",o=a.name,o=a.name;0===a.player?(n="Player0.jpg",a.units>0?o="Barbarian Tribe":(o="Uninhabited",n="Default.jpg")):("Default.jpg"===a.flag?(n="Player"+ut.player[a.player].playerColor+".jpg",n=a.flag):n=a.flag,o=a.name,a.account);var i={food:0,culture:0,production:0,defense:0};a.player&&(i.food=~~((a.food>8?8:a.food)/8*99),i.production=~~((a.production>8?8:a.production)/8*99),i.culture=~~((a.culture>8?8:a.culture)/8*99),i.defense=~~(a.defense/4*99));var r="<div>"+a.food+'<img src="images/icons/food.png" class="fw-icon"></div>'+(a.production?"<div>"+a.production+'<img src="images/icons/production.png" class="fw-icon"></div>':"")+(a.culture?"<div>"+a.culture+'<img src="images/icons/culture.png" class="fw-icon"></div>':"")+(a.defense?"<div>"+a.defense+'<img src="images/icons/tile-defense.png" class="fw-icon"></div>':"");ct.targetNameWrap.innerHTML=o,ct.targetResources.innerHTML=r,ct.targetFlag.src="images/flags/"+n;var l=["Bunker","Wall","Fortress"],s=a.defense-(a.capital?1:0);if(!(s<0)){if(s>2)ct.upgradeTileDefense.style.display="none";else if(ct.upgradeTileDefense.style.display="flex",ct.buildWord.textContent=l[s],ct.buildCost.textContent=st.upgradeCost[s]*dt.buildCost,2===s&&(l[2]="Fortresse"),!tt&&isLoggedIn){var c=l[s]+"s boost tile defense +"+[5,15,30][s]+" and "+["reduce weapon damage by 1","reduce weapon damage by 3","reduce weapon damage by 6"][s];t("#upgradeTileDefense").attr("title",c).tooltip("fixTitle").tooltip("hide").tooltip({animation:!1,placement:"bottom",container:"body"})}wt.setMenu()}}(r),dt.flashTile(r)}else dt.attackOn=!1,dt.attackName=""},transformYear:function(t){return(t<=40?4e3-100*t:t<=60?0+50*(t-40):t<=80?1e3+25*(t-60):t<=120?1500+10*(t-80):t<=170?1900+2*(t-120):2e3+1*(t-170))+(t>=40?" A.D.":" B.C.")},setCurrentYear:function(t){ct.currentYear.textContent=$.transformYear(t)}},tt=(/Xbox/i.test(navigator.userAgent),navigator.userAgent.toLowerCase().indexOf("playstation"),/Nintendo/i.test(navigator.userAgent),function(){var t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(t=!0),t}()),et=!!A.opera||navigator.userAgent.indexOf(" OPR/")>=0,at="undefined"!=typeof InstallTrigger,nt=M.prototype.toString.call(A.HTMLElement).indexOf("Constructor")>0,ot=(A.chrome,!1),it=!!navigator.userAgent.match(/Trident\/7\./);!function(){localStorage.getItem("isMobile");ot||it?t("head").append("<style> text { font-family: Verdana; stroke-width: 0; stroke: #000; fill: #fff; } .unit{ font-size: 26px; } </style>"):nt&&t("head").append("<style> text { fill: #ffffff; stroke: none; stroke-width: 0px; } </style>"),(tt||"#mobiletest"===n.hash)&&$.setMobile(),"#synergist"!==n.hash&&"#sfw"!==n.hash||$.setWorkSafe(),localStorage.setItem("isMobile",tt),v(function(){t("script").remove()},1e3),$.initWindow()}();t("#payment-confirm").on($.click,function(e){st.lock();var o=t("#card-number").val(),i=t("#card-cvc").val(),r=t("#card-month").val(),l=20+t("#card-year").val(),s=!1;Stripe.validateCardNumber(o)||(s=!0,st.msg("The credit card number is invalid.")),Stripe.validateCVC(i)||(s=!0,st.msg("The CVC number is invalid.")),Stripe.validateExpiry(r,l)||(s=!0,st.msg("The expiration date is invalid.")),s?st.unlock():(t("#payment-errors").text(""),Stripe.createToken({number:o,cvc:i,exp_month:r,exp_year:l},function(e,o){o.error?(st.msg(o.error.message),st.unlock()):(st.msg("Communicating with the server..."),t.ajax({url:app.url+"php/purchaseFw.php",data:{stripeToken:o.id}}).done(function(t){st.msg("Thank you for your purchase!<br>Firmament Wars - Complete Game Unlocked!",8),v(function(){n.reload()},3e3)}).fail(function(t){a.getElementById("payment-errors").textContent=t.error}).always(function(){st.unlock()}))}))});!function(){if(!t("#titleMenu").length){var e=localStorage.getItem("email"),a=localStorage.getItem("token");e&&(a?t.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"authenticate",email:e,token:a}}).done(function(o){"Login successful!"===o&&t.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"getToken",email:e}}).done(function(o){a=o,t.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"authenticate",email:e,token:a}}).done(function(t){localStorage.setItem("token",a),n.reload()}).fail(function(t){})})}):t.ajax({type:"POST",url:app.url+"/php/master1.php",data:{run:"getToken",email:e}}).done(function(t){a=t}))}}();var rt={init:function(t){var e="Default.jpg"===dt.flag?"Player"+ut.player[dt.player].playerColor+".jpg":dt.flag;if(tt)n='<img id="statWorld" style="display: none">';else var n='<img id="statWorld" src="images/FlatWorld90.jpg">';n+='<div id="statResult" class="no-select">\t\t\t<img class="statResultFlag" src="images/flags/'+e+'">\t\t\t<span id="statGameResult">Defeat in '+$.transformYear(t.resourceTick)+'</span>\t\t\t<img class="statResultFlag" src="images/flags/'+e+'">\t\t</div>\t\t<div id="statTabWrap" class="no-select shadow4">\t\t\t<div id="statOverview" class="statTabs active">\t\t\t\tOverview\t\t\t</div><div id="statUnits" class="statTabs">\t\t\t\tUnits\t\t\t</div><div id="statStructures" class="statTabs">\t\t\t\tStructures\t\t\t</div><div id="statWeapons" class="statTabs">\t\t\t\tWeapons\t\t\t</div><div id="statResources" class="statTabs">\t\t\t\tResources\t\t\t</div>\t\t</div>\t\t<table id="gameStatsTable" class="table"></table>\t\t<div id="statFooter" class="container-fluid">\t\t\t<div class="row">\t\t\t\t<div id="statQuote" class="col-xs-7 shadow4 stagBlue">\t\t\t\t\t<div>'+rt.data.quote+'</div>\t\t\t\t\t<div id="statVerse" class="text-right">'+rt.data.verse+'</div>\t\t\t\t</div>\t\t\t\t<div id="statDuration" class="col-xs-4 stagBlue text-center">\t\t\t\t\t<div id="gameDuration">Game Duration '+rt.gameDuration(st.gameDuration)+'</div>\t\t\t\t\t<button id="statsEndGame" class="btn btn-md btn-block btn-responsive shadow4 lobbyButtons">End Game</button>\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t<div id="ribbonBackdrop"></div>\t\t<div id="ribbonReward" class="fw-primary title-modals">\t\t\t<div class="header text-center">\t\t\t\t<h2 class="header">Achievement Unlocked!</h2>\t\t\t</div>\t\t\t<hr class="fancyhr">\t\t\t<div id="ribbonBody"></div>\t\t</div>',a.getElementById("statWrap").innerHTML=n,rt.events(),tt?(a.getElementById("statWorld").style.display="none",o.set("#statWorld",{xPercent:-50,yPercent:-50,top:"50%",left:"50%",width:"1600px",height:"1600px"})):o.to("#statWorld",300,{startAt:{xPercent:-50,yPercent:-50,rotation:-360},rotation:0,repeat:-1,ease:Linear.easeNone}),rt.setLeaderValues()},show:function(){ct.bgmusic.loop=!0,rt.setView("statOverview"),st.victory?(bt.play("bell-8"),bt.play("TheAssault",1),a.getElementById("statGameResult").textContent="Victory in "+$.transformYear(rt.data.resourceTick)):(bt.play("defeat"),bt.play("JourneyOfForgottenSoldiers",1)),a.getElementById("statWrap").style.visibility="visible",o.to("#gameWrap",.5,{startAt:{alpha:0},alpha:1}),rt.achievements.length&&(bt.play("ding3"),o.to("#ribbonBackdrop",.5,{startAt:{visibility:"visible",alpha:0},alpha:1}),o.to("#ribbonReward",1,{startAt:{visibility:"visible",alpha:0,top:0,y:0},alpha:1,y:30})),t("#worldWrap, #targetWrap, #ui2, #resources-ui, #diplomacy-ui, #chat-ui, #chat-input-open, #chat-input-wrap, #surrenderScreen").remove()},events:function(){t("#statWrap").on($.click,".statTabs",function(){t(".statTabs").removeClass("active"),t(this).addClass("active"),bt.play("switch13");var e=t(this).attr("id");rt.setView(e)}).on($.click,"#statsEndGame",function(){n.reload()}).on($.click,"#ribbonBackdrop",function(){o.to("#ribbonBackdrop, #ribbonReward",.25,{alpha:0,onComplete:function(){o.set("#ribbonBackdrop, #ribbonReward",{visibility:"hidden"})}})})},maxValue:{unitsTotal:0,structuresTotal:0,weaponsTotal:0,resourcesTotal:0,overviewTotal:0},setLeaderValues:function(){for(var t=1;t<=8;t++){var e=rt.data[t];if(e!==G){for(var a in e)1===t?rt.maxValue[a]=e[a]:e[a]>rt.maxValue[a]&&(rt.maxValue[a]=e[a]);var n=rt.unitsTotal(t),o=rt.structuresTotal(t),i=rt.weaponsTotal(t),r=rt.resourcesTotal(t),l=rt.overviewTotal(t);n>rt.maxValue.unitsTotal&&(rt.maxValue.unitsTotal=rt.unitsTotal(t)),o>rt.maxValue.structuresTotal&&(rt.maxValue.structuresTotal=o),i>rt.maxValue.weaponsTotal&&(rt.maxValue.weaponsTotal=i),r>rt.maxValue.resourcesTotal&&(rt.maxValue.resourcesTotal=r),l>rt.maxValue.overviewTotal&&(rt.maxValue.overviewTotal=l)}}},currentTabId:"",setView:function(t){if(t!==rt.currentTabId){rt.currentTabId=t;var e=rt[t]();a.getElementById("gameStatsTable").innerHTML=e}},barAnimate:new o.delayedCall(0,""),animate:function(t,e){v(function(){var n={max:100,lastVal:0};rt.barAnimate.kill(),rt.barAnimate=o.to(n,e,{startAt:{max:0},max:100,onUpdate:function(){~~n.lastVal!=~~n.max&&(n.lastVal=n.max,bt.play("rollover5"))},onComplete:function(){bt.play("switch11")},ease:h.easeOut});for(var i=1,r=t.length;i<r;i++){var l=t[i];!function(t,a,n,i){o.to(t,e,{startAt:{max:0},max:t.max,onUpdate:function(){a.textContent=~~t.max},ease:i.easeOut}),o.to(n,e,{startAt:{width:0},width:t.max/rt.maxValue[t.key]*100+"%",ease:i.easeOut})}(l,a.getElementById(l.id),a.getElementById(l.id+"-bar"),h)}})},statOverview:function(){for(var t=rt.playerHead(["Units","Structures","Weapons","Resources","Total Score"]),e=1;e<=8;e++){var a=rt.data[e];if(rt.data[e]!==G){n=[{},{id:"p"+e+"-units",max:rt.unitsTotal(e),key:"unitsTotal"},{id:"p"+e+"-structures",max:rt.structuresTotal(e),key:"structuresTotal"},{id:"p"+e+"-weapons",max:rt.weaponsTotal(e),key:"weaponsTotal"},{id:"p"+e+"-resources",max:rt.resourcesTotal(e),key:"resourcesTotal"},{id:"p"+e+"-total",max:rt.overviewTotal(e),key:"overviewTotal"}];rt.animate(n,1.5),t+='<tr class="statRow">'+rt.playerCell(a,e);for(var n,o=ut.player[e].playerColor,i=(n=["units","structures","weapons","resources","total"]).length,r=0;r<i;r++){var l=r+1===i?" statSum":"";t+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'" class="statVal'+l+'">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>'}t+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return t},statUnits:function(){for(var t=rt.playerHead(["Earned","Deployed","Killed","Lost"]),e=1;e<=8;e++){var a=rt.data[e];if(a!==G){n=[{},{id:"p"+e+"-earned",max:a.earned,key:"earned"},{id:"p"+e+"-deployed",max:a.deployed,key:"deployed"},{id:"p"+e+"-killed",max:a.killed,key:"killed"},{id:"p"+e+"-lost",max:a.lost,key:"lost"}];rt.animate(n,1.5),t+='<tr class="stagBlue statRow">'+rt.playerCell(a,e);for(var n,o=ut.player[e].playerColor,i=(n=["earned","deployed","killed","lost"]).length,r=0;r<i;r++)t+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'" class="statVal">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>';t+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return t},statStructures:function(){for(var t=rt.playerHead(["Bunkers","Walls","Fortresses"]),e=1;e<=8;e++){var a=rt.data[e];if(a!==G){n=[{},{id:"p"+e+"-bunkers",max:a.bunkers,key:"bunkers"},{id:"p"+e+"-walls",max:a.walls,key:"walls"},{id:"p"+e+"-fortresses",max:a.fortresses,key:"fortresses"}];rt.animate(n,1),t+='<tr class="stagBlue statRow">'+rt.playerCell(a,e);for(var n,o=ut.player[e].playerColor,i=(n=["bunkers","walls","fortresses"]).length,r=0;r<i;r++)t+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'" class="statVal">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>';t+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return t},statWeapons:function(){for(var t=rt.playerHead(["Cannons","Missiles","Nukes"]),e=1;e<=8;e++){var a=rt.data[e];if(a!==G){n=[{},{id:"p"+e+"-cannons",max:a.cannons,key:"cannons"},{id:"p"+e+"-missiles",max:a.missiles,key:"missiles"},{id:"p"+e+"-nukes",max:a.nukes,key:"nukes"}];rt.animate(n,1),t+='<tr class="stagBlue statRow">'+rt.playerCell(a,e);for(var n,o=ut.player[e].playerColor,i=(n=["cannons","missiles","nukes"]).length,r=0;r<i;r++)t+='<td class="stagBlue statTD">\t\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t\t<div id="p'+e+"-"+n[r]+'" class="statVal">0</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</td>';t+='</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return t},statResources:function(){for(var t=rt.playerHead(["Energy","Production","Food","Culture"]),e=1;e<=8;e++){var a=rt.data[e];if(a!==G){var n=[{},{id:"p"+e+"-moves",max:a.moves,key:"moves"},{id:"p"+e+"-production",max:a.production,key:"production"},{id:"p"+e+"-food",max:a.food,key:"food"},{id:"p"+e+"-culture",max:a.culture,key:"culture"}];rt.animate(n,1.5),t+='<tr class="stagBlue statRow">'+rt.playerCell(a,e);var o=ut.player[e].playerColor;t+='<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+e+'-moves-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+e+'-moves" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+e+'-production-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+e+'-production" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+e+'-food-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+e+'-food" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t\t<td class="stagBlue statTD">\t\t\t\t\t\t<div class="statBar pb'+o+'">\t\t\t\t\t\t\t<div id="p'+e+'-culture-bar" class="statBarBg pbar'+o+'">&nbsp</div>\t\t\t\t\t\t\t<div id="p'+e+'-culture" class="statVal">0</div>\t\t\t\t\t\t</div>\t\t\t\t\t</td>\t\t\t\t</tr>\t\t\t\t<tr class="statSpacer"></tr>'}}return t},playerHead:function(t){for(var e='<tr><th style="width: 420px"></th>',a=0,n=t.length;a<n;a++)e+=4===a?'<th class="text-center statHead chat-warning">'+t[a]+"</th>":'<th class="text-center statHead">'+t[a]+"</th>";return e+='</tr><tr class="statSpacer2"></tr>'},playerCell:function(t,e){var a=ut.player[e],n=a.playerColor,o="Default.jpg"===t.flag?"Player"+n+".jpg":t.flag,i='<td class="stat-detail-wrap">\t\t\t<div class="statWrapper">\t\t\t\t<img class="statFlagBG" src="images/flags/'+o+'">\t\t\t</div>\t\t\t<img class="statsFlags" src="images/flags/'+o+'">\t\t\t<div class="statsPlayerWrap">\t\t\t\t<div class="statsAccount chat-warning nowrap">'+ht.governmentIcon(a);st.teamMode&&(i+='<span class="diploTeam">'+a.team+"</span>");return i+=(1===t.cpu?a.difficulty:t.account)+'</div>\t\t\t\t<div class="statsNation nowrap">'+t.nation+"</div>\t\t\t</div>\t\t</td>"},data:{},gameDuration:function(t){return rt.hours(t)+rt.minutes(t)+":"+rt.seconds(t)},hours:function(t){var e="";return t>=3600&&(e=~~(t/3600)+":"),e},minutes:function(t){var e="";return t<60?t>=3600&&(e="00:"):(e=~~(t/60%60))<10&&(e="0"+e),e},seconds:function(t){var e=~~(t%60);return e<10?"0"+e:e},get:function(){t.ajax({url:app.url+"php/stats.php"}).done(function(t){rt.data=t,rt.init(t),rt.notifyRibbons(t.ribbons)})},achievements:[],notifyRibbons:function(t){var e="";if(t.forEach(function(t){e+='<div class="ribbonName ranked">'+ut.ribbonTitle[t]+'</div>\t\t\t<div class="ribbonDescription ranked">'+ut.ribbonDescription[t]+'</div>\t\t\t<img class="giantRibbon block" src="images/ribbons/ribbon'+t+'.jpg">'}),a.getElementById("ribbonBody").innerHTML=e,rt.achievements=t,rt.achievements.length&&(new Audio("sound/ding3.mp3"),app.isApp)){var n=require("./greenworks");n.initAPI()&&n.init()}},overviewTotal:function(t){rt.data[t];return this.unitsTotal(t)+this.structuresTotal(t)+this.weaponsTotal(t)+this.resourcesTotal(t)},unitsTotal:function(t){var e=rt.data[t];return 100*e.deployed+3*e.killed},structuresTotal:function(t){var e=rt.data[t];return 80*e.bunkers+140*e.walls+200*e.fortresses},weaponsTotal:function(t){var e=rt.data[t];return 40*e.cannons+60*e.missiles+400*e.nukes},resourcesTotal:function(t){var e=rt.data[t];return~~(e.food/20+e.culture/60+e.production/20)}},lt={colors:["#ffffff","#ffaa66","#ffcc99","#ffddaa","#ffff99","#ff5555","#ffff55"],randomColor:function(){return lt.colors[~~(6*e.random())]},getXY:function(t){var e=ct["unit"+t].getBBox();return{x:e.x,y:e.y}},icon:{troops:{audio:"",image:"troops.png",color:"#ff0"},energy:{audio:"",image:"energy.png",color:"#ffa"},food:{audio:"",image:"food.png",color:"#b5ff00"},production:{audio:"",image:"production.png",color:"#d60"},culture:{audio:"",image:"culture.png",color:"#d2d"},shield:{audio:"build",image:"tile-defense.png",color:"#ff0"}},upgrade:function(t,e,n){lt.icon[e].audio&&bt.play(lt.icon[e].audio);var i=ct["unit"+t].getBBox(),r=i.x+i.width/2-10,l=i.y+i.height/2+10,s=a.createElementNS("http://www.w3.org/2000/svg","g"),c=a.createElementNS("http://www.w3.org/2000/svg","text");c.setAttributeNS(null,"x",r-10),c.setAttributeNS(null,"y",l+10),c.style.fontFamily="FontAwesome",c.style.fontSize="20px",c.style.fill=lt.icon[e].color,n&&(c.textContent="+"+n);var u=a.createElementNS("http://www.w3.org/2000/svg","image");u.setAttributeNS(null,"width","3rem"),u.setAttributeNS(null,"height","3rem"),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/icons/"+lt.icon[e].image),u.setAttributeNS(null,"x",r+10),u.setAttributeNS(null,"y",l-20),s.appendChild(u),s.appendChild(c),ct.mapAnimations.appendChild(s),o.to([c,u],.5,{startAt:{xPercent:-50,yPercent:-50,transformOrigin:"50% 50%",alpha:1,scale:.1},scale:1,ease:d.easeOut.config(3)}),o.to([c,u],1.5,{y:"-=30"}),o.to([c,u],.5,{delay:1.5,alpha:0,onComplete:function(){s.parentNode.removeChild(s)}}),this.updateMapBars(t)},paths:function(){o.to(".paths > path",3,{startAt:{strokeDashoffset:0},strokeDashoffset:-12,repeat:-1,ease:Linear.easeNone})},updateMapBars:function(e){var a=ct["unit"+e].getBBox(),n=a.x+a.width/2-10,o=a.y+a.height/2+10;t(".mapBars"+e).remove(),this.initMapBars(e,n,o)},initMapBars:function(t,e,n){var o=ct["unit"+t],e=o.getAttribute("x")-25,n=o.getAttribute("y")-24,i=0;ut.tiles[t].food&&(i+=6),ut.tiles[t].production&&(i+=6),ut.tiles[t].culture&&(i+=6),ut.tiles[t].defense&&(i+=6);var r=5*ut.tiles[t].food;if(r>40&&(r=40),e+=5,i){c=a.createElementNS("http://www.w3.org/2000/svg","rect");if(c.setAttributeNS(null,"width",40),c.setAttributeNS(null,"height",i),c.setAttributeNS(null,"x",e),c.setAttributeNS(null,"y",n+26),c.setAttributeNS(null,"fill","#151515"),c.setAttributeNS(null,"stroke","#000000"),c.setAttributeNS(null,"stroke-width",1),c.setAttributeNS(null,"opacity",1),c.setAttributeNS(null,"class","mapBars"+t),ct.mapBars.appendChild(c),n+=23,ut.tiles[t].food){n+=6;(c=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",e),c.setAttributeNS(null,"y1",n),c.setAttributeNS(null,"x2",e+r),c.setAttributeNS(null,"y2",n),c.setAttributeNS(null,"stroke","#b5ff00"),c.setAttributeNS(null,"stroke-width",5),c.setAttributeNS(null,"opacity",1),c.setAttributeNS(null,"class","mapBars mapBars"+t),ct.mapBars.appendChild(c)}if(ut.tiles[t].production){n+=6;var l=10*ut.tiles[t].production;l>40&&(l=40);(c=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",e),c.setAttributeNS(null,"y1",n),c.setAttributeNS(null,"x2",e+l),c.setAttributeNS(null,"y2",n),c.setAttributeNS(null,"stroke","#d60"),c.setAttributeNS(null,"stroke-width",5),c.setAttributeNS(null,"opacity",1),c.setAttributeNS(null,"class","mapBars mapBars2x mapBars"+t),ct.mapBars.appendChild(c)}if(ut.tiles[t].culture){n+=6;var s=5*ut.tiles[t].culture;s>40&&(s=40);(c=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",e),c.setAttributeNS(null,"y1",n),c.setAttributeNS(null,"x2",e+s),c.setAttributeNS(null,"y2",n),c.setAttributeNS(null,"stroke","#dd22dd"),c.setAttributeNS(null,"stroke-width",5),c.setAttributeNS(null,"opacity",1),c.setAttributeNS(null,"class","mapBars mapBars"+t),ct.mapBars.appendChild(c)}if(ut.tiles[t].defense){n+=6;var c,u=10*ut.tiles[t].defense;(c=a.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"x1",e),c.setAttributeNS(null,"y1",n),c.setAttributeNS(null,"x2",e+u),c.setAttributeNS(null,"y2",n),c.setAttributeNS(null,"stroke","#ffff00"),c.setAttributeNS(null,"stroke-width",5),c.setAttributeNS(null,"opacity",1),c.setAttributeNS(null,"class","mapBars mapBars2x mapBars"+t),ct.mapBars.appendChild(c)}}},gunfire:function(t,n,i){var r=ct["unit"+t].getBBox(),l=ct["unit"+n].getBBox(),c=~~(9*e.random()),u=[.6,.6,.43,.43,.43,.43,.9,.43,.76,.43];i&&bt.play("machine"+c,null,.7);if(!ot&&!it&&!tt)for(var d=0;d<30;d++)!function(){var t=a.createElementNS("http://www.w3.org/2000/svg","path"),n=l.x+50*e.random()-25;y2=l.y+50*e.random()-15;var i=r.x+~~(16*e.random())-8,p=r.y+~~(16*e.random())-8,m=e.random()>.5?"M "+i+","+p+" "+n+","+y2:"M "+n+","+y2+" "+i+","+p;t.setAttributeNS(null,"stroke",lt.randomColor()),t.setAttributeNS(null,"stroke-width",1),ct.world.appendChild(t),o.to(t,.075,{delay:d/30*u[c],startAt:{attr:{d:m},drawSVG:"0%"},drawSVG:"0% 100%",ease:s.easeIn,onComplete:function(){o.to(t,.125,{drawSVG:"100% 100%",ease:s.easeOut,onComplete:function(){this.target.parentNode.removeChild(this.target)}})}})}()},cannons:function(t,n,i,r,l){var s=ct["unit"+t].getBBox(),c=ct["land"+n].getBBox(),u=ct["unit"+n].getBBox();if(r=r===G?.08:r,ut.tiles[n].player===dt.player){var d=~~(3*e.random());i&&bt.play("grenade"+[5,6,8][d])}var p=s.x+.5*s.width;y1=s.y+.5*s.height,w1=.5*c.width,w2=w1/2,h1=.5*c.height,h2=h1/2-10;for(var m=0;m<20;m++)!function(e){var n=a.createElementNS("http://www.w3.org/2000/svg","circle"),i=u.x+e.random()*w1-w2,s=u.y+e.random()*h1-h2;n.setAttributeNS(null,"cx",p),n.setAttributeNS(null,"cy",y1),n.setAttributeNS(null,"r",4),n.setAttributeNS(null,"fill",st.color[ut.player[ut.tiles[t].player].playerColor]),n.setAttributeNS(null,"stroke",lt.randomColor()),n.setAttributeNS(null,"strokeWidth",1),ct.mapAnimations.appendChild(n),o.to(n,r,{delay:.0125*m,startAt:{alpha:1},attr:{cx:i,cy:s},ease:Linear.easeNone,onComplete:function(){var t=.5*e.random()+.3,a=l===G?t/2:l,i=10*t+3;o.to(n,a,{startAt:{fill:"none",strokeWidth:0,attr:{r:0}},strokeWidth:i,attr:{r:i/2},ease:Linear.easeNone,onComplete:function(){o.to(n,a,{attr:{r:i},strokeWidth:0,ease:h.easeOut}),o.to(n,a,{alpha:0,onComplete:function(){this.target.parentNode.removeChild(this.target)},ease:h.easeOut})}})}})}(e);lt.smoke(n,u.x,u.y,.8)},missile:function(t,n,i){i&&bt.play("missile7");var r=ct["unit"+t],l=r.getBBox(),c=l.x+l.width/2,u=l.y+l.height/2,d=ct["unit"+n],p=d.getBBox(),m=p.x+p.width/2,g=p.y+p.height/2;dt.motionPath[0]=1*r.getAttribute("x")-10,dt.motionPath[1]=1*r.getAttribute("y")-10,dt.motionPath[4]=1*d.getAttribute("x")-10,dt.motionPath[5]=1*d.getAttribute("y")-10,dt.motionPath[2]=(dt.motionPath[0]+dt.motionPath[4])/2,dt.motionPath[3]=(dt.motionPath[1]+dt.motionPath[5])/2-e.abs(c-m)/3,o.set(ct.motionPath,{attr:{d:"M "+dt.motionPath[0]+","+dt.motionPath[1]+" "+ +dt.motionPath[4]+" "+dt.motionPath[5]}});var f=a.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttributeNS(null,"cx",c),f.setAttributeNS(null,"cy",u),f.setAttributeNS(null,"r",12),f.setAttributeNS(null,"fill",st.color[ut.player[ut.tiles[t].player].playerColor]),f.setAttributeNS(null,"stroke","#ffddaa"),f.setAttributeNS(null,"stroke-width",2),ct.mapAnimations.appendChild(f);var y=0;o.to(f,.1,{attr:{r:3},repeat:-1}),o.to(f,1,{startAt:{alpha:1,xPercent:-50,yPercent:-50},attr:{cx:m,cy:g},ease:s.easeIn,onUpdate:function(){if(++y%2==0){var t=a.createElementNS("http://www.w3.org/2000/svg","image");t.setAttributeNS(null,"height",40),t.setAttributeNS(null,"width",40),t.setAttributeNS(null,"opacity",1),t.setAttributeNS(null,"x",f.getAttribute("cx")-10),t.setAttributeNS(null,"y",f.getAttribute("cy")-10),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/smoke.png"),ct.mapAnimations.appendChild(t),o.to(t,.3,{startAt:{xPercent:-50,yPercent:-50,transformOrigin:"50% 50%"},scale:3,onComplete:function(){this.target.parentNode.removeChild(this.target)}}),o.to(t,.5,{alpha:0})}},onComplete:function(){this.target.parentNode.removeChild(this.target),lt.missileExplosion(n,st.color[ut.player[ut.tiles[t].player].playerColor])}})},missileExplosion:function(t,n){var i=ct["unit"+t].getBBox(),r=~~(3*e.random());bt.play("grenade"+[5,6,8][r]);for(var c=0,d=0,p=0;p<5;p++)!function(t){var e=a.createElementNS("http://www.w3.org/2000/svg","circle");c=i.x+60*t.random()-30,d=i.y+60*t.random()-30,e.setAttributeNS(null,"cx",c),e.setAttributeNS(null,"cy",d),e.setAttributeNS(null,"r",0),e.setAttributeNS(null,"fill",n),e.setAttributeNS(null,"stroke","#ffffaa"),ct.mapAnimations.appendChild(e);var r=.05*p;o.to(e,.75,{delay:r,attr:{r:32},onComplete:function(){o.to(e,1,{attr:{r:1},ease:l.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}})},ease:u.easeOut}),o.to(e,.1,{fill:"hsl(+=0%, +=0%, +="+~~(100*t.random())+"%)",repeat:-1}),o.to(e,1.75,{startAt:{alpha:1},alpha:0,ease:s.easeIn})}(e);lt.smoke(t,c,d,1)},nuke:function(t,e){var n=ct["unit"+t].getBBox(),i=n.x,r=n.y;shadow=a.createElementNS("http://www.w3.org/2000/svg","ellipse"),shadow.setAttributeNS(null,"cx",i),shadow.setAttributeNS(null,"cy",r),shadow.setAttributeNS(null,"rx",2),shadow.setAttributeNS(null,"ry",1),shadow.setAttributeNS(null,"fill","#000000"),shadow.setAttributeNS(null,"stroke","none"),ct.mapAnimations.appendChild(shadow),o.to(shadow,1,{startAt:{opacity:.5},attr:{rx:10,ry:5},ease:l.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}});var s=a.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",i),s.setAttributeNS(null,"cy",r-A.innerHeight),s.setAttributeNS(null,"r",15),s.setAttributeNS(null,"fill",st.color[ut.player[e].playerColor]),s.setAttributeNS(null,"stroke","#ffddaa"),s.setAttributeNS(null,"stroke-width",2),ct.mapAnimations.appendChild(s);o.to(s,.1,{attr:{r:3},ease:Linear.easeIn,repeat:-1}),o.to(s,1,{startAt:{alpha:1},attr:{cy:r},ease:l.easeIn,onComplete:function(){this.target.parentNode.removeChild(s)}}),o.to(st,1,{onComplete:function(){bt.play("bomb9"),o.to(ct.screenFlash,.05,{startAt:{opacity:.7,background:"#ffffff"},opacity:0,background:"#ff8800",ease:y.easeOut});var n=a.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",i),n.setAttributeNS(null,"cy",r),n.setAttributeNS(null,"r",1),n.setAttributeNS(null,"fill",st.color[ut.player[e].playerColor]),n.setAttributeNS(null,"stroke","#ffdd88"),ct.mapAnimations.appendChild(n),o.to(n,1.5,{startAt:{alpha:1},attr:{r:80},onComplete:function(){o.to(n,1,{attr:{r:50},ease:l.easeIn})},ease:c.easeOut}),o.to(n,.05,{fill:"hsl(+=0%, +=0%, +=20%)",repeat:-1,yoyo:!0,ease:g.config(6)}),o.to(n,2.5,{alpha:0,ease:u.easeIn,onComplete:function(){this.target.parentNode.removeChild(this.target)}}),lt.smoke(t,i,r),lt.smoke(t,i,r),lt.smoke(t,i,r),lt.smoke(t,i,r)}})},smoke:function(t,e,n,i){if(e===G){var r=lt.getXY(t);e=r.x,n=r.y}i===G&&(i=1.25);var l=a.createElementNS("http://www.w3.org/2000/svg","image");l.setAttributeNS(null,"width",256),l.setAttributeNS(null,"height",256),l.setAttributeNS(null,"x",e),l.setAttributeNS(null,"y",n),l.setAttributeNS(null,"opacity",0),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","images/smoke.png"),ct.mapUpgrades.appendChild(l),o.to(l,3,{startAt:{alpha:1,transformOrigin:"50% 50%",xPercent:-50,yPercent:-50,scale:0},ease:u.easeOut,scale:i}),o.to(l,3,{alpha:0,onComplete:function(){this.target.parentNode.removeChild(this.target)}})},screenShake:function(t,a,n,i){var r=0;!function t(e,a,n,l,s){var c=a/2;i&&r%2==0&&--a<2&&(a=2),o.to(l,n,{x:~~(s.random()*a-c),y:~~(s.random()*a-c),onComplete:function(){o.to(l,n,{x:~~(s.random()*a-c),y:~~(s.random()*a-c),onComplete:function(){o.to(l,n,{x:~~(s.random()*a-c),y:~~(s.random()*a-c),onComplete:function(){o.to(l,n,{x:0,y:0,onComplete:function(){++r<e&&t(e,a,n,l,s)}})}})}})}})}(t,a,n,ct.gameWrap,e)},selectTile:function(t,e){o.set(ct["land"+t],{fill:st.color[ut.player[ut.tiles[t].player].playerColor],stroke:ut.tiles[t].player?st.color[ut.player[ut.tiles[t].player].playerColor]:"#aaa",strokeDasharray:"none",strokeDashoffset:0,strokeWidth:1,onComplete:function(){ut.tiles[t].player&&o.set(this.target,{strokeWidth:1,stroke:"hsl(+=0%, +=0%, -=30%)"})}});var n=ct["land"+e].cloneNode(!0);ct.landWrap.appendChild(n),ct["land"+e].parentNode.removeChild(ct["land"+e]),ct["land"+e]=a.getElementById("land"+e);var i=st.color[ut.player[ut.tiles[e].player?ut.tiles[e].player:dt.player].playerColor],r=st.color[ut.player[ut.tiles[e].player?ut.tiles[e].player:0].playerColor];o.set(ct["land"+e],{fill:r,stroke:i,onComplete:function(){o.set(this.target,{stroke:"hsl(+=0%, +=0%, +=15)"})}}),o.to(ct["land"+e],.4,{startAt:{strokeDasharray:"5,5",strokeWidth:3,strokeDashoffset:0},strokeDashoffset:10,repeat:-1,ease:Linear.easeNone})},energyBar:function(){o.to(ct.energyIndicator,st.speed+1.5,{startAt:{strokeDasharray:"0,100"},force3D:!0,strokeDasharray:"100,100",ease:Linear.easeNone}),o.to(ct.currentYear,3,{startAt:{color:"#ff0"},color:"#fff"});var t={blur:10};o.to(t,1,{blur:0,onUpdate:function(){lt.blur(ct.currentYear,t.blur)},ease:Linear.easeIn})},blur:function(t,e){o.set(t,{filter:"blur("+e+"px)"})}};t.ajaxSetup({type:"POST",timeout:5e3}),o.defaultEase=Quad.easeOut;var st={msg:function(t,e){var n=a.getElementById("Msg");n.innerHTML=t,0===e?o.set(n,{overwrite:1,startAt:{opacity:1}}):((!e||e<.5)&&(e=2),o.to(n,$.delay(e),{overwrite:1,startAt:{opacity:1},onComplete:function(){o.to(this.target,.2,{opacity:0})}}));var r=new i,l=new SplitText(n,{type:"words,chars"}).chars;r.staggerFromTo(l,.01,{immediateRender:!0,alpha:0},{delay:.1,alpha:1},.01)},gameDuration:0,spectateStatus:0,modalSpeed:tt?0:.5,friends:[],ignore:[],color:["#02063a","#bb0000","#0077ff","#a5a500","#006000","#b06000","#33ddff","#b050b0","#5500aa","#660000","#0000bb","#663300","#33dd33","#222222","#00ff99","#ff6666","#ff00ff","#e4e4e4","#220088","#404000","#888888"],rankedMode:0,teamMode:0,joinedGame:!1,searchingGame:!1,defaultTitle:"Firmament Wars",titleFlashing:!1,name:"",password:"",speed:30,focusUpdateNationName:!1,focusGameName:!1,view:"title",resizeX:1,resizeY:1,sfxFood:!1,sfxCulture:!1,chatOn:!1,overlay:a.getElementById("overlay"),over:0,showSpectateButton:1,victory:!1,startTime:I.now(),keyLock:!1,loadAttempts:0,upgradeCost:[40,80,120],isModalOpen:!1,lock:function(t){st.overlay.style.display="block",st.overlay.style.opacity=void 0===t?0:1,st.keyLock=!0},unlock:function(t){st.overlay.style.display="none",st.overlay.style.opacity=t?0:1,st.keyLock=!1},unlockFade:function(t){t||(t=1),o.to(st.overlay,t,{startAt:{opacity:1},ease:c.easeIn,opacity:0,onComplete:function(){st.overlay.style.display="none"}})},TDC:function(){return new o.delayedCall(0,"")},screen:{resizeMap:function(){t("#mapStyle").remove();var e='<style id="mapStyle">#worldWrap{ position: absolute; top: 0%; left: 0%; width: '+st.map.sizeX/A.innerWidth*100+"%; height: "+st.map.sizeY/A.innerHeight*100+"%; }</style>";mt.head.append(e)}},mouse:{zoom:100,mouseTransX:50,mouseTransY:50},map:{sizeX:3200,sizeY:1500,name:"Earth Omega",key:"EarthOmega",tiles:85},updateUserInfo:function(){"localhost"!==n.host&&t.ajax({async:!0,type:"GET",dataType:"jsonp",url:"https://geoip-db.com/json/geoip.php?jsonp=?"}).done(function(e){e.latitude+="",e.longitude+="",st.geo=e,t.ajax({url:app.url+"php/updateUserInfo.php",data:{location:st.geo}}).done(function(){localStorage.setItem("geo",E.stringify(st.geo)),localStorage.setItem("geoSeason",1),localStorage.setItem("geoTime",I.now())})})},checkPlayerData:function(){var t=localStorage.getItem(dt.account+"_geo"),e=localStorage.getItem(dt.account+"_geoTime"),a=localStorage.getItem(dt.account+"_geoSeason");null!==e||null===a?(I.now()-e>7776e3||null===a)&&st.updateUserInfo():null===t&&st.updateUserInfo();var n=localStorage.getItem("ignore");if(null!==n)st.ignore=E.parse(n);else{localStorage.setItem("ignore",E.stringify([]))}},config:{audio:{musicVolume:10,soundVolume:50}},geo:{},keepAlive:function(){t.ajax({type:"GET",url:app.url+"php/keepAlive.php"}).always(function(){v(st.keepAlive,12e4)})},removeContainers:function(){t("#firmament-wars-logo-wrap, #mainWrap").remove()},notification:{},sendNotification:function(t){a.hasFocus()||"game"===st.view||"function"!=typeof Notification||Notification.requestPermission().then(function(e){if("granted"===e){var n=" says: ";if(t.flag&&(t.msg||t.message)){"chat-whisper"===t.type&&(n=" whispers: ");var o=t.account+n,i=t.flag.replace(/-/g," ")+("Nepal"===t.flag?".png":".jpg");st.notification=new Notification(o,{icon:"images/flags/"+i,tag:"Firmament Wars",body:t.msg?t.msg:t.message}),st.notification.onclick=function(){A.focus()},st.titleFlashing||(st.titleFlashing=!0,function t(e){a.hasFocus()||(a.title=e%2==0?o:st.defaultTitle,v(t,3e3,++e))}(0)),bt.play("chat")}}})},chat:function(t,e){var a={message:t,type:e};"title"===st.view?yt.chat(a):"lobby"===st.view?ht.chat(a):ut.chat(a)},getRandomFlag:function(){var t=[],a=0;for(var n in st.flagData)st.flagData[n].name.forEach(function(e){t[a++]=e});var o=t.length,i=~~(e.random()*o);return t[i]},flagData:{Africa:{group:"Africa",name:["Algeria","Botswana","Cameroon","Cape Verde","Ivory Coast","Egypt","Ghana","Kenya","Liberia","Morocco","Mozambique","Namibia","Nigeria","South Africa","Uganda"]},Asia:{group:"Asia",name:["Bangladesh","Cambodia","China","Hong Kong","India","Indonesia","Iran","Japan","Malaysia","Mongolia","Myanmar","Nepal","North Korea","Pakistan","Philippines","Singapore","South Korea","Sri Lanka","Suriname","Taiwan","Thailand","Vietnam"]},Europe:{group:"Europe",name:["Albania","Austria","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Czech Republic","Denmark","England","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Ireland","Italy","Kosovo","Latvia","Lithuania","Macedonia","Montenegro","Netherlands","Norway","Poland","Portugal","Romania","Russia","Scotland","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Ukraine","United Kingdom","Vatican City"]},Eurasia:{group:"Eurasia",name:["Armenia","Azerbaijan","Georgia","Kazakhstan","Uzbekistan"]},Historic:{group:"Historic",name:["Benin Empire","Byzantine Empire","Confederate Flag","Flanders","Gadsden Flag","Holy Roman Empire","Isle of Man","Rising Sun Flag","NSDAP Flag","NSDAP War Ensign","Ottoman Empire","Rhodesia","Shahanshahi","USSR","Veneto","Welsh"]},MiddleEast:{group:"Middle East",name:["Israel","Jerusalem","Jordan","Kurdistan","Lebanon","Palestine","Qatar","Saudi Arabia","Syria","Turkey"]},NorthAmerica:{group:"North America",name:["Bahamas","Barbados","Canada","Costa Rica","Cuba","Haiti","Honduras","Mexico","Saint Lucia","Trinidad and Tobago","United States"]},Oceania:{group:"Oceania",name:["Australia","New Zealand"]},US_States:{group:"US States",name:["Alaska","Alabama","Arkansas","Arizona","California","Maryland","Mississippi","Montana","South Carolina","Texas","Virginia"]},Miscellaneous:{group:"Miscellaneous",name:["Anarcho-Capitalist","Anarcho-Syndicalist","Cascadia","European Union","ISIS","Jefferson State","Jolly Roger","Northwest Front","Pan-African Flag","Rainbow Flag","Sicily","United Nations"]},SouthAmerica:{group:"South America",name:["Argentina","Bolivia","Brazil","Chile","Colombia","Ecuador","Paraguay","Peru","Uruguay","Venezuela"]}},initGameCallback:function(e){app.isApp?t("#logout").remove():t("#logout").css("display","inline-block"),o.staggerTo(a.getElementsByClassName("action-btn"),.5,{startAt:{x:-30},x:0,opacity:1},.1),dt.channel=e.initChannel,t(".timer-tooltips, #currentYear, .actionButtons").tooltip({animation:!1,placement:"left",container:"body"}),t("[title]").tooltip({animation:!1,placement:"bottom",container:"body"}),e.account?(app.account=e.account,isLoggedIn=1,t("#logout").text("Logout "+e.account),app.isApp&&t("#login-modal").remove(),yt.chat({message:"There are "+e.currentPlayers+" people playing Firmament Wars."}),a.getElementById("updateNationFlag").src="images/flags/"+e.flag,a.getElementById("selectedFlag").textContent=e.flagShort,yt.refreshGamesCallback(e.games),dt.account=e.account,dt.flag=e.flag,dt.rating=e.rating,st.checkPlayerData(),yt.friendGetCallback(e.friends)):notLoggedIn();var n=a.getElementById("firmamentWarsLogo"),i={shadow:2,brightness:100};o.to(i,3,{overwrite:1,shadow:12,brightness:150,repeat:-1,yoyo:!0,ease:u.easeIn,onUpdate:function(){!function(t){n.style.filter="drop-shadow(0px 0px "+t.shadow+"px #048) brightness("+t.brightness+"%)"}(i)}}),vt.init(),e.isNewAccount&&yt.configureNation()}};st.init=function(){st.lock(),app.isApp&&(t("#exit-game").on("click",function(){yt.exitGame()}),t("#resync").remove());var e="";for(var i in st.flagData)e+="<li class='dropdown-header'>"+st.flagData[i].group+"</li>",st.flagData[i].name.forEach(function(t){e+="<li><a class='flagSelect no-select'>"+t+"</a></li>"});if(a.getElementById("flagDropdown").innerHTML=e,o.to("#title-stars-1",50,{startAt:{backgroundPosition:"0"},force3D:!0,backgroundPosition:"-1920px",repeat:-1,ease:Linear.easeNone}),o.to("#title-stars-2",75,{startAt:{backgroundPosition:"200px -200px"},backgroundPosition:"-1720px -200px",repeat:-1,ease:Linear.easeNone}),o.to("#title-stars-3",100,{startAt:{backgroundPosition:"400px -400px"},backgroundPosition:"-1520px -400px",repeat:-1,ease:Linear.easeNone}),o.to("#title-backdrop",12,{startAt:{scale:1,transformOrigin:"0% 100%"},scale:3,repeat:-1,yoyo:!0,ease:l.easeInOut}),o.to("#firmamentWarsBG",1,{startAt:{y:"-47%"},y:"-50%",onComplete:function(){o.to("#firmamentWarsBG",10,{startAt:{scale:1},scale:1.08,repeat:-1,yoyo:!0,ease:l.easeInOut})}}),app.isApp){st.lock(1),st.msg("Verifying Steam Credentials...");var r=require("./greenworks"),s={screenName:"",steamid:"",handle:0};if(r.initAPI()){r.init();var c=r.getSteamId();s.screenName=c.screenName,s.steamid=c.steamId,r.getAuthSessionTicket(function(e){s.handle=e.handle,t.ajax({type:"POST",url:app.url+"php/init-game.php",data:{screenName:s.screenName,steamid:s.steamid,ticket:e.ticket.toString("hex")}}).done(function(t){st.initGameCallback(t),r.cancelAuthTicket(s.handle)}).fail(function(t){st.msg(t.responseText)})})}else st.msg("Unable to detect Steam. Run Steam prior to launching!")}else t.ajax({type:"POST",url:app.url+"php/init-game.php",data:{screenName:"",steamid:"",ticket:""}}).done(function(t){st.initGameCallback(t)}).fail(function(t){st.msg(t.responseText)});("localhost"===n.hostname&&"#stop"!==n.hash||localStorage.getItem("resync")&&!1!==localStorage.getItem("reload"))&&(localStorage.setItem("resync",0),t.ajax({type:"GET",url:app.url+"php/rejoinGame.php"}).done(function(t){t.gameId>0&&(dt.player=t.player,dt.playerColor=t.player,st.teamMode=t.teamMode,st.rankedMode=t.rankedMode,dt.team=t.team,ut.id=t.gameId,st.map=t.mapData,v(function(){ht.init(t),ht.join(0),H(t),dt.government=t.government,ht.updateGovernmentWindow(dt.government),vt.joinGame()},111))}).fail(function(t){st.msg(t.responseText)}))}();var ct,ut={name:"",tiles:[],initialized:!1,ribbonTitle:["","National Combat Medal","Clandestine Service Citation","Good Conduct Award","Ceremonial Commendation Ribbon","Civic Service Ribbon","Bronze Campaign Medal","Bronze Service Medal","Bronze Expeditionary Medal","Bronze Cross","Silver Cross","Golden Cross","Platinum Cross","Revolutionary Cause Award","Strategic Warfare Award","Combat Service Award","Combat Gallantry Award","Stalwart Campaign Medal","Tactical Nuke Commendation Award","Holy Trips Ribbon","Sweet Quads Ribbon","Double Dubs Ribbon","Glorious Pents Ribbon","Wicked Sexts Ribbon","Triple Dubs Ribbon","Righteous Septs Ribbon","Almighty Octs Ribbon","Quad Dubs Ribbon","Champion's Medal","Conqueror's Medal","Commander's Medal","Intrepid Heroism Award","Global War Expeditionary Medal","Silver Expeditionary Medal","Silver Campaign Medal","Silver Service Medal","Engineer's Service Ribbon"],ribbonDescription:["","Established your nation","Joined a private game","Added two comrades to your friend list","Updated your national flag","Updated your nation's name","Won 10 ranked games","Won 10 team games","Won 10 FFA games","Achieved 1800+ rating","Achieved 2100+ rating","Achieved 2400+ rating","Achieved 2700+ rating","Great Revolutionary conquered a tile with 100+ units","Win a game with a 2:1 kill ratio","Won 10+ games in a row","Won 25+ games in a row","Completed all scenarios","Destroyed a fortress with a nuclear weapon","Scored holy trips","Scored sweet quads","Scored double dubs","Scored glorious pents","Scored wicked sexts","Scored a triple double","Scored righteous septs","Scored almighty octs","Scored sick quad dubs","Hit top #10 on the ranked leaderboard","Hit top #100 on the ranked leaderboard","Hit top #1000 on the ranked leaderboard","Defeated the Juggernaut","Win an 8-player FFA game","Won 100 FFA games","Won 100 ranked games","Won 100 team games","Build a fortress"],toggleGameWindows:function(){var e="visible"===t("#targetWrap").css("visibility");o.set(ct.gameWindows,{visibility:e?"hidden":"visible"}),e?o.to("#hotkey-ui",.5,{startAt:{opacity:0,visibility:"visible"},opacity:1}):o.to("#hotkey-ui",.5,{visibility:"hidden"})},player:[0,0,0,0,0,0,0,0,0],initMap:function(){!function(t,e){for(var a=0;a<e;a++)ct["land"+a]=t.getElementById("land"+a),ct["flag"+a]=t.getElementById("flag"+a),ct["unit"+a]=t.getElementById("unit"+a)}(a,ut.tiles.length)},chat:function(t){for(;ct.chatContent.childNodes.length>10;)ct.chatContent.removeChild(ct.chatContent.firstChild);var e=a.createElement("div");t.type&&(e.className=t.type),e.innerHTML=t.message,ct.chatContent.appendChild(e),v(function(){e!==G&&null!==e.parentNode&&o.to(e,$.delay(.125),{alpha:0,onComplete:function(){null!==e.parentNode&&e.parentNode.removeChild(e)}})},12e3)},eliminatePlayer:function(e){var a=e.player,n=0,i=0,r=[];ut.player[a].alive=!1,ut.player.forEach(function(t,e){t.account&&t.alive&&(t.cpu||(n++,-1===r.indexOf(t.team)&&r.push(t.team)),t.cpu&&i++)}),t("#diplomacyPlayer"+a).removeClass("alive"),st.teamMode?r.length<=1&&(st.showSpectateButton=0):n<=1&&(st.showSpectateButton=0),st.over||(a===dt.player?(new Audio("sound/shotgun2.mp3"),t.ajax({type:"GET",url:app.url+"php/gameDefeat.php"}).done(function(t){var e="";t.ceaseFire?e='<p>Armistice!</p>\t\t\t<div>The campaign has been suspended!</div>\t\t\t<div id="ceaseFire" class="endBtn">\t\t\t\t<div class="modalBtnChild">Cease Fire</div>\t\t\t</div>':t.gameDone&&(e="<p>Defeat!</p>\t\t\t<div>Your campaign for world domination has failed!</div>",st.showSpectateButton&&(e+='<div id="spectate" class="endBtn">\t\t\t\t\t<div class="modalBtnChild">Spectate</div>\t\t\t\t</div>'),e+='<div id="endWar" class="endBtn">\t\t\t\t<div class="modalBtnChild">Concede Defeat</div>\t\t\t</div>'),e&&F(e)}).fail(function(t){})):st.teamMode?r.length<=1&&v(function(){P()},1e3):n<=1&&!i&&v(function(){P()},1e3)),o.to("#diplomacyPlayer"+a,1,{autoAlpha:0,onComplete:function(){t("#diplomacyPlayer"+a).css("display","none")}}),o.to("#diplomacyPlayer"+a,1,{startAt:{transformPerspective:400,transformOrigin:"50% 0",rotationX:0},paddingTop:0,paddingBottom:0,height:0,rotationX:-90}),ut.removePlayer(a)},removePlayer:function(t){ut.tiles[t].account="",ut.tiles[t].nation="",ut.tiles[t].flag="";for(var e=0,a=ut.tiles.length;e<a;e++)ut.tiles[e].player===t&&(ut.tiles[e].account="",ut.tiles[e].defense="",ut.tiles[e].flag="",ut.tiles[e].nation="",ut.tiles[e].player=0,ut.tiles[e].units=0,ut.tiles[e].tile=e,ut.updateTile(ut.tiles[e]))},getGameState:function(){t.ajax({type:"GET",url:app.url+"php/getGameState.php"}).done(function(t){for(var e=0,a=t.tiles.length;e<a;e++){var n=t.tiles[e],i=!1;if(n.player!==ut.tiles[e].player){ut.tiles[e].units||o.set(ct["unit"+e],{visibility:"visible"}),ut.tiles[e].player=n.player,ut.tiles[e].account=ut.player[n.player].account,ut.tiles[e].nation=ut.player[n.player].nation,ut.tiles[e].flag=ut.player[n.player].flag,dt.tgt===e&&(i=!0);var r=ut.player[n.player].flag?ut.player[n.player].flag:"blank.png";null!==ct["flag"+e]&&(ct["flag"+e].href.baseVal="images/flags/"+r),o.set(ct["land"+e],{fill:st.color[ut.player[n.player].playerColor],stroke:n.player?st.color[ut.player[n.player].playerColor]:"#aaa",strokeWidth:1,onComplete:function(){n.player&&o.set(this.target,{stroke:"hsl(+=0%, +=0%, -=30%)"})}})}if(n.units!==ut.tiles[e].units){var l=n.units>ut.tiles[e].units?"#00ff00":"#ff0000";ut.tiles[e].units=n.units,dt.tgt===e&&(i=!0),D(e,l)}i&&$.showTarget(ct["land"+e])}}).fail(function(t){})},updateDefense:function(t){var e=t.tile;ut.tiles[e].defense=t.defense,lt.updateMapBars(e),dt.tgt===e&&$.showTarget(ct["land"+dt.tgt])},updateTile:function(t){var e=1*t.tile,a=t.player;ut.tiles[e].player=a,ut.tiles[e].account=ut.player[a].account,ut.tiles[e].nation=ut.player[a].nation,ut.tiles[e].flag=ut.player[a].flag;var n=ut.player[a].flag?ut.player[a].flag:ut.tiles[e].units?"Player0.jpg":"blank.png";if(null!==ct["flag"+e]&&(ct["flag"+e].href.baseVal="images/flags/"+n),o.set(ct["land"+e],{fill:st.color[ut.player[a].playerColor],stroke:a?st.color[ut.player[a].playerColor]:"#aaa",strokeWidth:1,onComplete:function(){a&&o.set(this.target,{stroke:"hsl(+=0%, +=0%, "+(dt.tgt===e?"+=15%)":"-=30%)")})}}),t.units){if(t.units!==ut.tiles[e].units){var i=t.units>ut.tiles[e].units?"#00ff00":"#ff0000";ut.tiles[e].units=t.units,D(e,i)}o.set(ct["unit"+e],{visibility:"visible"})}else ut.tiles[e].units=0,o.set(ct["unit"+e],{visibility:"hidden"});dt.tgt===e&&$.showTarget(ct["land"+e])},setSumValues:function(){for(var t={food:0,production:0,culture:0},e=0;e<st.tileCount;e++)dt.player===ut.tiles[e].player&&(t.food+=ut.tiles[e].food,t.production+=ut.tiles[e].production,t.culture+=ut.tiles[e].culture)},energyTimer:0,startGameState:function(){ut.getGameState(),ut.energyTimer=b(ut.updateResources,1e3*st.speed),lt.energyBar(),delete ut.startGameState},countAlivePlayers:function(){var t=0;return ut.player.forEach(function(e){e.alive&&e.account&&t++}),t},triggerNextTurn:function(t){k(ut.energyTimer),ut.energyTimer=b(ut.updateResources,1e3*st.speed),ut.updateResources(),lt.energyBar()},updateResources:function(){if(!st.over){var e=0,a=0;ut.player.forEach(function(t){t.alive&&(t.cpu?Ct.takeTurn(t):0===t.cpu&&(e||(e=1,t.account===dt.account&&(a=1))))}),t.ajax({url:app.url+"php/updateResources.php",data:{pingCpu:a,resourceTick:st.resourceTick}}).done(function(t){st.resourceTick=t.resourceTick,U(t),$.setCurrentYear(t.resourceTick),ut.reportMilestones(t),lt.energyBar()}).fail(function(t){O()})}},reportMilestones:function(t){if(t.cultureMsg!==G&&t.cultureMsg){var e={message:t.cultureMsg};ut.chat(e),bt.play("culture"),bt.play("cheer3"),R()}}},dt={window:"Full Screen",lastReceivedWhisper:"",account:"",channel:"",player:0,playerColor:0,team:0,gameName:"Earth Alpha",max:8,tgt:1,lastTgt:1,capital:0,lastTarget:{},units:0,food:0,production:25,culture:0,oBonus:-1,dBonus:-1,productionBonus:-1,foodBonus:-1,cultureBonus:-1,sumProduction:10,foodMax:25,cultureMax:300,manpower:0,focusTile:0,moves:4,sumMoves:4,sumFood:0,sumProduction:0,sumCulture:0,flag:"",targetLine:[0,0,0,0,0,0],motionPath:[0,0,0,0,0,0],attackOn:!1,splitAttack:!1,splitAttackCost:1,attackCost:2,deployCost:1,rushCost:2,weaponCost:1,maxDeployment:12,buildCost:1,targetData:{},selectedFlag:"Default",selectedFlagFull:"Default.jpg",government:"Despotism",tech:{masonry:0,construction:0,engineering:0,gunpowder:0,rocketry:0,atomicTheory:0},hud:function(t,e){pt.hud.kill(),ct.hud.style.visibility="visible",ct.hud.textContent=t,e&&(pt.hud=o.to(ct.hud,5,{onComplete:function(){ct.hud.style.visibility="hidden"}}))},clearHud:function(){pt.hud.kill(),ct.hud.style.visibility="hidden",o.set([ct.targetLine,ct.targetLineBorder,ct.targetLineShadow,ct.targetCrosshair],{visibility:"hidden",strokeDashoffset:0}),t("#style-land-pointer").remove(),mt.head.append('<style id="style-land-pointer">.land{ cursor: pointer; }</style>')},checkSelectLastTarget:function(){ut.tiles[dt.tgt].player!==dt.player&&(ut.tiles[dt.lastTgt].player===dt.player?dt.nextTarget(!1,dt.lastTgt):dt.nextTarget(!1))},nextTarget:function(t,a){if(!st.spectateStatus){dt.lastTgt=dt.tgt;var n=0,o=ut.tiles.length;for(a===G?t?dt.tgt--:dt.tgt++:dt.tgt=a,dt.tgt<0&&(dt.tgt=o-1);n<255&&dt.player!==ut.tiles[dt.tgt%o].player;)t?dt.tgt--:dt.tgt++,dt.tgt<0&&(dt.tgt=o-1),n++;dt.tgt=a===G?t?e.abs(dt.tgt):dt.tgt%o:a,dt.focusTile(dt.tgt,.1),lt.selectTile(dt.lastTgt,dt.tgt)}},focusTile:function(t,e){var a=ct["land"+t];if(null!==a){var n=a.getBBox();e===G&&(e=.5);var i=512-n.x;i>0&&(i=0);var r=-1*(st.map.sizeX-A.innerWidth);i<r&&(i=r);var l=234-n.y;l>0&&(l=0);var s=-1*(st.map.sizeY-A.innerHeight);l<s&&(l=s),o.to(ct.worldWrap,$.delay(e),{force3D:!1,x:i*st.resizeX,y:l*st.resizeY}),$.showTarget(ct["land"+t],!1,1),dt.flashTile(t)}},flashTile:function(t){dt.attackOn||ut.tiles[t].units&&o.set(ct["unit"+t],{visibility:"visible"})}},pt={hud:st.TDC()};L();var mt={head:t("#head"),chatInputOpen:t("#chat-input-open"),chatInputWrap:t("#chat-input-wrap"),chatInput:t("#chat-input"),lobbyChatInput:t("#lobby-chat-input"),titleChatInput:t("#title-chat-input")},gt=[],ft={cache:{},load:{game:function(){for(var t=["smoke.png"],e=0,a=t.length;e<a;e++){var n=t[e];ft.cache[n]=new Image,ft.cache[n].src="images/"+n}}}},yt={players:[],games:[],getLeaderboard:function(e){var n=a.getElementById("leaderboardBody");n.innerHTML="",st.lock(),t.ajax({url:app.url+"php/leaderboard.php",data:{type:e}}).done(function(t){n.innerHTML=t.str,st.unlock()})},refreshTimer:0,refreshGames:function(){I.now()-yt.refreshTimer>5e3&&(yt.refreshTimer=I.now(),st.lock(1),t("#title-chat-input").focus(),o.to("#refresh-game-button",1,{rotation:"+=360",ease:Linear.easeIn}),t.ajax({type:"GET",url:app.url+"php/refreshGames.php"}).done(function(t){yt.refreshGamesCallback(t.games)}).fail(function(t){}).always(function(){st.unlock()}))},refreshGamesCallback:function(t){var e=a.getElementById("gameTableBody");if(null!==e){for(var n="",o=0,i=t.length;o<i;o++){var r=t[o];yt.games[r.id]=1*r.players,n+="<tr id='game_"+r.id+"' class='shadow4 wars wars-"+r.gameMode+" no-select' data-name='"+r.name+"'>\t\t\t\t<td class='warCells'>"+r.name+"</td>\t\t\t\t<td class='warCells'>"+r.map+"</td>\t\t\t\t<td class='warCells'>"+r.gameMode+"</td>\t\t\t</tr>"}e.innerHTML=n}},init:void t(a).ready(function(){t("#titleChatLog").on("mousedown",function(){yt.chatDrag=!0}).on("mouseup",function(){yt.chatDrag=!1}),t("#title-chat-input").on("focus",function(){yt.chatOn=!0}).on("blur",function(){yt.chatOn=!1}),t(".createGameInput").on("focus",function(){yt.createGameFocus=!0}).on("blur",function(){yt.createGameFocus=!1}),t("#login-container").on($.click,".nw-link",function(){yt.openWindow(t(this).attr("href"))}),v(function(){st.keepAlive()},18e4)}),updateTimer:0,updatePlayers:function(e){w(yt.updateTimer),yt.titleUpdate=t("#titleChatPlayers").length,yt.titleUpdate?function a(){isLoggedIn&&"title"===st.view&&t.ajax({type:"POST",url:app.url+"php/titleUpdate.php",data:{channel:dt.channel}}).done(function(t){yt.updatePlayerCallback(t)}).always(function(){e||(yt.updateTimer=v(a,5e3))})}():t("#titleChat, #titleMenu").remove()},updatePlayerCallback:function(t){if("title"===st.view){if(t.playerData!==G){for(var e=[],n=0,o=(m=t.playerData).length;n<o;n++){var i=m[n].account,r=m[n].flag,l=m[n].rating;if(yt.players[i]===G)yt.addPlayer(i,r,l);else if(yt.players[i].flag!==r){var s=a.getElementById("titlePlayerFlag_"+i);if(null!==s){var c=r.split(".");s.className="flag "+c[0].replace(/ /g,"-")}}e.push(i)}for(var u in yt.players)if(-1===e.indexOf(u)){var d={account:u};yt.removePlayer(d)}}a.getElementById("titleChatHeaderCount").textContent=o!==G?"("+o+")":"";var p=[];if(t.gameData!==G)for(var m=t.gameData,n=0,o=m.length;n<o;n++)p[m[n].id]={players:1*m[n].players,max:1*m[n].max};yt.games.forEach(function(t,e){if(p[e]===G){a={id:e};yt.removeGame(a)}else if(p[e].players!==yt.games[e]){var a={id:e,players:p[e].players,max:p[e].max};yt.setToGame(a)}})}},addPlayer:function(t,e,n){yt.players[t]={flag:e};o=a.getElementById("titlePlayer"+t);null!==o&&o.parentNode.removeChild(o);var o;(o=a.createElement("div")).className="titlePlayer",o.id="titlePlayer"+t;var i=e.split(".");i=i[0].replace(/ /g,"-"),o.innerHTML='<div id="titlePlayerFlag_'+t+'" class="flag '+i+'"></div><span class="chat-rating">['+n+']</span> <span class="titlePlayerAccount">'+t+"</span>",t&&e&&yt.titleUpdate&&ct.titleChatBody.appendChild(o)},removePlayer:function(t){delete yt.players[t.account];var e=a.getElementById("titlePlayer"+t.account);null!==e&&e.parentNode.removeChild(e)},updateGame:function(t){"addToGame"===t.type?yt.addToGame(t):"removeFromGame"===t.type?yt.removeFromGame(t):"addGame"===t.type?yt.addGame(t):"removeGame"===t.type&&yt.removeGame(t)},updatePlayerText:function(t){var e=a.getElementById("game_players_"+t);null!==e&&(e.textContent=yt.games[t])},setToGame:function(t){var e=t.id;yt.games[e]=t.players},addToGame:function(t){var e=t.id;yt.games[e]!==G?yt.games[e]+1>t.max?yt.games[e]=t.max:yt.games[e]++:yt.games[e]=1},removeFromGame:function(t){var e=t.id;yt.games[e]!==G?yt.games[e]-1<1?yt.games[e]=1:yt.games[e]--:yt.games[e]=1},addGame:function(t){yt.games[t.id]=1;var e=a.createElement("tr"),n="Ranked"===t.gameMode?"Ranked":"Team"===t.gameMode?"Team":"FFA";e.id="game_"+t.id,e.className="shadow4 wars wars-"+n+" no-select",e.setAttribute("data-name",t.name),e.innerHTML="<td class='warCells'>"+t.name+"</td>\t\t\t<td class='warCells'>"+t.map+"</td>\t\t\t<td class='warCells'>"+n+"</td>",ct.gameTableBody.insertBefore(e,ct.gameTableBody.childNodes[0])},removeGame:function(t){delete yt.games[t.id];var e=a.getElementById("game_"+t.id);null!==e&&e.parentNode.removeChild(e)},mapData:{EarthOmega:{name:"Earth Omega",tiles:78,players:8},FlatEarth:{name:"Flat Earth",tiles:78,players:8},France:{name:"France",tiles:81,players:8},Italy:{name:"Italy",tiles:81,players:8},Japan:{name:"Japan",tiles:47,players:4},Turkey:{name:"Turkey",tiles:75,players:7},UnitedKingdom:{name:"United Kingdom",tiles:69,players:8},UnitedStates:{name:"United States",tiles:48,players:3}},chatDrag:!1,chatOn:!1,scrollBottom:function(){yt.chatDrag||(ct.titleChatLog.scrollTop=ct.titleChatLog.scrollHeight)},chat:function(t){if("title"===st.view&&t.message){for(;ct.titleChatLog.childNodes.length>500;)ct.titleChatLog.removeChild(ct.titleChatLog.firstChild);"inserted-image"===t.type&&function t(e){++e<10&&(yt.scrollBottom(),v(t,200,e))}(0);var e=a.createElement("div");t.type&&(e.className=t.type),e.innerHTML=t.message,ct.titleChatLog.appendChild(e),yt.scrollBottom()}},friendGet:function(){st.friends=[],t.ajax({type:"GET",url:app.url+"php/friendGet.php"}).done(function(t){yt.friendGetCallback(t.friends)})},friendGetCallback:function(t){t.forEach(function(t){st.friends.push(t)})},toggleFriend:function(e){(e=e.trim())!==dt.account?t.ajax({url:app.url+"php/friendToggle.php",data:{account:e}}).done(function(t){"fail"===t.action?st.chat("You cannot have more than 20 friends!"):"remove"===t.action?(st.chat("Removed "+e+" from your friend list"),yt.friendGet()):"add"===t.action&&(st.chat("Added "+e+" to your friend list"),yt.friendGet())}):st.chat("You can't be friends with yourself!","chat-muted")},listIgnore:function(){var t=st.ignore.length;st.chat("<div>Ignore List ("+t+")</div>");for(var e=0;e<t;e++){var a='<div><span class="chat-muted titlePlayerAccount">'+st.ignore[e]+"</span></div>";st.chat(a)}},addIgnore:function(t){t=t.toLowerCase().trim(),st.chat("<div>Ignoring "+t+"</div>"),-1===st.ignore.indexOf(t)&&t?st.ignore.length<20?t!==dt.account?(st.ignore.push(t),localStorage.setItem("ignore",E.stringify(st.ignore)),st.chat("Now ignoring account: "+t,"chat-muted")):st.chat("<div>You can't ignore yourself!</div><img src='images/chat/random/autism.jpg'>","chat-muted"):st.chat("You cannot ignore more than 20 accounts!","chat-muted"):st.chat("Already ignoring "+t+"!","chat-muted")},removeIgnore:function(t){if((t=t.toLowerCase().trim())&&st.ignore.indexOf(t)>-1){var e=st.ignore.indexOf(t);st.ignore.splice(e,1),localStorage.setItem("ignore",E.stringify(st.ignore)),st.chat("Stopped ignoring account: "+t,"chat-muted")}else st.chat(t+" is not on your ignore list.","chat-muted")},chatReceive:function(t){"title"===st.view?"remove"===t.type?yt.removePlayer(t):"add"===t.type?yt.addPlayer(t.account,t.flag,t.rating):t.message!==G&&yt.chat(t):"lobby"===st.view?"hostLeft"===t.type?ht.hostLeft():"lobby-set-cpu-difficulty"===t.type?ht.updateDifficulty(t):"updateGovernment"===t.type?ht.updateGovernment(t):"updatePlayerColor"===t.type?ht.updatePlayerColor(t):"updateTeamNumber"===t.type?ht.updateTeamNumber(t):"countdown"===t.type?ht.countdown(t):"updateLobbyPlayer"===t.type?ht.updatePlayer(t):"updateLobbyCPU"===t.type?ht.updateCPU(t):t.message!==G&&ht.chat(t):("cannons"===t.type?(lt.cannons(t.attackerTile,t.tile,!0),ut.updateTile(t)):"missile"===t.type?lt.missile(t.attacker,t.defender,!0):"nuke"===t.type?v(function(){lt.nuke(t.tile,t.attacker)},5e3):"nukeHit"===t.type?(ut.updateTile(t),ut.updateDefense(t)):"gunfire"===t.type?(lt.gunfire(t.attackerTile,t.tile,t.player===dt.player||t.playerB===dt.player),lt.cannons(t.attackerTile,t.tile,!1,0,.175,10),ut.updateTile(t),t.rewardUnits&&lt.upgrade(t.tile,"troops",t.rewardUnits)):"updateTile"===t.type?(ut.updateTile(t),ut.setSumValues(),t.rewardUnits&&lt.upgrade(t.tile,"troops",t.rewardUnits),"sniper0"===t.sfx&&lt.upgrade(t.tile,"culture")):"food"===t.type?t.account.indexOf(dt.account)>-1&&bt.play("hup2"):"upgrade"===t.type?(ut.updateDefense(t),lt.upgrade(t.tile,"shield")):"eliminated"===t.type?ut.eliminatePlayer(t):"endTurnCheck"===t.type?ut.triggerNextTurn(t):"disconnect"===t.type&&ut.eliminatePlayer(t),t.message&&("gunfire"===t.type?t.defender===dt.account&&ut.chat(t):ut.chat(t)),t.sfx&&bt.play(t.sfx))},sendWhisper:function(e,a){var n=e.split(a)[1].split(" ").shift(),o=a.length,i=n.length,e=e.substr(o+i+1),r=dt.flag.split(".");r=r[0].replace(/ /g,"-"),t.ajax({url:app.url+"php/insertWhisper.php",data:{account:n,flag:r,playerColor:dt.playerColor,message:e,action:"send"}})},lastWhisper:{account:"",message:"",timestamp:0},receiveWhisper:function(t){"title"===st.view?yt.chat(t):"lobby"===st.view?ht.chat(t):ut.chat(t)},changeChannel:function(t,e){var a=t.split(e);vt.setChannel(a[1])},who:function(e){var a=e.split("/who ");t.ajax({url:app.url+"php/whoUser.php",data:{account:a[1]}}).done(function(t){var e='<div class="who-wrap"><div class="who-wrap-left">';e+=t.str,t.account!==dt.account&&-1===st.friends.indexOf(t.account)&&(e+='<button style="pointer-events: initial" class="addFriend btn btn-xs fwBlue" data-account="'+t.account+'">Add Friend</button>'),e+='</div><div class="who-wrap-right">',e+='<div class="who-avatar-wrap"><div class="who-ribbon-wrap">'+function(){var e="";if(t.ribbons!==G&&(n=t.ribbons.length)){e+='<div class="who-ribbon-chat '+(n>=24?"wideRack":"narrowRack")+'">';for(var a=0,n=t.ribbons.length;a<n;a++){var o=t.ribbons[a];e+='<div class="pointer ribbon ribbon'+o+'" data-ribbon="'+o+'"></div>'}e+="</div>"}return e}()+"</div></div></div></div>",st.chat(e)}).fail(function(){st.chat("No data found.")})},help:function(){['<div class="chat-warning">Chat Commands:</div>',"<div>#channel: join channel</div>","<div>@account: whisper user</div>","<div>/ignore account: ignore account</div>","<div>/unignore account: stop ignoring account</div>","<div>/friend account: add/remove friend</div>","<div>/who account: check account info (or click account name)</div>"].forEach(function(t){yt.chat({message:t,type:"chat-muted"})})},broadcast:function(e){t.ajax({url:app.url+"php/insertBroadcast.php",data:{message:e}})},closeApp:function(){t.ajax({type:"GET",url:app.url+"php/close-app.php"}).done(function(){})},url:function(e){t.ajax({url:app.url+"php/insertUrl.php",data:{url:e}})},img:function(e){t.ajax({url:app.url+"php/insertImg.php",data:{url:e}})},video:function(e){t.ajax({url:app.url+"php/insertVideo.php",data:{url:e}})},fwpaid:function(e){t.ajax({url:app.url+"php/fwpaid.php",data:{message:e}})},addRibbon:function(e,a){t.ajax({url:app.url+"php/fw-add-ribbon.php",data:{account:e,ribbon:a}})},sendMsg:function(e){var a=mt.titleChatInput.val().trim();if(e||yt.chatOn){if(a)if("/friend"===a)yt.listFriends();else if(0===a.indexOf("/friend "))yt.toggleFriend(a.slice(8));else if(0===a.indexOf("/unignore ")){o=a.slice(10);yt.removeIgnore(o)}else if("/ignore"===a)yt.listIgnore();else if(0===a.indexOf("/ignore ")){o=a.slice(8);yt.addIgnore(o)}else if(0===a.indexOf("/join "))yt.changeChannel(a,"/join ");else if(0===a.indexOf("#"))yt.changeChannel(a,"#");else if(0===a.indexOf("/j "))yt.changeChannel(a,"/j ");else if(0===a.indexOf("/whisper "))yt.sendWhisper(a,"/whisper ");else if(0===a.indexOf("/w "))yt.sendWhisper(a,"/w ");else if(0===a.indexOf("@"))yt.sendWhisper(a,"@");else if(0===a.indexOf("/who "))yt.who(a);else if(0===a.indexOf("/broadcast "))yt.broadcast(a);else if(0===a.indexOf("/closeApp"))yt.closeApp();else if(0===a.indexOf("/url "))yt.url(a);else if(0===a.indexOf("/img "))yt.img(a);else if(0===a.indexOf("/video "))yt.video(a);else if(0===a.indexOf("/fw-paid ")){o=a.slice(8);yt.fwpaid(o)}else if(0===a.indexOf("/fw-add-ribbon ")){var n=a.split(" "),o=n[1],i=n[2];yt.addRibbon(o,i)}else"/"===a.charAt(0)&&0!==a.indexOf("/me")||"/me"===a||t.ajax({url:app.url+"php/insertTitleChat.php",data:{message:a}});mt.titleChatInput.val("")}},listFriendsThrottle:0,listFriends:function(){if(!(I.now()-yt.listFriendsThrottle<5e3)){yt.listFriendsThrottle=I.now();var e=st.friends.length;st.chat("<div>Checking friends list...</div>"),st.friends.length?t.ajax({url:app.url+"php/friendStatus.php",data:{friends:st.friends}}).done(function(t){n="<div>Friend List ("+e+")</div>";st.chat(n);for(var a=0;a<e;a++){var n="",o=t.players.indexOf(st.friends[a]);o>-1?(n+='<div><span class="chat-online titlePlayerAccount">'+st.friends[a]+"</span>","number"==typeof t.locations[o]?n+=" playing in game: "+t.locations[o]:(n+=" in chat channel: ","title"===st.view?n+='<span class="chat-online chat-join">'+t.locations[o]+"</span>":n+=t.locations[o]),n+="</div>",st.chat(n)):st.chat('<div><span class="chat-muted titlePlayerAccount">'+st.friends[a]+"</span></div>")}}):st.chat("<div>You don't have any friends! Use /friend account to add a new friend.</div>","chat-muted"),t("#title-chat-input").focus()}},showBackdrop:function(t){o.to("#titleViewBackdrop",$.delay(.3),{startAt:{visibility:"visible",alpha:0},alpha:1,onComplete:function(){t!==G&&t.focus()}}),st.isModalOpen=!0},showModal:function(){o.to("#optionsModal",st.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),yt.showBackdrop()},toggleModal:function(){st.isModalOpen?yt.closeModal():yt.showModal()},closeModal:function(){o.set(".title-modals, #titleViewBackdrop",{alpha:0,visibility:"hidden"}),st.isModalOpen=!1},exitGame:function(){yt.closeGame(),nw.App.closeAllWindows()},closeGame:function(){if(app.isApp){require("nw.gui");dt.account&&vt.removePlayer(dt.account),"lobby"===st.view?W():"game"===st.view&&j()}},addCpu:0,createGameFocus:!1,createGame:function(){var e=t("#gameName").val(),a=t("#gamePassword").val(),n=1*t("#gamePlayers").val(),o=st.speed;!st.rankedMode&&(e.length<4||e.length>32)?(st.msg("Game name must be at least 4-32 characters.",1),v(function(){t("#gameName").focus().select()},100)):!st.rankedMode&&(n<2||n>8||n%1!=0)?st.msg("Game must have 2-8 players.",1):yt.createGameService(e,a,yt.mapData[st.map.key].name,n,st.rankedMode,st.teamMode,o)},openWindow:function(t){app.isApp},configureNation:function(){o.to("#configureNation",st.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),yt.showBackdrop()},createGameService:function(e,a,n,o,i,r,l){st.lock(1),bt.play("click"),st.rankedMode=i,st.teamMode=r,t.ajax({url:app.url+"php/createGame.php",data:{name:e,pw:a,map:n,max:o,rating:i,teamMode:r,speed:l}}).done(function(t){vt.removePlayer(dt.account),dt.player=t.player,dt.playerColor=t.playerColor,dt.team=t.team,ut.id=t.gameId,ut.name=t.gameName,ht.init(t),ht.join(),vt.joinGame(),ht.styleStartGame()}).fail(function(t){st.msg(t.statusText),st.unlock(1)})},joinGame:function(){if(st.name=t("#joinGame").val(),!st.name)return st.msg("Game name is not valid!",1.5),void t("#joinGame").focus().select();st.password=t("#joinGamePassword").val(),st.lock(),bt.play("click"),t.ajax({url:app.url+"php/joinGame.php",data:{name:st.name,password:st.password}}).done(function(t){yt.joinGameCallback(t)}).fail(function(t){st.msg(t.statusText,1.5)}).always(function(){st.unlock()})},joinGameCallback:function(t){vt.removePlayer(dt.account),dt.player=t.player,dt.playerColor=t.player,st.teamMode=t.teamMode,st.rankedMode=t.rankedMode,dt.team=t.team,ut.id=t.id,ut.name=t.gameName,st.map=t.mapData,ht.init(t),ht.join(),vt.joinGame()},submitNationName:function(){var e=t("#updateNationName").val();st.lock(),bt.play("click"),t.ajax({url:app.url+"php/updateNationName.php",data:{name:e}}).done(function(t){st.msg("Your new nation name is: "+e)}).fail(function(t){st.msg(t.statusText)}).always(function(){st.unlock()})}};!function(){var e="";for(var n in yt.mapData)e+="<li><a class='mapSelect' href='#'>"+yt.mapData[n].name+"</a></li>";var o=a.getElementById("mapDropdown");null!==o&&(o.innerHTML=e),!tt&&isLoggedIn&&t("[title]").tooltip({animation:!1})}();var ht={data:[{account:""},{account:""},{account:""},{account:""},{account:""},{account:""},{account:""},{account:""},{account:""}],startClassOn:"btn btn-md btn-block btn-responsive shadow4 lobbyButtons",startClassOff:"btn btn-md btn-block btn-responsive shadow4 lobbyButtons",totalPlayers:function(){for(var t=0,e=0,a=ht.data.length;e<a;e++)ht.data[e].account&&t++;return t},addCpuPlayer:function(){t.ajax({url:app.url+"php/cpu-add-player.php",data:{flag:st.getRandomFlag()}})},updateGovernmentWindow:function(t){var e="";"Despotism"===t?e='<div id="lobbyGovName" class="text-primary">Despotism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>Start with 3x production</div>\t\t\t\t\t<div>Start with gunpowder</div>\t\t\t\t\t<div>Start with a bunker</div>\t\t\t\t\t<div>Free movement through own tiles</div>\t\t\t\t</div>':"Monarchy"===t?e='<div id="lobbyGovName" class="text-primary">Monarchy</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>3x capital culture</div>\t\t\t\t\t<div>50% starting culture bonus</div>\t\t\t\t\t<div>Start with two great tacticians: +2 defense</div>\t\t\t\t\t<div>1/2 cost structures</div>\t\t\t\t</div>':"Democracy"===t?e='<div id="lobbyGovName" class="text-primary">Democracy</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>4x maximum troop deployment</div>\t\t\t\t\t<div>50% starting production bonus</div>\t\t\t\t\t<div>Reduced culture milestone requirement</div>\t\t\t\t\t<div>Patriotism: +3 troops when you lose a tile</div>\t\t\t\t</div>':"Fundamentalism"===t?e='<div id="lobbyGovName" class="text-primary">Fundamentalism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>Overrun ability: Instant win with 4x advantage</div>\t\t\t\t\t<div>Infiltration: -3 structure defense</div>\t\t\t\t\t<div>Faster growth: Reduced growth milestone requirement</div>\t\t\t\t\t<div>+2 troop reward bonus</div>\t\t\t\t</div>':"Fascism"===t?e='<div id="lobbyGovName" class="text-primary">Fascism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>2x production rewards from barbarians</div>\t\t\t\t\t<div>Start with 4 bonus energy</div>\t\t\t\t\t<div>Start with great general: +1 attack</div>\t\t\t\t\t<div>Bonus troop with each deployment</div>\t\t\t\t</div>':"Republic"===t?e='<div id="lobbyGovName" class="text-primary">Republic</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>+50% plundered reward bonus from barbarians</div>\t\t\t\t\t<div>Start with masonry</div>\t\t\t\t\t<div>+1 energy per turn</div>\t\t\t\t\t<div>Combat medics: Recover 1/2 of lost troops after victory</div>\t\t\t\t</div>':"Communism"===t&&(e='<div id="lobbyGovName" class="text-primary">Communism</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>2x discovered reward bonus from barbarians</div>\t\t\t\t\t<div>Can deploy troops to uninhabited territory</div>\t\t\t\t\t<div>3/4 cost weapons</div>\t\t\t\t\t<div>Start with a great person</div>\t\t\t\t</div>'),a.getElementById("lobbyGovernment"+dt.player).innerHTML=t,a.getElementById("lobbyGovernmentDescription").innerHTML="Random"===t?'<div id="lobbyGovName" class="text-primary">Random</div>\t\t\t\t<div id="lobbyGovPerks">\t\t\t\t\t<div>???</div>\t\t\t\t\t<div>???</div>\t\t\t\t\t<div>???</div>\t\t\t\t\t<div>???</div>\t\t\t\t</div>':e},chat:function(t){for(;ct.lobbyChatLog.childNodes.length>200;)ct.lobbyChatLog.removeChild(ct.lobbyChatLog.firstChild);var e=a.createElement("div");t.type&&(e.className=t.type),e.innerHTML=t.message,ct.lobbyChatLog.appendChild(e),ht.chatDrag||(ct.lobbyChatLog.scrollTop=ct.lobbyChatLog.scrollHeight)},chatDrag:!1,gameStarted:!1,chatOn:!1,sendMsg:function(e){var a=mt.lobbyChatInput.val().trim();if(e||ht.chatOn){if(a)if("/friend"===a)yt.listFriends();else if(0===a.indexOf("/friend "))yt.toggleFriend(a.slice(8));else if(0===a.indexOf("/unignore ")){n=a.slice(10);yt.removeIgnore(n)}else if("/ignore"===a)yt.listIgnore();else if(0===a.indexOf("/ignore ")){var n=a.slice(8);yt.addIgnore(n)}else 0===a.indexOf("/whisper ")?yt.sendWhisper(a,"/whisper "):0===a.indexOf("/w ")?yt.sendWhisper(a,"/w "):0===a.indexOf("@")?yt.sendWhisper(a,"@"):0===a.indexOf("/who ")?yt.who(a):"/"===a.charAt(0)&&0!==a.indexOf("/me")||t.ajax({url:app.url+"php/insertLobbyChat.php",data:{message:a}});mt.lobbyChatInput.val("")}},difficulties:["Very Easy","Easy","Normal","Hard","Very Hard","Mania","Juggernaut"],governments:["Despotism","Monarchy","Democracy","Fundamentalism","Fascism","Republic","Communism","Random"],init:function(t){if(!ht.initialized){a.getElementById("lobbyChatLog").innerHTML="You have joined the game: "+t.name,ht.sendMsg();var e=a.getElementById("lobbyGameName");if(null!==e){t.rating&&(a.getElementById("lobbyRankedMatch").style.display="block",a.getElementById("lobbyGameNameWrap").style.display="none"),e.innerHTML=t.name,a.getElementById("lobbyGameMode").textContent=t.gameMode,t.password&&(a.getElementById("lobbyGamePasswordWrap").style.display="block",a.getElementById("lobbyGamePassword").innerHTML=t.password),a.getElementById("lobbyGameMap").innerHTML=t.map,a.getElementById("lobbyGameMax").innerHTML=t.max,a.getElementById("startGame").style.display=1===t.player?"block":"none",t.startGame||(a.getElementById("mainWrap").style.display="flex");for(var n='<div id="lobbyWrap">',o=1;o<=8;o++){if(n+='<div id="lobbyRow'+o+'" class="lobbyRow">\t\t\t\t\t<div class="lobby-row-col-1">\t\t\t\t\t\t<img id="lobbyFlag'+o+'" class="lobbyFlags block center no-select" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=">\t\t\t\t\t</div>\t\t\t\t\t<div class="lobby-row-col-2 lobbyDetails">\t\t\t\t\t\t<div class="lobbyAccounts">',st.teamMode){n+='<span><div id="lobbyTeam'+o+'" data-placement="right" class="lobbyTeams dropdown-toggle pointer2" data-toggle="dropdown">',n+='<i class="fa fa-flag pointer2 lobbyTeamFlag"></i> <span id="lobbyTeamNumber'+o+'" class="lobbyTeamNumbers">'+o+"</span></div>",n+='<ul id="teamDropdown" class="dropdown-menu">\t\t\t\t\t\t\t\t\t<li class="header text-center selectTeamHeader">Team</li>';for(i=1;i<=8;i++)n+='<li class="teamChoice" data-player="'+o+'">Team '+i+"</li>";n+="</ul></span>"}if(n+='<span><i id="lobbyPlayerColor'+o+'" class="fa fa-square player'+o+" lobbyPlayer dropdown-toggle",o===dt.player&&(n+=" pointer2"),n+='" data-placement="right" data-toggle="dropdown"></i>',o===dt.player){n+='<ul id="teamColorDropdown" class="dropdown-menu">\t\t\t\t\t\t\t\t\t<li class="header text-center selectTeamHeader">Player Color</li><li id="team-color-flex">';for(var i=1;i<=20;i++)n+='<div class="pbar'+i+' playerColorChoice" data-playercolor="'+i+'"></div>';n+="</li></ul></span>"}if(n+='<span id="lobbyAccountName'+o+'" class="lobbyAccountName chat-warning"></span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div id="lobbyName'+o+'" class="lobbyNames nowrap"></div>\t\t\t\t\t</div>\t\t\t\t\t<div class="lobby-row-col-3">',o===t.player){n+='<div id="gov-dropdown-player'+o+'" class="dropdown govDropdown">\t\t\t\t\t\t\t<button class="btn btn-primary btn-responsive dropdown-toggle shadow4 fwDropdownButton" type="button" data-toggle="dropdown">\t\t\t\t\t\t\t\t<span id="lobbyGovernment'+o+'">Despotism</span>\t\t\t\t\t\t\t\t<i id="lobbyCaret'+o+'" class="fa fa-caret-down text-warning lobbyCaret"></i>\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t<ul class="governmentDropdown dropdown-menu no-select">';for(var r=0,l=ht.governments.length;r<l;r++)n+='<li class="governmentChoice"><a>'+ht.governments[r]+"</a></li>";n+="</ul>\t\t\t\t\t\t</div>"+ht.getCpuDropdown(o)}else n+='<div id="gov-dropdown-player'+o+'" class="dropdown govDropdown">\t\t\t\t\t\t\t<button style="cursor: default" class="btn btn-primary btn-responsive dropdown-toggle shadow4 fwDropdownButton fwDropdownButtonEnemy" type="button">\t\t\t\t\t\t\t\t<span id="lobbyGovernment'+o+'" class="pull-left">Despotism</span>\t\t\t\t\t\t\t\t<i id="lobbyCaret'+o+'" class="fa fa-caret-down text-disabled lobbyCaret"></i>\t\t\t\t\t\t\t</button>\t\t\t\t\t\t</div>'+ht.getCpuDropdown(o);n+="</div>\t\t\t\t\t</div>"}1!==dt.player||st.rankedMode||(n+='<div id="lobby-cpu-row" class="row buffer2">\t\t\t\t\t<div class="col-xs-12">\t\t\t\t\t\t<button id="cpu-remove-player" type="button" class="btn fwBlue btn-responsive shadow4 pull-right cpu-button">\t\t\t\t\t\t\t<i class="fa fa-minus-circle"></i> Remove CPU\t\t\t\t\t\t</button>\t\t\t\t\t\t<button id="cpu-add-player" type="button" class="btn fwBlue btn-responsive shadow4 pull-right cpu-button">\t\t\t\t\t\t\t<i class="fa fa-plus-circle"></i> Add CPU\t\t\t\t\t\t</button>\t\t\t\t\t</div>\t\t\t\t</div>'),n+="</div>",a.getElementById("lobbyPlayers").innerHTML=n,ht.updateGovernmentWindow(dt.government)}}},initialized:0,getCpuDropdown:function(t){for(var e='<div id="gov-dropdown-cpu'+t+'" class="dropdown govDropdown none">\t\t\t<button class="btn btn-primary btn-responsive dropdown-toggle shadow4 fwDropdownButton" type="button" data-toggle="dropdown">\t\t\t\t<span id="lobby-difficulty-cpu'+t+'">Computer: Very Easy</span>\t\t\t\t<i id="lobby-caret-cpu'+t+'" class="fa fa-caret-down text-warning lobbyCaret"></i>\t\t\t</button>\t\t\t<ul class="governmentDropdown dropdown-menu no-select">',a=0,n=ht.difficulties.length;a<n;a++)e+='<li class="cpu-choice" data-player="'+t+'"><a>'+ht.difficulties[a]+"</a></li>";return e+="</ul>\t\t</div>"},join:function(e){e===G&&(e=.5),st.lock(1),st.view="lobby",yt.closeModal(),o.to("header",e,{y:"-200%",ease:Quad.easeIn}),o.to("#titleChat",e,{x:"100%",ease:Quad.easeIn}),a.getElementById("lobbyFirmamentWarsLogo").src="images/title/firmament-wars-logo-1280.png",a.getElementById("worldTitle").src="images/FlatWorld90.jpg",o.to("#titleMenu",e,{x:"-100%",ease:Quad.easeIn,onComplete:function(){o.to(["#titleMain","#logoWrap","#firmamentWarsLogoWrap"],$.delay(.5),{alpha:0,onComplete:function(){t("#titleMain, #title-bg-wrap").remove(),st.unlock(1),o.fromTo("#joinGameLobby",$.delay(e),{autoAlpha:0},{autoAlpha:1}),yt.addCpu&&ht.addCpuPlayer(),yt.addCpu=0}})}}),e?function e(){if("lobby"===st.view){var a=0;1===dt.player&&ht.data.forEach(function(t){t.cpu&&(a=1)}),t.ajax({url:app.url+"php/updateLobby.php",data:{pingCpu:a}}).done(function(t){if("lobby"===st.view){localStorage.setItem("reload",!0);for(var a=!1,n=1;n<=8;n++){var o=t.playerData[n];if(o!==G)o.account!==ht.data[n].account&&ht.updatePlayer(o),1===o.gameHost&&(a=!0);else if(ht.data[n].account){i={message:ht.data[n].account+" has disconnected",type:"chat-warning"};ht.chat(i);var i={player:n};ht.updatePlayer(i)}}a||ht.hostLeft(),v(e,5e3)}}).fail(function(t){O()})}}():!1!==localStorage.getItem("reload")&&J()},hostLeft:function(){v(function(){st.msg("The host has left the lobby."),v(function(){W(!0)},1e3)},500)},updatePlayer:function(e){var n=e.player;if(e.account!==G){a.getElementById("lobbyRow"+n).style.display="flex",a.getElementById("lobbyAccountName"+n).innerHTML=e.cpu?"Computer":e.account,a.getElementById("lobbyName"+n).innerHTML=e.nation;var o="Default.jpg"===e.flag?"Player"+n+".jpg":e.flag;a.getElementById("lobbyFlag"+n).src="images/flags/"+o,!tt&&isLoggedIn&&t("#lobbyFlag"+n).attr("title",e.flag.split(".").shift()).tooltip({animation:!1,placement:"right",container:"body"}),dt.player===n&&!tt&&isLoggedIn&&(t("#lobbyPlayerColor"+n).attr("title","Select Player Color").tooltip({container:"body",animation:!1}),t("#lobbyTeam"+n).attr("title","Select Team").tooltip({container:"body",animation:!1})),ht.updateGovernment(e),ht.data[n]=e,ht.updatePlayerColor(e),a.getElementById("lobbyGovernment"+n).innerHTML=e.cpu?"Computer: "+e.difficulty:"Despotism",t("#lobbyCaret"+n).removeClass("text-warning text-disabled").addClass(dt.player===n||e.cpu&&1===dt.player?"text-warning":"text-disabled"),a.getElementById("gov-dropdown-player"+e.player).style.display=e.cpu?"none":"block",a.getElementById("gov-dropdown-cpu"+e.player).style.display=e.cpu?"block":"none"}else a.getElementById("lobbyRow"+n).style.display="none",a.getElementById("lobby-difficulty-cpu"+n).innerHTML="Computer: Very Easy",ht.data[n]={account:"",cpu:0};ht.styleStartGame()},updateTeamNumber:function(t){var e=t.player,n=a.getElementById("lobbyTeamNumber"+e);null!==n&&(n.textContent=t.team)},updatePlayerColor:function(e){var n=e.player,o=dt.player===n?"fa fa-square lobbyPlayer dropdown-toggle pointer2 player"+e.playerColor:"fa fa-square lobbyPlayer dropdown-toggle player"+e.playerColor;t("#lobbyPlayerColor"+n).removeClass().addClass(o).data("playerColor",e.playerColor),ht.data[n].playerColor=e.playerColor,"Default.jpg"===e.flag&&(a.getElementById("lobbyFlag"+n).src="images/flags/Player"+e.playerColor+".jpg")},updateGovernment:function(t){var e=t.player;a.getElementById("lobbyGovernment"+e).innerHTML=t.government,ht.data[e].government=t.government},updateDifficulty:function(t){var e=t.player;a.getElementById("lobby-difficulty-cpu"+e).innerHTML="Computer: "+t.difficulty,ht.data[e].difficulty=t.difficulty},styleStartGame:function(){1===dt.player&&(1===ht.totalPlayers()?startGame.className=ht.startClassOff:startGame.className=ht.startClassOn)},countdown:function(e){vt.unsubscribe("title:refreshGames"),ht.gameStarted||(t("#lobby-cpu-row").remove(),ht.gameStarted=!0,new Audio("sound/beepHi.mp3"),countdown.style.display="block",function t(e){countdown.textContent="Starting game in "+e--,e>=0?(bt.play("beep"),v(t,1e3,e)):(bt.play("beepHi"),bt.load.game(),ft.load.game()),1===e&&(o.to("#mainWrap",1.5,{delay:1,alpha:0,ease:Linear.easeNone,onComplete:function(){var t=1===dt.player?0:750;v(function(){J()},t),sessionStorage.setItem("gameDuration",I.now())}}),bt.fade())}(5),cancelGame.style.display="none",t("#teamDropdown").css("display","none"))},governmentIcon:function(t){var e="",a="player-icon"+ut.player[t.player].playerColor;return t.cpu?e+='<img src="images/icons/computer.png" class="fw-icon-sm '+a+'">':e+='<img src="images/icons/'+t.government+'.png" class="fw-icon-sm '+a+'">',e},startGame:function(){1===dt.player&&(ht.totalPlayers()>=2?(startGame.style.display="none",cancelGame.style.display="none",st.lock(),bt.play("click"),t.ajax({type:"GET",url:app.url+"php/startGame.php"}).fail(function(t){st.msg(t.statusText),startGame.style.display="block",cancelGame.style.display="block"}).always(function(){st.unlock()})):st.msg("You need two players to start a game! Wait for players to join or add a computer player to begin."))}},vt={initialConnection:!0,removePlayer:function(t){var e={type:"remove",account:dt.account};vt.zmq.publish("title:"+dt.channel,e),delete yt.players[t]},addPlayer:function(t,e){t&&(vt.zmq.publish("title:"+dt.channel,{type:"add",account:dt.account,flag:dt.flag,rating:dt.rating}),yt.players[t]={flag:e})},unsubscribe:function(t){try{vt.zmq.unsubscribe(t)}catch(t){}},firstInit:0,setChannel:function(e){"title"===st.view&&((e=e.trim())?vt.firstInit&&e===dt.channel||(vt.firstInit=1,t.ajax({type:"POST",url:app.url+"php/titleChangeChannel.php",data:{channel:e}}).done(function(t){vt.removePlayer(dt.account),vt.unsubscribe("title:"+dt.channel),dt.channel=t.channel;for(var e in yt.players)delete yt.players[e];t.skip=!0,t.message="You have joined channel: "+t.channel,t.type="chat-warning",yt.chat(t),vt.zmq.subscribe("title:"+dt.channel,function(t,e){-1===st.ignore.indexOf(e.account)&&yt.chatReceive(e)}),vt.addPlayer(dt.account,dt.flag),"title"===st.view&&(a.getElementById("titleChatHeaderChannel").textContent=t.channel,a.getElementById("titleChatBody").innerHTML=""),yt.updatePlayers(0),n.hash=dt.channel}).fail(function(){st.chat("That channel name is not valid.")})):st.chat("That channel name is not valid. Channel names may only contain alphanumeric values."))},enableWhisper:function(){var e="account:"+dt.account;vt.zmq.subscribe(e,function(e,a){if(a.message)if("send"===a.action){var n=dt.flag.split(".");n=n[0].replace(/ /g,"-"),dt.lastReceivedWhisper=a.account,t.ajax({url:app.url+"php/insertWhisper.php",data:{action:"receive",flag:a.flag,playerColor:a.playerColor,account:a.account,message:a.message}}),a.type="chat-whisper",a.msg=a.message,a.message=a.chatFlag+a.account+" whispers: "+a.message,yt.receiveWhisper(a)}else a.timestamp-yt.lastWhisper.timestamp<500&&a.account===yt.lastWhisper.account&&a.message===yt.lastWhisper.message||(yt.lastWhisper.account=a.account,yt.lastWhisper.timestamp=a.timestamp,yt.lastWhisper.message=a.message,a.msg=a.message,a.message=a.chatFlag+"To "+a.account+": "+a.message,a.type="chat-whisper",yt.receiveWhisper(a))}),"localhost"!==n.host&&b(console.clear,6e5),function t(){vt.zmq.publish("fw:hb",{}),v(t,2e4)}()},joinGame:function(){!function t(){vt.enabled?(vt.unsubscribe("title:"+dt.channel),vt.unsubscribe("game:"+ut.id),vt.zmq.subscribe("game:"+ut.id,function(t,e){-1===st.ignore.indexOf(e.account)&&yt.chatReceive(e)})):v(t,100)}()},enabled:!1,init:function(){vt.zmq=new ab.Session("wss://"+app.socketUrl+"/wss2/",function(){vt.connectionSuccess()},function(){vt.reconnect()},{skipSubprotocolCheck:!0})},connectionSuccess:function(){vt.enabled=!0,"title"===st.view&&(vt.initialConnection&&(st.unlock(),vt.zmq.subscribe("title:refreshGames",function(t,e){yt.updateGame(e)}),vt.zmq.subscribe("admin:broadcast",function(t,e){e.msg?st.chat(e.msg,e.type):"close-app"===e.category&&yt.exitGame()}),vt.zmq.subscribe("fw:hb",function(t,e){e.msg&&st.chat(e.msg,e.type)}),function t(){dt.account?vt.enableWhisper():v(t,200)}()),vt.initialConnection=!1,a.getElementById("titleChatHeaderChannel").innerHTML=dt.channel,vt.setChannel(dt.channel)),"game"===st.view&&ut.getGameState()},connectionTries:0,connectionRetryDuration:100,reconnect:function(){vt.enabled=!1,v(vt.init,vt.connectionRetryDuration)}},bt={ext:function(t){return t.canPlayType&&t.canPlayType("audio/mpeg;").replace(/no/,"")?"mp3":"ogg"}(a.createElement("audio")),on:!!a.createElement("audio").canPlayType,play:function(t,e,a){if(t)if(e)ct.bgmusic.pause(),ct.bgmusic.src="music/"+t+".mp3",ct.bgmusic.volume=st.config.audio.musicVolume/100;else{var n=new Audio("sound/"+t+".mp3"),o=a||1;n.volume=o*(st.config.audio.soundVolume/100),n.play()}},save:function(){var t=E.stringify(st.config);localStorage.setItem("config",t)},setMusicVolume:function(t){st.config.audio.musicVolume?t||bt.pause():bt.musicStart(),ct.bgmusic.volume=t/100,st.config.audio.musicVolume=t,bt.save()},setSoundVolume:function(t){st.config.audio.soundVolume=t,bt.save()},pause:function(){ct.bgmusic.pause()},gameMusicInit:function(){st.config.audio.musicVolume&&(bt.pause(),ct.bgmusic.loop=!1,bt.gameMusicPlayNext())},trackIndex:~~(8*e.random()),tracks:["BehindTheShield","DeceptionPoint","HeroicReturn","HeartOfChampions","LeadingTheCharge","RiseAgainstTheMachine","TheAssault","WithGreatPower"],gameMusicPlayNext:function(){bt.totalTracks=bt.tracks.length;var t=bt.tracks[++bt.trackIndex%bt.totalTracks];ct.bgmusic.pause(),ct.bgmusic.src="music/"+t+".mp3",ct.bgmusic.volume=st.config.audio.musicVolume/100,ct.bgmusic.onended=function(){bt.gameMusicPlayNext()}},fade:function(){var t={vol:st.config.audio.musicVolume/100};o.to(t,2.5,{vol:0,ease:Linear.easeNone,onUpdate:function(){ct.bgmusic.volume=t.vol}})},move:function(){bt.play("march"+~~(3*e.random()))},deploy:function(){bt.play("deploy"+~~(3*e.random()))},cache:{},load:{title:function(){for(var t=["click","beep"],e=0,a=t.length;e<a;e++){var n=t[e];bt.cache[n]=new Audio("sound/"+n+".mp3")}},game:function(){for(var t=["machine0","machine1","machine2","machine3","machine4","machine5","machine6","machine7","machine8","machine9","march0","march1","march2","deploy0","deploy1","deploy2","chat","hup2","cheer3","culture","error","build","grenade5","grenade6","grenade8","missile7","bomb9","warning","research"],e=0,a=t.length;e<a;e++){var n=t[e];bt.cache[n]=new Audio("sound/"+n+".mp3")}}},musicStart:function(){"game"!==st.view?bt.play("ReturnOfTheFallen",1):bt.gameMusicPlayNext()}};bt.init=function(){var e=localStorage.getItem("config");if(null===e)bt.save();else{var a=E.parse(e);st.config.audio.musicOn===G&&(st.config.audio=a.audio)}bt.load.title(),st.config.audio.musicVolume?bt.musicStart():bt.pause();var n=!1,o=t("#musicSlider");o.length&&o.slider({min:0,max:100,formatter:function(t){return n?(bt.setMusicVolume(t),t):st.config.audio.musicVolume}}).slider("setValue",st.config.audio.musicVolume),t("#soundSlider").slider({min:0,max:100,value:st.config.audio.soundVolume,tooltip_position:"bottom",formatter:function(t){return n?(bt.setSoundVolume(t),t):st.config.audio.soundVolume}}).on("slideStop",function(t){bt.play("machine0")}).slider("setValue",st.config.audio.soundVolume),n=!0}();var wt={error:function(t){t===G&&(t="Not enough production!"),st.msg(t,1.5),dt.clearHud(),$.showTarget(ct["land"+dt.tgt])},target:function(e){return dt.targetData=e,dt.checkSelectLastTarget(),dt.attackOn&&e.attackName===dt.attackName?(dt.attackOn=!1,dt.attackName="",dt.clearHud(),void $.showTarget(ct["land"+dt.tgt])):ut.tiles[dt.tgt].units<e.minimum?(st.msg("You need at least "+e.minimum+" troops to attack!",1.5),void dt.clearHud()):void(dt.player===ut.tiles[dt.tgt].player&&(dt.attackOn=!0,dt.attackName=e.attackName,dt.splitAttack=e.splitAttack,dt.hud(e.hudMsg),t("#style-land-crosshair").remove(),mt.head.append('<style id="style-land-crosshair">.land{ cursor: crosshair; }</style>'),dt.targetLine[0]=1*ct["unit"+dt.tgt].getAttribute("x")-10,dt.targetLine[1]=1*ct["unit"+dt.tgt].getAttribute("y")-10,$.showTarget(dt.lastTarget,!0)))},attack:function(e){var a=dt.tgt,n=1*e.id.slice(4);if(dt.tgt!==n)if(-1!==ut.tiles[a].adj.indexOf(n)){if(ut.tiles[n].player===dt.player&&ut.tiles[n].units>=255)return st.msg("That territory has the maximum number of units!",1.5),void dt.clearHud();if(dt.attackOn=!1,dt.attackName="",1===ut.tiles[dt.tgt].units)return st.msg("You need at least 2 troops to move/attack!",1.5),void dt.clearHud();if("Despotism"===dt.government&&ut.tiles[n].player===dt.player);else if(dt.moves<2&&!dt.splitAttack||dt.moves<1&&dt.splitAttack)return void wt.error("Not enough energy!");$.showTarget(e),dt.clearHud(),st.teamMode&&ut.tiles[n].player&&dt.account!==ut.tiles[n].account&&dt.team===ut.player[ut.tiles[n].player].team&&st.msg("Friendly fire! That's your teammate!"),t.ajax({url:app.url+"php/attackTile.php",data:{attacker:a,defender:n,split:dt.splitAttack?1:0,randomTile:wt.getRandomDemocracyTile(n,ut.tiles[n].player),defGovernment:ut.player[ut.tiles[n].player].government}}).done(function(t){ut.tiles[n].player!==dt.player?ut.tiles[n].units||bt.move():bt.move(),t.rewardMsg&&(ut.chat({message:'<span class="chat-news">'+t.rewardMsg+"</span>"}),U(t),t.foodReward&&t.productionReward&&t.cultureReward?(lt.upgrade(n,"food",t.foodReward+"%"),v(function(){lt.upgrade(n,"production",t.productionReward+"%")},500),v(function(){lt.upgrade(n,"culture",t.cultureReward+"%")},1e3)):t.sumFood?lt.upgrade(n,"food",t.sumFood):t.sumProduction?lt.upgrade(n,"production",t.sumProduction):t.sumCulture?lt.upgrade(n,"culture",t.sumCulture):t.sumMoves?lt.upgrade(n,"energy",t.sumMoves):t.foodReward?lt.upgrade(n,"food",t.foodReward+"%"):t.productionReward?lt.upgrade(n,"production",t.productionReward+"%"):t.cultureReward&&lt.upgrade(n,"culture",t.cultureReward+"%")),V(t),t.victory||$.showTarget(ct["land"+a]),ut.reportMilestones(t)}).fail(function(t){wt.targetNotAdjacent(t.statusText,a)})}else wt.targetNotAdjacent("You can only attack adjacent territories.",a)},getRandomDemocracyTile:function(t,a){var n=[],o=0;ut.tiles.forEach(function(e,i){e.player===a&&i!==t&&(n[o++]=i)});var i=n.length;return n[~~(e.random()*i)]},targetNotAdjacent:function(t,e){bt.play("error"),st.msg(t,1.5),$.showTarget(ct["land"+e])},deploy:function(){("Communism"!==dt.government||ut.tiles[dt.tgt].player||ut.tiles[dt.tgt].units)&&dt.checkSelectLastTarget();var e=ut.tiles[dt.tgt];if(dt.moves<dt.deployCost)wt.error();else if(dt.manpower){if(e.units<=254){var a=dt.tgt;t.ajax({url:app.url+"php/deploy.php",data:{target:a}}).done(function(t){bt.deploy(),ut.tiles[a].units=t.units,dt.manpower=t.manpower,U(t)}).fail(function(t){bt.play("error")}).always(function(){D(a,"#00ff00")}),o.set("#manpower",{color:"#fff"})}}else wt.error("No troops available for deployment!")},rush:function(){dt.checkSelectLastTarget();var e=ut.tiles[dt.tgt],a=dt.tgt;dt.moves<dt.rushCost?wt.error("Not enough energy!"):e.units<=254&&t.ajax({url:app.url+"php/rush.php",data:{target:a}}).done(function(t){bt.deploy(),V(t),ut.tiles[a].units=t.units,D(a,"#00ff00")}).fail(function(t){bt.play("error")}).always(function(t){U(t)})},upgradeTileDefense:function(){dt.checkSelectLastTarget();var e=ut.tiles[dt.tgt],a=e.defense-e.capital?1:0;a>2||(dt.production<st.upgradeCost[a]*dt.buildCost?wt.error():t.ajax({url:app.url+"php/upgradeTileDefense.php",data:{target:dt.tgt}}).done(function(t){z(t)}).fail(function(t){st.msg(t.statusText),bt.play("error")}))},fireCannons:function(a){var n=dt.tgt,o=1*a.id.slice(4);dt.tgt!==o&&0!==ut.tiles[dt.tgt].units&&(dt.attackOn=!1,dt.attackName="",dt.production<e.ceil(24*dt.weaponCost)?wt.error():(dt.clearHud(),$.showTarget(ct["land"+n]),t.ajax({url:app.url+"php/fireCannons.php",data:{attacker:n,defender:o}}).done(function(t){z(t)}).fail(function(t){bt.play("error"),t.statusText&&st.msg(t.statusText,1.5)})))},launchMissile:function(a){var n=dt.tgt,o=1*a.id.slice(4);dt.tgt!==o&&0!==ut.tiles[dt.tgt].units&&(dt.attackOn=!1,dt.attackName="",dt.production<e.ceil(50*dt.weaponCost)?wt.error():(dt.clearHud(),$.showTarget(ct["land"+n]),t.ajax({url:app.url+"php/launchMissile.php",data:{attacker:n,defender:o}}).done(function(e){e.production!==G&&z(e),v(function(){t.ajax({url:app.url+"php/launchMissileHit.php",data:{attacker:n,defender:o}}).fail(function(t){t.statusText&&st.msg(t.statusText,1.5)})},1e3)}).fail(function(t){bt.play("error"),t.statusText&&st.msg(t.statusText,1.5)})))},launchNuke:function(a){var n=dt.tgt,o=1*a.id.slice(4);dt.tgt!==o&&0!==ut.tiles[dt.tgt].units&&(dt.attackOn=!1,dt.attackName="",dt.production<e.ceil(150*dt.weaponCost)?wt.error():(dt.clearHud(),$.showTarget(ct["land"+n]),t.ajax({url:app.url+"php/launchNuke.php",data:{attacker:n,defender:o}}).done(function(e){v(function(){t.ajax({url:app.url+"php/launchNukeHit.php",data:{defender:o}})},6e3),z(e)}).fail(function(t){bt.play("error"),t.statusText&&st.msg(t.statusText,1.5)})))},setMenu:function(){if(dt.tech.masonry,ct.researchMasonry.style.display=dt.tech.masonry?"none":"flex",ct.researchConstruction.style.display=dt.tech.masonry&&!dt.tech.construction?"flex":"none",ct.researchEngineering.style.display=dt.tech.construction&&!dt.tech.engineering?"flex":"none",ct.researchGunpowder.style.display=dt.tech.gunpowder?"none":"flex",ct.researchRocketry.style.display=dt.tech.gunpowder&&!dt.tech.rocketry?"flex":"none",ct.researchAtomicTheory.style.display=dt.tech.rocketry&&dt.tech.engineering&&!dt.tech.atomicTheory?"flex":"none",ct.researchFutureTech.style.display=dt.tech.atomicTheory?"flex":"none",dt.tech.masonry)if(ut.tiles[dt.tgt].defense){var t=ut.tiles[dt.tgt].capital?1:0,e=ut.tiles[dt.tgt].defense-t,a="flex";dt.tech.engineering?e<3&&(a="flex"):dt.tech.construction&&(e||(a="flex")),ct.upgradeTileDefense.style.display=a}else ct.upgradeTileDefense.style.display="flex";else ct.upgradeTileDefense.style.display="flex";ct.fireCannons.style.display=dt.tech.gunpowder?"flex":"none",ct.launchMissile.style.display=dt.tech.rocketry?"flex":"none",ct.launchNuke.style.display=dt.tech.atomicTheory?"flex":"none"}};t("#gameWrap").on($.click,"#attack",function(){var t=new Q({});wt.target(t)}).on($.click,"#deploy",function(){wt.deploy()}).on($.click,"#splitAttack",function(){var t=new Q({cost:1,attackName:"splitAttack",hudMsg:"Split Attack: Select Target",splitAttack:!0});wt.target(t)}).on($.click,"#rush",function(){wt.rush()}).on($.click,"#upgradeTileDefense",function(){wt.upgradeTileDefense()}).on($.click,"#researchMasonry",function(){kt.masonry()}).on($.click,"#researchConstruction",function(){kt.construction()}).on($.click,"#researchGunpowder",function(){kt.gunpowder()}).on($.click,"#researchEngineering",function(){kt.engineering()}).on($.click,"#researchRocketry",function(){kt.rocketry()}).on($.click,"#researchAtomicTheory",function(){kt.atomicTheory()}).on($.click,"#researchFutureTech",function(){kt.futureTech()}).on($.click,"#fireCannons",function(){var t=new Q({cost:0,minimum:0,attackName:"cannons",hudMsg:"Fire Cannons"});wt.target(t)}).on($.click,"#launchMissile",function(){var t=new Q({cost:0,minimum:0,attackName:"missile",hudMsg:"Launch Missile"});wt.target(t)}).on($.click,"#launchNuke",function(){var t=new Q({cost:0,minimum:0,attackName:"nuke",hudMsg:"Launch Nuclear Weapon"});wt.target(t)});var kt={masonry:function(){t.ajax({type:"GET",url:app.url+"php/researchMasonry.php"}).done(function(t){dt.tech.masonry=1,kt.report(t,"Masonry")})},construction:function(){t.ajax({type:"GET",url:app.url+"php/researchConstruction.php"}).done(function(t){dt.tech.construction=1,kt.report(t,"Construction")})},gunpowder:function(){t.ajax({type:"GET",url:app.url+"php/researchGunpowder.php"}).done(function(t){dt.tech.gunpowder=1,kt.report(t,"Gunpowder")})},engineering:function(){t.ajax({type:"GET",url:app.url+"php/researchEngineering.php"}).done(function(t){dt.tech.engineering=1,kt.report(t,"Engineering")})},rocketry:function(){t.ajax({type:"GET",url:app.url+"php/researchRocketry.php"}).done(function(t){dt.tech.rocketry=1,kt.report(t,"Rocketry")})},atomicTheory:function(){t.ajax({type:"GET",url:app.url+"php/researchAtomicTheory.php"}).done(function(t){dt.tech.atomicTheory=1,kt.report(t,"Atomic Theory")})},futureTech:function(){t.ajax({type:"GET",url:app.url+"php/researchFutureTech.php"}).done(function(t){kt.report(t,"Future Tech")})},report:function(t,e){z(t);a={message:"You have finished researching "+e+"."};if(ut.chat(a),t.cultureMsg){var a={message:t.cultureMsg};ut.chat(a)}bt.play("research"),wt.setMenu()}};t(A).focus(function(){a.title=st.defaultTitle,st.titleFlashing=!1,st.notification.close!==G&&st.notification.close()}),t(A).on("load",function(){v(function(){o.to("body",.3,{startAt:{display:"flex",opacity:0},opacity:1})},100),tt?(a.getElementById("worldTitle").style.display="none",o.set("#worldTitle",{xPercent:-50,yPercent:-50,top:"50%",left:"50%",width:"1600px",height:"1600px"})):o.to("#worldTitle",600,{startAt:{xPercent:-50,yPercent:-50,rotation:-360},rotation:0,repeat:-1,ease:Linear.easeNone})}).on("resize",function(){$.resizeWindow()}),function(){function i(e){var n=a.getElementById("createGameHead"),i=a.getElementById("createRankedGameHead"),r=t("#gameName"),l=a.getElementById("createGameNameWrap"),s=a.getElementById("createGamePasswordWrap"),c=a.getElementById("createGameMaxPlayerWrap");st.rankedMode=0,st.teamMode=0,"ranked"===e?(st.rankedMode=1,n.style.display="none",i.style.display="block",l.style.display="none",s.style.display="none",c.style.display="none"):(n.style.display="block",i.style.display="none",l.style.display="block",s.style.display="block",c.style.display="block"),"team"===e&&(st.teamMode=1,n.textContent="Create Team Game"),r.val("").select(),o.to("#createGameWrap",st.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),yt.showBackdrop(r)}t("#mainWrap").on($.click,".titlePlayerAccount, .lobbyAccountName",function(){yt.who("/who "+t(this).text())}),t("#gameView").on("dragstart","img",function(t){t.preventDefault()}),t("img").on("dragstart",function(t){t.preventDefault()}),t("#logout").on($.click,function(){return function(){st.lock(),vt.removePlayer(dt.account),t.ajax({type:"GET",url:app.url+"php/deleteFromFwtitle.php"});try{FB.getLoginStatus(function(t){t.authResponse&&FB.logout(function(t){})})}catch(t){}try{gapi.auth2.getAuthInstance().signOut().then(function(){})}catch(t){}localStorage.removeItem("email"),localStorage.removeItem("token"),v(function(){t.ajax({type:"GET",url:app.url+"php/logout.php"}).done(function(t){localStorage.removeItem("token"),n.reload(),st.msg("Logout successful")}).fail(function(){st.msg("Logout failed.")})},1e3)}(),!1}),t("#login").on($.click,function(){vt.removePlayer(dt.account),t.ajax({type:"GET",url:app.url+"php/deleteFromFwtitle.php"})}),t("#titleMenu").on($.click,".wars",function(){var e=t(this).data("name");t("#joinGame").val(e),t("#joinGamePassword").val(""),yt.joinGame()}),t("#mainWrap").on($.click,".chat-join",function(){vt.setChannel(t(this).text())}),t("#create").on($.click,function(){i("ffa")}),t("#createRankedBtn").on($.click,function(){i("ranked")}),t("#createTeamBtn").on($.click,function(){i("team")}),t("#createGame").on($.click,function(){yt.createGame()}),t("#play-now-btn").on($.click,function(){yt.addCpu=1,yt.createGameService(dt.account+"_"+~~(999999*e.random()),"","Earth Omega",8,0,0,20)}),app.isLocal||t(a).on("contextmenu",function(){return!1}),t("body").on($.click,"#options",function(){yt.showModal()}).on($.click,"#hotkeys",function(){o.to("#hotkeysModal",st.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),yt.showBackdrop()}).on($.click,"#resync",function(){A.onbeforeunload=null,localStorage.setItem("resync",1),n.reload()}),t("#hotkeysDone, #optionsDone, #cancelCreateGame").on($.click,function(){yt.closeModal()}),t("#joinPrivateGameModal").on($.click,"#joinPrivateGameBtn",function(){yt.joinGame()}),t("#refresh-game-button").on($.click,function(){yt.refreshGames()}),t("#titleChat").on($.click,".nw-link",function(){yt.openWindow(t(this).attr("href"))}),t("#titleChatPlayers").on($.click,"#friend-status",function(){yt.listFriends()}).on($.click,"#ignore-status",function(){yt.listIgnore()}),t("#get-help").on($.click,function(){yt.help(),t("#title-chat-input").focus()}),t("#ignore-user").on($.click,function(){t("#title-chat-input").val("/ignore ").focus()}),t("#share-url").on($.click,function(){t("#title-chat-input").val("/url ").focus()}),t("#share-image").on($.click,function(){t("#title-chat-input").val("/img ").focus()}),t("#share-video").on($.click,function(){t("#title-chat-input").val("/video ").focus()}),t("#who-account").on($.click,function(){t("#title-chat-input").val("/who ").focus()}),t("#add-friend").on($.click,function(){t("#title-chat-input").val("/friend ").focus()}),t("#whisper-account").on($.click,function(){t("#title-chat-input").val("@").focus()}),t("#change-channel").on($.click,function(){t("#title-chat-input").val("#").focus()}),t("#body").on($.click,"#cancelGame",function(){W()}).on($.click,"#startGame",function(){ht.startGame()}).on($.click,".addFriend",function(){yt.toggleFriend(t(this).data("account"))}).on($.click,".ribbon",function(){var e=1*t(this).data("ribbon");st.chat(ut.ribbonTitle[e]+": "+ut.ribbonDescription[e],"chat-warning")}),t("#toggleNation").on($.click,function(){yt.configureNation()}),t("#joinPrivateGameBtn").on($.click,function(){var e=t("#joinGame");e.val(""),o.to("#joinPrivateGameModal",st.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1,onComplete:function(){e.focus()}}),yt.showBackdrop()}),t("#mainWrap").on($.click,".unlockGameBtn",function(){yt.closeModal(),o.to("#unlockGame",st.modalSpeed,{startAt:{visibility:"visible",y:0,alpha:0},y:30,alpha:1}),v(function(){t("#card-number").focus()},100),yt.showBackdrop()}),t("#leaderboardBtn").on($.click,function(){o.to("#leaderboard",st.modalSpeed,{startAt:{visibility:"visible",top:0,alpha:0},top:30,alpha:1}),yt.showBackdrop(),yt.getLeaderboard("FFA")}),t("#leaderboardFFABtn").on($.click,function(){yt.getLeaderboard("FFA")}),t("#leaderboardRankedBtn").on($.click,function(){yt.getLeaderboard("Ranked")}),t("#leaderboard-trips-btn").on($.click,function(){yt.getLeaderboard("Trips")}),t("#leaderboard-quads-btn").on($.click,function(){yt.getLeaderboard("Quads")}),t("#leaderboard-pents-btn").on($.click,function(){yt.getLeaderboard("Pents")}),t("#leaderboardTeamBtn").on($.click,function(){yt.getLeaderboard("Team")}),t("#window-select-wrap").on($.click,".window-select",function(){dt.window=this.textContent.trim(),$.setWindow(dt.window)}),t("#flagDropdown").on($.click,".flagSelect",function(e){dt.selectedFlag=t(this).text().trim(),dt.selectedFlagFull="Nepal"===dt.selectedFlag?dt.selectedFlag+".png":dt.selectedFlag+".jpg",t(".flagPurchaseStatus").css("display","none"),t("#updateNationFlag").attr("src","images/flags/"+dt.selectedFlagFull).css("display","block"),st.lock(1),t.ajax({url:app.url+"php/updateFlag.php",data:{flag:dt.selectedFlagFull}}).done(function(e){dt.flag=dt.selectedFlagFull,t(".nationFlag").attr({src:"images/flags/"+dt.selectedFlagFull,title:dt.selectedFlag}),st.msg("Your nation's flag is now: "+dt.selectedFlag),a.getElementById("selectedFlag").textContent=dt.selectedFlag,t("[title]").tooltip("fixTitle").tooltip({animation:!1})}).always(function(){st.unlock(1),o.to("#updateNationFlag",1,{startAt:{alpha:0},alpha:1})}),e.preventDefault()}),t("#submitNationName").on("mousedown",function(){yt.submitNationName()}),t("#updateNationName").on("focus",function(){st.focusUpdateNationName=!0}).on("blur",function(){st.focusUpdateNationName=!1}),t("#refreshGameWrap").on("focus","#gameName",function(){st.focusGameName=!0}),t("#refreshGameWrap").on("blur","#gameName",function(){st.focusGameName=!1}),t("#titleViewBackdrop").on($.click,function(){yt.closeModal()}),t("#mainWrap").on($.click,"#unlockGameDone, #configureNationDone, #leaderboardDone",function(){bt.play("click"),yt.closeModal()}),t("#overlay").on($.click,function(){st.searchingGame=!1,o.set(ct.Msg,{opacity:0}),st.unlock()}),t("#joinRankedGame").on($.click,function(){bt.play("click"),st.lock(1),st.searchingGame=!0,st.msg("Searching for ranked games...",0),function e(a){a<4&&!st.joinedGame?(v(function(){st.searchingGame&&e(++a)},1e3),t.ajax({url:app.url+"php/joinRankedGame.php"}).done(function(t){st.searchingGame&&(o.set(ct.Msg,{opacity:0}),st.joinedGame=1,st.unlock(),st.searchingGame=!1,yt.joinGameCallback(t))})):!st.joinedGame&&st.searchingGame&&(st.msg("No ranked games found! Try creating a ranked game instead.",5),st.unlock(),st.searchingGame=!1)}(0)})}(),t("#chat-input-open").on($.click,function(){Z()}),t("#chat-input-send").on($.click,function(){Z(!0)}),t("#lobby-chat-input").on("focus",function(){ht.chatOn=!0}).on("blur",function(){ht.chatOn=!1}),t("#lobbyChatSend").on($.click,function(){ht.sendMsg(!0)}),t("#lobbyChatLog").on("mousedown",function(){ht.chatDrag=!0}).on("mouseup",function(){ht.chatDrag=!1}),t("#joinGameLobby").on($.click,".governmentChoice",function(e){var a=t(this).text();ht.updateGovernmentWindow(a),t.ajax({url:app.url+"php/changeGovernment.php",data:{government:a}})}).on($.click,".cpu-choice",function(e){var a=t(this).text();t.ajax({url:app.url+"php/change-cpu-difficulty.php",data:{difficulty:a,player:t(this).data("player")}})}).on($.click,".playerColorChoice",function(e){var a=t(this).data("playercolor");t.ajax({url:app.url+"php/changePlayerColor.php",data:{playerColor:1*a}}).done(function(t){dt.playerColor=t.playerColor}).fail(function(t){st.msg(t.statusText,1.5)})}).on($.click,".teamChoice",function(e){var a=t(this).text().slice(5),n=t(this).data("player");t.ajax({url:app.url+"php/changeTeam.php",data:{team:a,player:n}}).done(function(t){dt.team=t.team})}).on($.click,"#cpu-add-player",function(t){bt.play("click"),ht.addCpuPlayer()}).on($.click,"#cpu-remove-player",function(e){bt.play("click"),t.ajax({url:app.url+"php/cpu-remove-player.php"})}),at?(t("body").on("DOMMouseScroll",function(t){"game"===st.view&&(K(t.originalEvent.layerX,t.originalEvent.layerY),gt[0].applyBounds())}),t("#worldWrap").on("DOMMouseScroll",function(t){t.originalEvent.detail>0?_():X(),gt[0].applyBounds()})):(t("body").on("mousewheel",function(t){"game"===st.view&&(K(t.offsetX,t.offsetY),gt[0].applyBounds())}),t("#worldWrap").on("mousewheel",function(t){t.originalEvent.wheelDelta>0?X():_(),gt[0].applyBounds()})),t("#worldWrap").on("mousemove",function(t){at?K(t.originalEvent.layerX,t.originalEvent.layerY):K(t.offsetX,t.offsetY)}),t("#diplomacy-ui").on($.click,"#surrender",function(t){a.getElementById("surrenderScreen").style.display="block",bt.play("click")}),t("#createGameWrap").on($.click,".mapSelect",function(e){var n=t(this).text(),o=n.replace(/ /g,"");st.map.name=n,st.map.key=o,a.getElementById("createGameMap").innerHTML=n,a.getElementById("createGamePlayers").innerHTML=yt.mapData[o].players;var i=t("#gamePlayers");i.attr("max",yt.mapData[o].players),1*i.val()>yt.mapData[o].players&&i.val(yt.mapData[o].players),e.preventDefault()}),t("#mainWrap").on($.click,".gameSelect",function(t){t.preventDefault()}),t("#bgmusic").on("ended",function(){var t=a.getElementById("bgmusic");t.currentTime=0,t.play()}),t("#bgamb1").on("ended",function(){var t=a.getElementById("bgamb1");t.currentTime=0,t.play()}),t("#bgamb2").on("ended",function(){var t=a.getElementById("bgamb2");t.currentTime=0,t.play()}),t("#cancelSurrenderButton").on($.click,function(){bt.play("click"),a.getElementById("surrenderScreen").style.display="none"}),t("#surrenderButton").on($.click,function(){j()});if(t(a).on("keydown",function(e){var a=e.keyCode;if(e.ctrlKey){if(82===a)return!1}else{if(123===a&&app.isApp&&-1===dt.account.indexOf("maelfyn"))return!1;"title"===st.view?(!st.isModalOpen&&isLoggedIn&&t("#title-chat-input").focus(),27===a&&yt.toggleModal()):"lobby"===st.view?(t("#lobby-chat-input").focus(),27===a&&yt.toggleModal()):9===a?(e.shiftKey?dt.nextTarget(!0):dt.nextTarget(!1),e.preventDefault()):86===a?"game"!==st.view||st.chatOn||ut.toggleGameWindows(1):27===a&&!dt.attackOn&&!st.chatOn&&yt.toggleModal()}}).on("keyup",function(e){a=e.keyCode;if("title"===st.view)13===a&&(st.focusUpdateNationName?yt.submitNationName():st.focusGameName?yt.createGame():yt.chatOn?13===a&&yt.sendMsg():yt.createGameFocus&&yt.createGame());else if("lobby"===st.view)ht.chatOn&&13===a&&ht.sendMsg();else if("game"===st.view)if(st.chatOn)13!==a&&27!==a||Z(!0);else if(13===a)Z();else if(27===a)dt.attackOn&&(dt.attackOn=!1,dt.attackName="",dt.clearHud(),$.showTarget(ct["land"+dt.tgt]));else if(65===a){n=new Q;wt.target(n)}else if(83===a){n=new Q({cost:1,attackName:"splitAttack",hudMsg:"Split Attack: Select Target",splitAttack:!0});wt.target(n)}else if(68===a)st.keyLock||wt.deploy();else if(82===a){if(!st.keyLock){if(e.ctrlKey){var a;return(a=dt.lastReceivedWhisper)&&("title"===st.view?t("#title-chat-input").val("/w "+a+" ").focus():"lobby"===st.view?t("#lobby-chat-input").val("/w "+a+" ").focus():(st.chatOn||Z(),t("#chat-input").val("/w "+a+" ").focus())),!1}wt.rush()}}else if(89===a)kt.masonry();else if(79===a)kt.construction();else if(69===a)kt.engineering();else if(71===a)kt.gunpowder();else if(75===a)kt.rocketry();else if(84===a)kt.atomicTheory();else if(70===a)kt.futureTech();else if(66===a)wt.upgradeTileDefense();else if(67===a){n=new Q({cost:0,minimum:0,attackName:"cannons",hudMsg:"Fire Cannons"});wt.target(n)}else if(77===a){n=new Q({cost:0,minimum:0,attackName:"missile",hudMsg:"Launch Missile"});wt.target(n)}else if(78===a){var n=new Q({cost:0,minimum:0,attackName:"nuke",hudMsg:"Launch Nuclear Weapon"});wt.target(n)}}),t("#dictatorAvatar").on("change",function(e){function n(t){o.html(t),bt.play("error")}var o=t("#uploadErr"),i=e.target.files[0],r=new FileReader;r.readAsDataURL(i),"image/jpeg"!==i.type?n("Wrong file type! Image must be in jpg format."):r.addEventListener("load",function(){r.result.length<7e4?t.ajax({url:app.url+"php/uploadDictator.php",type:"POST",data:{uri:r.result},beforeSend:function(){o.text("")}}).done(function(t){o.text("Avatar updated successfully!"),a.getElementById("configureAvatarImage").src=r.result}).fail(function(t){n(t.statusText)}):(n("File size too large! Image must be less than 40 kb."),o.html())},!1)}),app.isApp){var xt=require("nw.gui");win=xt.Window.get(),win.on("close",function(){this.hide(),yt.closeGame(),this.close(!0)})}var Ct={structureDefense:[0,5,15,30],scoreTargetAttack:function(t){var a=50;return st.teamMode?0===t.defender?a+=10:ut.player[t.attacker].team!==ut.player[t.defender].team?a+=25:t.attacker===t.defender?a-=5:a-=25:0===t.defender?a+=10:t.attacker!==t.defender?a+=25:a-=10,t.attacker!==t.defender&&(a+=t.unitDiff,a-=Ct.structureDefense[t.defense],a-=t.capital?10:0,a+=~~(t.food+10*e.random()-5)),a},getAttackTarget:function(t){var e=-1,a=-1,n=0;return ut.tiles.forEach(function(o,i){o.player===t&&o.units>=5&&o.adj.forEach(function(r){var l=ut.tiles[r],s=Ct.scoreTargetAttack({attacker:t,defender:l.player,attackerUnits:o.units,unitDiff:o.units-l.units,defense:l.defense,food:l.food,production:l.production,culture:l.culture,capital:l.capital});s>n&&(n=s,e=i,a=r)})}),[e,a,n]},scoreTargetWeapon:function(t){var a=50;return st.teamMode?0===t.defender?a-=10:ut.player[t.attacker].team!==ut.player[t.defender].team?a+=30:t.attacker===t.defender?a-=5:a-=25:0===t.defender?a+=10:t.attacker!==t.defender?a+=25:a-=10,t.attacker!==t.defender&&(a-=t.unitDiff,a+=~~(t.food+10*e.random()-5)),a},getWeaponTarget:function(t){var e=-1,a=-1,n=0;return ut.tiles.forEach(function(o,i){o.player===t&&o.adj.forEach(function(r){var l=ut.tiles[r],s=Ct.scoreTargetWeapon({attacker:t,defender:l.player,attackerUnits:o.units,unitDiff:o.units-l.units,defense:l.defense,food:l.food,production:l.production,culture:l.culture,capital:l.capital});s>n&&(n=s,e=i,a=r)})}),[e,a,n]},getRangedWeaponTarget:function(t){var e=-1,a=-1,n=0;return ut.tiles.forEach(function(o,i){if(o.player!==t){var r=50;r+=o.units,r+=20*o.defense,o.capital&&(r+=5),o.player||(r=0),r>n&&(n=r,a=i)}else e=i}),[e,a,n]},attack:function(e){var a=Ct.getAttackTarget(e.player);a[0]>-1&&t.ajax({url:app.url+"php/attack-ai.php",data:{attacker:a[0],defender:a[1],player:e.player,randomTile:wt.getRandomDemocracyTile(a[1],ut.tiles[a[1]].player),defGovernment:ut.player[ut.tiles[a[1]].player].government}})},getRandomTile:function(t){var a=[],n=0;ut.tiles.forEach(function(e,o){e.player===t&&e.units<255&&(a[n++]=o)});var o=~~(e.random()*n);return a[o]},scoreTargetDeploy:function(t){var a=50;return t.player?t.sameTeam?t.sameTeam&&(a-=10):(a+=25,t.player&&!t.unitDiff&&(a+=-1*t.unitDiff)):a+=10,a+=~~(6*e.random()-3)},getDeployTarget:function(t){var e=-1,a=0;return ut.tiles.forEach(function(n,o){var i=ut.tiles[o].units,r=0,l=0;if(n.player===t&&n.units<255&&n.flag){n.adj.forEach(function(e){l++;var a=ut.tiles[e];a.sameTeam=t===a.player,a.unitDiff=i-a.units,r+=Ct.scoreTargetDeploy(a)});var s=~~(r/l);s>a&&(a=s,e=o)}}),e},getDefenseTarget:function(t){var e=-1,a=0;return ut.tiles.forEach(function(n,o){var i=0;n.player===t&&n.units<255&&n.flag&&(i+=n.units,(i+=10*(3-n.defense))>a&&(a=i,e=o))}),e},deploy:function(e,a){var n=Ct.getDeployTarget(e.player);n!==G&&t.ajax({url:app.url+"php/deploy-ai.php",data:{tile:n,food:a.food}})},getResourceTotal:function(t){var e={food:0,production:0,culture:0};return ut.tiles.forEach(function(a){t===a.player&&(e.food+=a.food,e.production+=a.production,e.culture+=a.culture)}),e},weaponDelay:function(){return 4e3*e.random()+1e3},fireCannons:function(e){var a=Ct.getWeaponTarget(e.player);a[0]>-1&&t.ajax({url:app.url+"php/ai-fireCannons.php",data:{attacker:a[0],defender:a[1]}})},launchMissile:function(e){var a=Ct.getRangedWeaponTarget(e.player);a[0]>-1&&t.ajax({url:app.url+"php/ai-launchMissile.php",data:{attacker:a[0],defender:a[1]}}).done(function(){v(function(){t.ajax({url:app.url+"php/ai-launchMissileHit.php",data:{account:e.account,attacker:a[0],defender:a[1]}})},1e3)})},launchNuke:function(e){var a=Ct.getRangedWeaponTarget(e.player);a[0]>-1&&t.ajax({url:app.url+"php/ai-launchNuke.php",data:{attacker:a[0],defender:a[1]}}).done(function(){v(function(){t.ajax({url:app.url+"php/ai-launchNukeHit.php",data:{account:e.account,defender:a[1]}})},6e3)})},upgradeTileDefense:function(e){var a=Ct.getDefenseTarget(e.player);a>-1&&t.ajax({url:app.url+"php/ai-upgradeTileDefense.php",data:{target:a,account:e.account}})},deployRate:{VeryEasy:6,Easy:5,Normal:4,Hard:4,VeryHard:3,Mania:2,Juggernaut:1},deployFood:{VeryEasy:50,Easy:40,Normal:30,Hard:22,VeryHard:15,Mania:10,Juggernaut:5},attackFood:{VeryEasy:40,Easy:30,Normal:50,Hard:40,VeryHard:30,Mania:20,Juggernaut:10},attackMax:{VeryEasy:2,Easy:3,Normal:3,Hard:4,VeryHard:5,Mania:6,Juggernaut:8},attackBaseTurns:{VeryEasy:0,Easy:0,Normal:1,Hard:1,VeryHard:1,Mania:2,Juggernaut:3},unlockNuke:{VeryEasy:250,Easy:150,Normal:100,Hard:90,VeryHard:80,Mania:60,Juggernaut:20},unlockMissile:{VeryEasy:100,Easy:65,Normal:50,Hard:40,VeryHard:30,Mania:20,Juggernaut:10},unlockCannons:{VeryEasy:50,Easy:30,Normal:20,Hard:15,VeryHard:10,Mania:5,Juggernaut:0},missileRate:{VeryEasy:.875,Easy:.75,Normal:.66,Hard:.6,VeryHard:.5,Mania:.33,Juggernaut:0},cannonRate:{VeryEasy:.75,Easy:.66,Normal:.5,Hard:.35,VeryHard:.2,Mania:.1,Juggernaut:0},unlockStructures:{VeryEasy:30,Easy:20,Normal:10,Hard:8,VeryHard:5,Mania:2,Juggernaut:0},updateResources:function(e,a){t.ajax({url:app.url+"php/ai-updateResources.php",data:{player:a,moves:4+~~(e.food/50),food:e.food,production:e.production,culture:e.culture}})},takeTurn:function(t){var a=Ct.getResourceTotal(t.player);if(Ct.updateResources(a,t.player),st.resourceTick%Ct.deployRate[t.difficultyShort]==0){Ct.deploy(t,a);(i=~~(a.food/Ct.deployFood[t.difficultyShort]))>3&&(i=3);for(r=0;r<i;r++)Ct.deploy(t,a)}var n=e.ceil(a.food/Ct.attackFood[t.difficultyShort])+Ct.attackBaseTurns[t.difficultyShort];n>Ct.attackMax[t.difficultyShort]&&(n=Ct.attackMax[t.difficultyShort]);for(r=0;r<n;r++)!function(t,e){v(function(){Ct.attack(e)},500*r+500)}(0,t);var o=0;if(st.resourceTick>Ct.unlockNuke[t.difficultyShort]&&e.random()>.95&&(o=1,v(function(){Ct.launchNuke(t)},Ct.weaponDelay())),!o)if(st.resourceTick>Ct.unlockMissile[t.difficultyShort]){if(e.random()>Ct.missileRate[t.difficultyShort])for(var i=e.ceil(a.food/60),r=0;r<i;r++)v(function(){Ct.launchMissile(t)},Ct.weaponDelay())}else if(st.resourceTick>Ct.unlockCannons[t.difficultyShort]&&e.random()>Ct.cannonRate[t.difficultyShort])for(var i=e.ceil(a.food/30),r=0;r<i;r++)v(function(){Ct.fireCannons(t)},Ct.weaponDelay());st.resourceTick>Ct.unlockStructures[t.difficultyShort]&&e.random()>.875&&v(function(){Ct.upgradeTileDefense(t)},Ct.weaponDelay())}}}($,Math,document,location,TweenMax,TimelineMax,Power0,Power1,Power2,Power3,Power4,Back,Elastic,Bounce,SteppedEase,Circ,Expo,Sine,setTimeout,setInterval,clearTimeout,clearInterval,void 0===window.webkitRequestAnimationFrame||webkitRequestAnimationFrame,void 0===window.webkitCancelAnimationFrame||webkitCancelAnimationFrame,getComputedStyle,requestAnimationFrame,cancelAnimationFrame,window,Array,JSON,Date,Object);